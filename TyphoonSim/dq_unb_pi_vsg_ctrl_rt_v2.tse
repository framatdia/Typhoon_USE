version = 4.2

//
// Saved by sw version: 2025.1 SP1
//

model "dq_unb_pi_vsg_ctrl_rt_v2" {
    configuration {
        hil_device = "VHIL+"
        hil_configuration_id = 1
        simulation_method = trapezoidal
        simulation_time_step = 1e-6
        simulation_discret_scaling = 1.0
        dsp_timer_periods = 100e-6, 50e-3
        ss_calc_method = "systematic elimination"
        enb_pole_shift = True
        enb_gds_oversampling = True
        show_modes = False
        device_ao_limit_enable = False
        reset_analog_outputs_on_sim_stop = True
        reset_analog_outputs_on_sim_stop_mode = Offset values
        reset_digital_outputs_on_sim_stop = True
        vhil_adio_loopback = False
        cpl_stb = False
        enb_dep_sw_detect = False
        code_section = "internal memory"
        data_section = "internal memory"
        sys_sp_rate_1 = 0.0001
        sys_sp_rate_2 = 0.05
        sys_real_type_precision = "default"
        user_real_type_precision = "default"
        sys_cpu_optimization = "high"
        user_cpu_optimization = "high"
        user_cpu_part_option = "default"
        matrix_based_reduction = True
        cpl_dynamics_analysis = False
        export_ss_to_pickle = False
        ground_scope_core = False
        dss_num_tol = 1e-15
        cce_platform = "generic"
        cce_use_relative_names = False
        cce_type_mapping_real = "double"
        cce_type_mapping_uint = "unsigned int"
        cce_type_mapping_int = "int"
        cce_platform = "generic"
        cce_use_relative_names = False
        cce_type_mapping_real = "double"
        cce_type_mapping_uint = "unsigned int"
        cce_type_mapping_int = "int"
        cce_term_var_location = "local"
        cce_directory = ""
        cce_custom_type_int = ""
        cce_custom_type_uint = ""
        cce_custom_type_real = ""
        tunable_params = "component defined"
        sp_compiler_type = "C compiler"
        sig_stim = "off"
        export_resource_list = ""
        export_dependency_list = ""
        excluded_resource_list = ""
        excluded_component_from_locking_list = ""
        export_out_file = ""
        export_lock_top_level = True
        export_encrypt_library = True
        export_encrypt_resources = True
        solver_type = "DAE"
        integration_method = "BDF"
        max_sim_step = 1e-4
        simulation_time = 4
        abs_tol = 1e-3
        rel_tol = 1e-3
        init_sim_step = 1e-6
        r_on_sw = 1e-3
        v_on_diode = 0.2
        data_sampling_rate = 0
        feedthrough_validation_error_level = warning
    }

    component Subsystem Root {
        component "core/Scope" Powers {
            selected_signals = "[\'p\', \'q\', \'p_fil\', \'q_fil\']"
            signals_data = "{\"signals\": {\"p\": {\"viewports\": [1], \"type\": \"analog\", \"color\": {\"1\": \"#00CC00\"}, \"display\": {\"1\": \"solid\"}}, \"p_fil\": {\"viewports\": [1], \"type\": \"analog\", \"color\": {\"1\": \"#0099FF\"}, \"display\": {\"1\": \"solid\"}}, \"q\": {\"viewports\": [2], \"type\": \"analog\", \"color\": {\"2\": \"#00CC00\"}, \"display\": {\"2\": \"solid\"}}, \"q_fil\": {\"viewports\": [2], \"type\": \"analog\", \"color\": {\"2\": \"#FF0000\"}, \"display\": {\"2\": \"solid\"}}}, \"viewports\": {\"1\": {\"log_scale_x\": false, \"log_scale_y\": false, \"y_axis_db\": false}, \"2\": {\"log_scale_x\": false, \"log_scale_y\": false, \"y_axis_db\": false}, \"3\": {\"log_scale_x\": false, \"log_scale_y\": false, \"y_axis_db\": false}, \"4\": {\"log_scale_x\": false, \"log_scale_y\": false, \"y_axis_db\": false}}, \"plot_settings\": {\"layout\": \"Vertical\", \"background_color\": \"white\", \"legend_visible\": true}}"
        }
        [
            position = 8708, 8656
        ]

        component "core/Probe" p {
            execution_rate = "Ts_Control"
            signal_access = "Inherit"
        }
        [
            position = 8592, 8540
        ]

        component "core/Probe" q {
            execution_rate = "Ts_Control"
            signal_access = "Inherit"
            signal_name = "q"
        }
        [
            position = 8592, 8608
        ]

        component "core/Probe" p_fil {
            execution_rate = "Ts_Control"
            signal_access = "Inherit"
        }
        [
            position = 8588, 8680
        ]

        component "core/Scope" is_abc {
            selected_signals = "[\'Controller.is_a_ref\', \'is_a\', \'Controller.is_b_ref\', \'is_b\', \'Controller.is_c_ref\', \'is_c\', \'Controller.current_ctrl.is_n_ref\', \'is_n\']"
            signals_data = "{\"signals\": {\"Controller.is_a_ref\": {\"viewports\": [1], \"type\": \"analog\", \"color\": {\"1\": \"#00CC00\"}, \"display\": {\"1\": \"solid\"}}, \"is_a\": {\"viewports\": [1], \"type\": \"analog\", \"color\": {\"1\": \"#0099FF\"}, \"display\": {\"1\": \"solid\"}}, \"Controller.is_b_ref\": {\"viewports\": [2], \"type\": \"analog\", \"color\": {\"2\": \"#FF0000\"}, \"display\": {\"2\": \"solid\"}}, \"is_b\": {\"viewports\": [2], \"type\": \"analog\", \"color\": {\"2\": \"#00CC00\"}, \"display\": {\"2\": \"solid\"}}, \"Controller.is_c_ref\": {\"viewports\": [3], \"type\": \"analog\", \"color\": {\"3\": \"#FF0000\"}, \"display\": {\"3\": \"solid\"}}, \"is_c\": {\"viewports\": [3], \"type\": \"analog\", \"color\": {\"3\": \"#00CC00\"}, \"display\": {\"3\": \"solid\"}}, \"Controller.current_ctrl.is_n_ref\": {\"viewports\": [4], \"type\": \"analog\", \"color\": {\"4\": \"#FF0000\"}, \"display\": {\"4\": \"solid\"}}, \"is_n\": {\"viewports\": [4], \"type\": \"analog\", \"color\": {\"4\": \"#00CC00\"}, \"display\": {\"4\": \"solid\"}}}, \"viewports\": {\"1\": {\"log_scale_x\": false, \"log_scale_y\": false, \"y_axis_db\": false}, \"2\": {\"log_scale_x\": false, \"log_scale_y\": false, \"y_axis_db\": false}, \"3\": {\"log_scale_x\": false, \"log_scale_y\": false, \"y_axis_db\": false}, \"4\": {\"log_scale_x\": false, \"log_scale_y\": false, \"y_axis_db\": false}}, \"plot_settings\": {\"layout\": \"Vertical\", \"background_color\": \"white\", \"legend_visible\": true}}"
        }
        [
            position = 9112, 8608
        ]

        component "core/Probe" is_a {
            execution_rate = "Ts_Control"
            signal_access = "Inherit"
        }
        [
            position = 8988, 8544
        ]

        component "core/Probe" is_b {
            execution_rate = "Ts_Control"
            signal_access = "Inherit"
        }
        [
            position = 8988, 8608
        ]

        component "core/Probe" is_c {
            execution_rate = "Ts_Control"
            signal_access = "Inherit"
        }
        [
            position = 8988, 8676
        ]

        component Subsystem Controller {
            layout = dynamic
            component "core/Step" pref {
                execution_rate = "Ts_Control"
                final_value = "0.1"
                step_time = "0.75"
            }
            [
                position = 5984, 8112
            ]

            component "core/Step" qref {
                execution_rate = "Ts_Control"
                final_value = "-0.1"
                step_time = "1.25"
            }
            [
                position = 5984, 8192
            ]

            component "core/Clock" Clock2 {
                execution_rate = "Ts_Control"
            }
            [
                position = 6904, 7324
            ]

            component Subsystem "Virtual 3ph3w" {
                layout = dynamic
                component "core/Probe" vs_a_al {
                    execution_rate = "Ts_Control"
                    signal_access = "Inherit"
                    signal_name = "q"
                }
                [
                    position = 7716, 8060
                ]

                component "core/Probe" vs_a_be {
                    execution_rate = "Ts_Control"
                    signal_access = "Inherit"
                    signal_name = "q"
                }
                [
                    position = 7736, 8316
                ]

                component "core/Gain" Gain1 {
                    gain = "2"
                }
                [
                    position = 7572, 7852
                ]

                component "core/Bus Join" "Bus Join17" {
                }
                [
                    position = 7728, 7848
                ]

                component "core/Gain" Gain2 {
                    gain = "2"
                }
                [
                    position = 7540, 8152
                ]

                component "core/Bus Join" "Bus Join18" {
                }
                [
                    position = 7688, 8208
                ]

                component "core/Gain" Gain3 {
                    gain = "2"
                }
                [
                    position = 8768, 7848
                ]

                component "core/Bus Join" "Bus Join19" {
                }
                [
                    position = 8920, 7840
                ]

                component "core/Gain" Gain4 {
                    gain = "2"
                }
                [
                    position = 8732, 8140
                ]

                component "core/Bus Join" "Bus Join20" {
                }
                [
                    position = 8880, 8196
                ]

                component "core/Gain" Gain5 {
                    gain = "2"
                }
                [
                    position = 10024, 7856
                ]

                component "core/Bus Join" "Bus Join21" {
                }
                [
                    position = 10180, 7852
                ]

                component "core/Gain" Gain6 {
                    gain = "2"
                }
                [
                    position = 9992, 8156
                ]

                component "core/Bus Join" "Bus Join22" {
                }
                [
                    position = 10140, 8212
                ]

                component "core/Advanced Low-Pass Filter" "Advanced Low-Pass Filter1" {
                    N = "1"
                    apb = "3"
                    execution_rate = "Ts_Control"
                    fc_combo = "External"
                    type_combo = "Basic"
                }
                [
                    position = 7320, 8160
                    size = 48, 48
                ]

                component "core/Advanced Low-Pass Filter" "Advanced Low-Pass Filter2" {
                    N = "1"
                    apb = "3"
                    execution_rate = "Ts_Control"
                    fc_combo = "External"
                    type_combo = "Basic"
                }
                [
                    position = 7432, 8168
                    size = 48, 48
                ]

                component "core/Advanced Low-Pass Filter" "Advanced Low-Pass Filter3" {
                    N = "1"
                    apb = "3"
                    execution_rate = "Ts_Control"
                    fc_combo = "External"
                    type_combo = "Basic"
                }
                [
                    position = 7356, 7848
                    size = 48, 48
                ]

                component "core/Advanced Low-Pass Filter" "Advanced Low-Pass Filter4" {
                    N = "1"
                    apb = "3"
                    execution_rate = "Ts_Control"
                    fc_combo = "External"
                    type_combo = "Basic"
                }
                [
                    position = 7468, 7856
                    size = 48, 48
                ]

                component "core/Advanced Low-Pass Filter" "Advanced Low-Pass Filter5" {
                    N = "1"
                    apb = "3"
                    execution_rate = "Ts_Control"
                    fc_combo = "External"
                    type_combo = "Basic"
                }
                [
                    position = 8492, 8152
                    size = 48, 48
                ]

                component "core/Advanced Low-Pass Filter" "Advanced Low-Pass Filter6" {
                    N = "1"
                    apb = "3"
                    execution_rate = "Ts_Control"
                    fc_combo = "External"
                    type_combo = "Basic"
                }
                [
                    position = 8604, 8160
                    size = 48, 48
                ]

                component "core/Advanced Low-Pass Filter" "Advanced Low-Pass Filter7" {
                    N = "1"
                    apb = "3"
                    execution_rate = "Ts_Control"
                    fc_combo = "External"
                    type_combo = "Basic"
                }
                [
                    position = 8528, 7856
                    size = 48, 48
                ]

                component "core/Advanced Low-Pass Filter" "Advanced Low-Pass Filter8" {
                    N = "1"
                    apb = "3"
                    execution_rate = "Ts_Control"
                    fc_combo = "External"
                    type_combo = "Basic"
                }
                [
                    position = 8640, 7864
                    size = 48, 48
                ]

                component "core/Advanced Low-Pass Filter" "Advanced Low-Pass Filter9" {
                    N = "1"
                    apb = "3"
                    execution_rate = "Ts_Control"
                    fc_combo = "External"
                    type_combo = "Basic"
                }
                [
                    position = 9796, 7868
                    size = 48, 48
                ]

                component "core/Advanced Low-Pass Filter" "Advanced Low-Pass Filter10" {
                    N = "1"
                    apb = "3"
                    execution_rate = "Ts_Control"
                    fc_combo = "External"
                    type_combo = "Basic"
                }
                [
                    position = 9908, 7876
                    size = 48, 48
                ]

                component "core/Advanced Low-Pass Filter" "Advanced Low-Pass Filter11" {
                    N = "1"
                    apb = "3"
                    execution_rate = "Ts_Control"
                    fc_combo = "External"
                    type_combo = "Basic"
                }
                [
                    position = 9756, 8164
                    size = 48, 48
                ]

                component "core/Advanced Low-Pass Filter" "Advanced Low-Pass Filter12" {
                    N = "1"
                    apb = "3"
                    execution_rate = "Ts_Control"
                    fc_combo = "External"
                    type_combo = "Basic"
                }
                [
                    position = 9868, 8172
                    size = 48, 48
                ]

                port is_a {
                    position = left:1
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 7100, 7860
                ]

                port is_a_albe {
                    position = right:1
                    kind = sp
                    direction =  in
                    sp_type {
                        default = inherit
                        readonly = True
                    }
                }
                [
                    position = 7856, 7856
                ]

                port vs_a {
                    position = left:2
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 7120, 8156
                ]

                port vs_a_albe {
                    position = right:2
                    kind = sp
                    direction =  in
                    sp_type {
                        default = inherit
                        readonly = True
                    }
                }
                [
                    position = 7776, 8212
                ]

                port is_b {
                    position = left:3
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 8292, 7848
                ]

                port is_b_albe {
                    position = right:3
                    kind = sp
                    direction =  in
                    sp_type {
                        default = inherit
                        readonly = True
                    }
                }
                [
                    position = 9048, 7844
                ]

                port vs_b {
                    position = left:4
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 8312, 8144
                ]

                port vs_b_albe {
                    position = right:4
                    kind = sp
                    direction =  in
                    sp_type {
                        default = inherit
                        readonly = True
                    }
                }
                [
                    position = 8968, 8200
                ]

                port is_c {
                    position = left:5
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 9552, 7864
                ]

                port is_c_albe {
                    position = right:5
                    kind = sp
                    direction =  in
                    sp_type {
                        default = inherit
                        readonly = True
                    }
                }
                [
                    position = 10308, 7860
                ]

                port vs_c {
                    position = left:6
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 9572, 8160
                ]

                port vs_c_albe {
                    position = right:6
                    kind = sp
                    direction =  in
                    sp_type {
                        default = inherit
                        readonly = True
                    }
                }
                [
                    position = 10228, 8216
                ]

                port omega_rads_a {
                    position = left:7
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 6876, 8060
                ]

                port omega_rads_b {
                    position = left:8
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 8168, 7980
                ]

                port omega_rads_c {
                    position = left:9
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 9420, 8008
                ]

                junction Junction223 sp
                [
                    position = 7648, 8092
                ]

                junction Junction226 sp
                [
                    position = 7604, 8216
                ]

                junction Junction235 sp
                [
                    position = 7240, 8152
                ]

                junction Junction238 sp
                [
                    position = 7272, 7844
                ]

                junction Junction240 sp
                [
                    position = 8428, 8144
                ]

                junction Junction242 sp
                [
                    position = 8464, 7848
                ]

                junction Junction244 sp
                [
                    position = 9724, 7864
                ]

                junction Junction246 sp
                [
                    position = 9692, 8152
                ]

                junction Junction247 sp
                [
                    position = 7316, 7940
                ]

                junction Junction248 sp
                [
                    position = 6952, 8060
                ]

                junction Junction249 sp
                [
                    position = 7264, 8252
                ]

                junction Junction250 sp
                [
                    position = 8488, 7940
                ]

                junction Junction251 sp
                [
                    position = 8216, 7980
                ]

                junction Junction252 sp
                [
                    position = 8344, 8244
                ]

                junction Junction253 sp
                [
                    position = 9756, 7948
                ]

                junction Junction254 sp
                [
                    position = 9472, 8008
                ]

                junction Junction255 sp
                [
                    position = 9716, 8252
                ]

                connect "Bus Join17.out" is_a_albe as Connection929
                connect "Bus Join18.in" Junction223 as Connection938
                connect "Bus Join18.out" vs_a_albe as Connection943
                connect Junction226 Gain2.out as Connection946
                connect vs_a_be.in Junction226 as Connection947
                connect vs_a_al.in Junction223 as Connection948
                connect "Bus Join18.in1" Junction226 as Connection950
                [
                    breakpoints = 7640, 8216
                ]
                connect Gain1.out "Bus Join17.in1" as Connection953
                connect "Bus Join19.out" is_b_albe as Connection955
                connect "Bus Join20.out" vs_b_albe as Connection961
                connect Gain3.out "Bus Join19.in1" as Connection971
                connect "Bus Join21.out" is_c_albe as Connection973
                connect "Bus Join22.out" vs_c_albe as Connection979
                connect Gain5.out "Bus Join21.in1" as Connection989
                connect Gain4.out "Bus Join20.in1" as Connection990
                [
                    breakpoints = 8796, 8204; 8832, 8204
                ]
                connect "Bus Join22.in1" Gain6.out as Connection993
                [
                    breakpoints = 10092, 8220; 10056, 8220
                ]
                connect "Advanced Low-Pass Filter1.out" "Advanced Low-Pass Filter2.in" as Connection995
                connect "Advanced Low-Pass Filter2.out" Gain2.in as Connection996
                connect Junction223 Junction235 as Connection997
                [
                    breakpoints = 7648, 8096; 7648, 8088; 7240, 8088
                ]
                connect Junction235 vs_a as Connection998
                [
                    breakpoints = 7240, 8156
                ]
                connect "Advanced Low-Pass Filter1.in" Junction235 as Connection999
                connect "Advanced Low-Pass Filter3.out" "Advanced Low-Pass Filter4.in" as Connection1005
                connect "Advanced Low-Pass Filter4.out" Gain1.in as Connection1009
                connect is_a Junction238 as Connection1010
                [
                    breakpoints = 7272, 7856
                ]
                connect Junction238 "Bus Join17.in" as Connection1011
                [
                    breakpoints = 7272, 7788; 7680, 7788; 7680, 7796; 7680, 7792
                ]
                connect "Advanced Low-Pass Filter3.in" Junction238 as Connection1012
                connect "Advanced Low-Pass Filter5.out" "Advanced Low-Pass Filter6.in" as Connection1015
                connect vs_b Junction240 as Connection1019
                connect Junction240 "Bus Join20.in" as Connection1020
                [
                    breakpoints = 8432, 8144; 8432, 8076; 8840, 8076; 8840, 8084; 8840, 8080
                ]
                connect "Advanced Low-Pass Filter5.in" Junction240 as Connection1021
                connect "Advanced Low-Pass Filter6.out" Gain4.in as Connection1022
                connect "Advanced Low-Pass Filter7.out" "Advanced Low-Pass Filter8.in" as Connection1023
                connect is_b Junction242 as Connection1027
                connect Junction242 "Bus Join19.in" as Connection1028
                [
                    breakpoints = 8464, 7844; 8464, 7776; 8872, 7776; 8872, 7784; 8872, 7780
                ]
                connect "Advanced Low-Pass Filter7.in" Junction242 as Connection1029
                connect "Advanced Low-Pass Filter8.out" Gain3.in as Connection1030
                connect "Advanced Low-Pass Filter9.out" "Advanced Low-Pass Filter10.in" as Connection1032
                connect is_c Junction244 as Connection1036
                connect Junction244 "Bus Join21.in" as Connection1037
                [
                    breakpoints = 9724, 7860; 9724, 7792; 10132, 7792; 10132, 7800; 10132, 7796
                ]
                connect "Advanced Low-Pass Filter9.in" Junction244 as Connection1038
                connect "Advanced Low-Pass Filter10.out" Gain5.in as Connection1039
                connect "Advanced Low-Pass Filter11.out" "Advanced Low-Pass Filter12.in" as Connection1041
                connect "Bus Join22.in" Junction246 as Connection1045
                [
                    breakpoints = 10100, 8096; 10100, 8100; 10100, 8092; 9692, 8092
                ]
                connect Junction246 vs_c as Connection1046
                [
                    breakpoints = 9692, 8160
                ]
                connect "Advanced Low-Pass Filter11.in" Junction246 as Connection1047
                connect "Advanced Low-Pass Filter12.out" Gain6.in as Connection1048
                connect "Advanced Low-Pass Filter3.fc_input" Junction247 as Connection1050
                connect Junction247 "Advanced Low-Pass Filter4.fc_input" as Connection1051
                [
                    breakpoints = 7316, 7936
                ]
                connect omega_rads_a Junction248 as Connection1053
                connect Junction248 Junction247 as Connection1054
                connect "Advanced Low-Pass Filter1.fc_input" Junction249 as Connection1056
                connect Junction249 Junction248 as Connection1057
                [
                    breakpoints = 7264, 8256
                ]
                connect "Advanced Low-Pass Filter2.fc_input" Junction249 as Connection1058
                connect "Advanced Low-Pass Filter7.fc_input" Junction250 as Connection1061
                connect Junction250 "Advanced Low-Pass Filter8.fc_input" as Connection1062
                [
                    breakpoints = 8488, 7944
                ]
                connect omega_rads_b Junction251 as Connection1064
                connect Junction251 Junction250 as Connection1065
                connect "Advanced Low-Pass Filter5.fc_input" Junction252 as Connection1067
                connect Junction252 Junction251 as Connection1068
                [
                    breakpoints = 8344, 8244
                ]
                connect "Advanced Low-Pass Filter6.fc_input" Junction252 as Connection1069
                connect "Advanced Low-Pass Filter9.fc_input" Junction253 as Connection1072
                connect Junction253 "Advanced Low-Pass Filter10.fc_input" as Connection1073
                [
                    breakpoints = 9756, 7956
                ]
                connect omega_rads_c Junction254 as Connection1075
                connect Junction254 Junction253 as Connection1076
                connect "Advanced Low-Pass Filter11.fc_input" Junction255 as Connection1078
                connect Junction255 Junction254 as Connection1079
                [
                    breakpoints = 9716, 8252; 9472, 8252
                ]
                connect "Advanced Low-Pass Filter12.fc_input" Junction255 as Connection1080
            }
            [
                position = 6316, 7664
                size = 128, 296
            ]

            component Subsystem VSG_a {
                layout = dynamic
                component "core/C function" "C function VSG" {
                    arb_defs = "/*Begin code section*/

/*End code section*/"
                    execution_rate = "Ts_Control"
                    global_variables = "real x_p;real x_q;real theta;real x_isd;real x_isq;real e_p;real e_q;"
                    init_fnc = "/*Begin code section*/
x_p = 0.0;
x_q = 0.0;
theta = 0.0;
x_isd = 0.0;
x_isq = 0.0;
e_p = 0.0;
e_q = 0.0;
/*End code section*/"
                    input_terminals = "real p_m_ref;real q_s_ref;real time;real is_albe;real vs_albe;inherit omega_base;"
                    input_terminals_dimensions = "1;1;1;2;2;1"
                    input_terminals_feedthrough = "True;True;True;True;True;True"
                    input_terminals_show_labels = "True;True;True;True;True;True"
                    output_fnc = "/*Begin code section*/
// current dq transformation
is_d= is_albe[0]*cos(theta)+ is_albe[1]*sin(theta);
is_q = -is_albe[0]*sin(theta) + is_albe[1]*cos(theta);

// voltage dq transformation
vs_d= vs_albe[0]*cos(theta)+ vs_albe[1]*sin(theta);
vs_q = -vs_albe[0]*sin(theta) + vs_albe[1]*cos(theta);

//if (time<=T_on_contactor){
//    vs_q = -sqrt(pow(vs_d,2)+pow(vs_q,2));
//    vs_d = 0.0;
    
//}
// powers in pu
p_s = (is_d* vs_d + is_q*vs_q)/(I_bdq*U_bdq);
q_s = (is_d* vs_q -  is_q*vs_d)/(I_bdq*U_bdq);

//omega VSG rads
omega_vsg = (Kp_p*e_p + x_p + omega_base)*2.0*M_PI*50.0;
//theta VSG
theta_vsg= theta;

// electromotive force pu
e = e_o + Kp_q*e_q + x_q;
e_dq[0] = 0;
e_dq[1] = -e*U_bdq;

//current references SI
is_dq_ref[0] = -I_bdq*(Xv*e + Rv*vs_d/U_bdq + Xv*vs_q/U_bdq)/(pow(Rv,2)+pow(Xv,2));
is_dq_ref[1] = -I_bdq*(Rv*e + Rv*vs_q/U_bdq - Xv*vs_d/U_bdq)/(pow(Rv,2)+pow(Xv,2));

//current references SI filtered
is_dq_ref_fil[0] = x_isd;
is_dq_ref_fil[1] = x_isq;
/*End code section*/"
                    output_terminals = "real is_dq_ref;real omega_vsg;real theta_vsg;real e;real p_s;real q_s;real is_dq_ref_fil;inherit is_d;inherit is_q;inherit vs_d;inherit vs_q;real e_dq;"
                    output_terminals_dimensions = "2;1;1;1;1;1;2;1;1;1;1;2"
                    output_terminals_feedthrough = "True;True;True;True;True;True;True;True;True;True;True;True"
                    output_terminals_show_labels = "True;True;True;True;True;True;True;True;True;True;True;True"
                    parameters = "real Kp_p;real Ki_p;real Kp_q;real Ki_q;real Xv;real Rv;real I_bdq;real e_o;real U_bdq;real Ts_Control;real tau_vsg;real T_on_contactor;"
                    update_fnc = "/*Begin code section*/
//active and reactive power error pu
e_p = p_m_ref - p_s;
e_q = q_s_ref - q_s;

//integrator PI active adn reactive power
x_p = x_p + Ki_p*Ts_Control*e_p;
x_q = x_q + Ki_q*Ts_Control*e_q;

//integrator omega rad
theta = theta + omega_vsg*Ts_Control;
if (theta>=2*M_PI){
    theta = theta - 2*M_PI;
}
if (theta<0.0){
    theta = theta + abs(theta);
}

//filter of the reference currents
x_isd = x_isd + Ts_Control*2*M_PI*1/(tau_vsg)*(is_dq_ref[0] - x_isd);
x_isq = x_isq + Ts_Control*2*M_PI*1/(tau_vsg)*(is_dq_ref[1] - x_isq);

//if (time<=T_on_contactor){
//    x_p = 0.0;
//    theta = 0.0;
//    x_q = 0.0;
//}
/*End code section*/"
                }
                [
                    position = 8240, 8144
                    size = 232, 648
                ]

                component "core/Bus Join" "Bus Join11" {
                    execution_rate = "Ts_Control"
                }
                [
                    position = 8432, 8192
                ]

                component "core/Bus Join" "Bus Join14" {
                    execution_rate = "Ts_Control"
                }
                [
                    position = 8452, 8292
                ]

                component "core/C function" "C function dq to abc" {
                    arb_defs = "/*Begin code section*/

/*End code section*/"
                    execution_rate = "Ts_Control"
                    init_fnc = "/*Begin code section*/

/*End code section*/"
                    input_terminals = "real dq;real theta;"
                    input_terminals_dimensions = "2;1"
                    input_terminals_feedthrough = "True;True"
                    input_terminals_show_labels = "True;True"
                    output_fnc = "/*Begin code section*/
a= cos(theta)*dq[0] - sin(theta)*dq[1];
b= cos(theta -2.0/3.0*M_PI)*dq[0]  - sin(theta-2.0/3.0*M_PI)*dq[1];
c= cos(theta +2.0/3.0*M_PI)*dq[0] - sin(theta+2.0/3.0*M_PI)*dq[1];
/*End code section*/"
                    output_terminals = "real a;real b;real c;"
                    output_terminals_dimensions = "1;1;1"
                    output_terminals_feedthrough = "True;True;True"
                    output_terminals_show_labels = "True;True;True"
                    update_fnc = "/*Begin code section*/

/*End code section*/"
                }
                [
                    position = 8816, 8052
                    size = 152, 96
                ]

                component "core/C function" "C function abc to dq" {
                    arb_defs = "/*Begin code section*/

/*End code section*/"
                    execution_rate = "Ts_Control"
                    input_terminals = "real abc;real theta;"
                    input_terminals_dimensions = "3;1"
                    input_terminals_feedthrough = "True;True"
                    input_terminals_show_labels = "True;True"
                    output_fnc = "/*Begin code section*/
d= 2.0/3.0*(cos(theta)*abc[0] + cos(theta - 2.0/3.0*M_PI)*abc[1]  + cos(theta + 2.0/3.0*M_PI)*abc[2] );
q = 2.0/3.0*(-sin(theta)*abc[0] - sin(theta - 2.0/3.0*M_PI)*abc[1]  - sin(theta + 2.0/3.0*M_PI)*abc[2] );
/*End code section*/"
                    output_terminals = "real d;real q;"
                    output_terminals_dimensions = "1;1"
                    output_terminals_feedthrough = "True;True"
                    output_terminals_show_labels = "True;True"
                }
                [
                    position = 9200, 8100
                    size = 176, 152
                ]

                component "core/Bus Join" "Bus Join15" {
                    execution_rate = "Ts_Control"
                    inputs = "3"
                }
                [
                    position = 8960, 8056
                ]

                component "core/Constant" Constant1 {
                    execution_rate = "Ts_Control"
                    value = "0"
                }
                [
                    position = 9020, 8144
                ]

                component "core/Bus Join" "Bus Join16" {
                    execution_rate = "Ts_Control"
                }
                [
                    position = 9364, 8096
                ]

                component "core/Signal switch" "Signal switch1" {
                    execution_rate = "Ts_Control"
                }
                [
                    position = 7788, 8340
                ]

                component "core/Constant" Constant2 {
                    execution_rate = "Ts_Control"
                }
                [
                    position = 7664, 8316
                ]

                component "core/Step" Step1 {
                    execution_rate = "Ts_Control"
                    step_time = "T_on_vsg"
                }
                [
                    position = 7496, 8228
                ]

                component "core/Gain" Gain1 {
                    execution_rate = "Ts_Control"
                    gain = "1/omega_base_rads"
                }
                [
                    position = 7512, 8416
                ]

                component "core/Probe" is_al_ref {
                }
                [
                    position = 9416, 7968
                ]

                component "core/Probe" is_be_ref {
                }
                [
                    position = 9460, 8208
                ]

                component "core/Probe" e {
                }
                [
                    position = 8700, 7928
                ]

                component "core/Probe" is_d {
                }
                [
                    position = 8632, 8148
                ]

                component "core/Probe" is_q {
                }
                [
                    position = 8616, 8252
                ]

                component "core/Probe" vs_d {
                }
                [
                    position = 8580, 8360
                ]

                component "core/Probe" vs_q {
                }
                [
                    position = 8420, 8396
                ]

                component "core/Bus Split" "Bus Split2" {
                }
                [
                    position = 8440, 7720
                ]

                component "core/Probe" is_d_ref {
                }
                [
                    position = 8584, 7616
                ]

                component "core/Probe" is_q_ref {
                }
                [
                    position = 8568, 7720
                ]

                port i_albe {
                    position = left:1
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 7992, 8132
                ]

                port is_albe_ref {
                    position = right:1
                    kind = sp
                    direction =  in
                    sp_type {
                        default = inherit
                        readonly = True
                    }
                }
                [
                    position = 9464, 8048
                ]

                port v_albe {
                    position = left:2
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 8008, 8224
                ]

                port p_m_ref {
                    position = left:3
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 8024, 7840
                ]

                port q_s_ref {
                    position = left:4
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 8044, 7936
                ]

                port omega_vsg {
                    position = right:2
                    kind = sp
                    direction =  in
                    sp_type {
                        default = inherit
                        readonly = True
                    }
                }
                [
                    position = 9088, 8312
                ]

                port p_s {
                    position = right:3
                    kind = sp
                    direction =  in
                    sp_type {
                        default = inherit
                        readonly = True
                    }
                }
                [
                    position = 9096, 8368
                ]

                port q_s {
                    position = right:4
                    kind = sp
                    direction =  in
                    sp_type {
                        default = inherit
                        readonly = True
                    }
                }
                [
                    position = 9100, 8456
                ]

                port omega_pll {
                    position = left:5
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 7404, 8416
                ]

                port e_albe {
                    position = right:5
                    kind = sp
                    direction =  in
                    sp_type {
                        default = inherit
                        readonly = True
                    }
                }
                [
                    position = 9460, 8100
                ]

                tag From95 {
                    value = "time"
                    scope = global
                    kind = sp
                    direction = out
                }
                [
                    position = 8048, 8032
                    hide_name = True
                    size = 60, 20
                ]

                tag Goto46 {
                    value = "is_dq_ref"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 8440, 7840
                    hide_name = True
                    size = 60, 20
                ]

                tag Goto47 {
                    value = "omega_vsg"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 8440, 7888
                    hide_name = True
                    size = 68, 20
                ]

                tag Goto48 {
                    value = "theta_vsg"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 8432, 7936
                    hide_name = True
                    size = 68, 20
                ]

                tag Goto49 {
                    value = "e"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 8436, 7984
                    hide_name = True
                    size = 68, 20
                ]

                tag Goto50 {
                    value = "p_s"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 8440, 8032
                    hide_name = True
                    size = 68, 20
                ]

                tag Goto51 {
                    value = "q_s"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 8436, 8080
                    hide_name = True
                    size = 68, 20
                ]

                tag Goto54 {
                    value = "is_dq_ref_fil"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 8452, 8128
                    hide_name = True
                    size = 92, 20
                ]

                tag Goto52 {
                    value = "is_dq"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 8540, 8192
                    hide_name = True
                    size = 60, 20
                ]

                tag Goto53 {
                    value = "vs_dq"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 8556, 8292
                    hide_name = True
                    size = 60, 20
                ]

                tag From128 {
                    value = "is_dq_ref"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8620, 8012
                    hide_name = True
                    size = 60, 20
                ]

                tag From129 {
                    value = "theta_vsg"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8628, 8084
                    rotation = down
                    hide_name = True
                    scale = -1, 1
                    size = 60, 20
                ]

                tag From130 {
                    value = "omega_vsg"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8988, 8312
                    rotation = down
                    hide_name = True
                    scale = -1, 1
                    size = 60, 20
                ]

                tag From131 {
                    value = "p_s"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8980, 8368
                    rotation = down
                    hide_name = True
                    scale = -1, 1
                    size = 60, 20
                ]

                tag From132 {
                    value = "q_s"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8976, 8456
                    rotation = down
                    hide_name = True
                    scale = -1, 1
                    size = 60, 20
                ]

                tag Goto55 {
                    value = "e_dq"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 8448, 8452
                    hide_name = True
                    size = 60, 20
                ]

                tag From133 {
                    value = "e_dq"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8644, 8040
                    rotation = down
                    hide_name = True
                    scale = -1, 1
                    size = 60, 20
                ]

                junction Junction1 sp
                [
                    position = 9328, 8040
                ]

                junction Junction2 sp
                [
                    position = 9304, 8156
                ]

                junction Junction3 sp
                [
                    position = 8380, 7984
                ]

                junction Junction4 sp
                [
                    position = 8388, 8184
                ]

                junction Junction5 sp
                [
                    position = 8392, 8224
                ]

                junction Junction6 sp
                [
                    position = 8396, 8284
                ]

                junction Junction7 sp
                [
                    position = 8372, 8320
                ]

                junction Junction8 sp
                [
                    position = 8372, 7840
                ]

                connect From95 "C function VSG.time" as Connection4
                connect p_m_ref "C function VSG.p_m_ref" as Connection5
                connect q_s_ref "C function VSG.q_s_ref" as Connection6
                connect "C function VSG.is_dq_ref_fil" Goto54 as Connection16
                connect Goto51 "C function VSG.q_s" as Connection17
                connect Goto50 "C function VSG.p_s" as Connection18
                connect Goto48 "C function VSG.theta_vsg" as Connection20
                connect Goto47 "C function VSG.omega_vsg" as Connection21
                connect From129 "C function dq to abc.theta" as Connection898
                connect omega_vsg From130 as Connection902
                connect From131 p_s as Connection903
                [
                    breakpoints = 9072, 8364
                ]
                connect q_s From132 as Connection904
                connect v_albe "C function VSG.vs_albe" as Connection906
                connect Goto53 "Bus Join14.out" as Connection913
                connect Goto52 "Bus Join11.out" as Connection914
                connect "Bus Join15.in1" "C function dq to abc.b" as Connection915
                connect "Bus Join15.in" "C function dq to abc.a" as Connection916
                connect "C function dq to abc.c" "Bus Join15.in2" as Connection917
                connect "Bus Join15.out" "C function abc to dq.abc" as Connection918
                connect Constant1.out "C function abc to dq.theta" as Connection919
                connect Step1.out "Signal switch1.in2" as Connection925
                connect omega_pll Gain1.in as Connection927
                connect "C function abc to dq.d" Junction1 as Connection929
                connect Junction1 "Bus Join16.in" as Connection930
                [
                    breakpoints = 9332, 8084
                ]
                connect is_al_ref.in Junction1 as Connection931
                connect "Bus Join16.in1" Junction2 as Connection932
                connect Junction2 "C function abc to dq.q" as Connection933
                connect is_be_ref.in Junction2 as Connection934
                connect Goto49 Junction3 as Connection935
                connect Junction3 "C function VSG.e" as Connection936
                connect e.in Junction3 as Connection937
                connect i_albe "C function VSG.is_albe" as Connection943
                [
                    breakpoints = 8024, 8128
                ]
                connect "Bus Join11.in" Junction4 as Connection944
                connect Junction4 "C function VSG.is_d" as Connection945
                connect is_d.in Junction4 as Connection946
                connect "C function VSG.is_q" Junction5 as Connection947
                connect Junction5 "Bus Join11.in1" as Connection948
                connect is_q.in Junction5 as Connection949
                connect "Bus Join14.in" Junction6 as Connection950
                connect Junction6 "C function VSG.vs_d" as Connection951
                connect vs_d.in Junction6 as Connection952
                connect "C function VSG.vs_q" Junction7 as Connection953
                connect Junction7 "Bus Join14.in1" as Connection954
                connect vs_q.in Junction7 as Connection955
                connect Goto46 Junction8 as Connection956
                connect Junction8 "C function VSG.is_dq_ref" as Connection957
                connect "Bus Split2.in" Junction8 as Connection958
                connect is_d_ref.in "Bus Split2.out" as Connection959
                connect is_q_ref.in "Bus Split2.out1" as Connection960
                connect Gain1.out "Signal switch1.in1" as Connection962
                connect "Signal switch1.in" Constant2.out as Connection963
                connect "Signal switch1.out" "C function VSG.omega_base" as Connection964
                connect Goto55 "C function VSG.e_dq" as Connection965
                connect From133 "C function dq to abc.dq" as Connection966
                connect e_albe "Bus Join16.out" as Connection967
            }
            [
                position = 6852, 7676
                size = 152, 224
            ]

            component "core/Step" pref1 {
                execution_rate = "Ts_Control"
                final_value = "0.2"
                step_time = "1.75"
            }
            [
                position = 5984, 8268
            ]

            component "core/Step" qref1 {
                execution_rate = "Ts_Control"
                final_value = "-0.3"
                step_time = "2.25"
            }
            [
                position = 5984, 8348
            ]

            component "core/Step" pref2 {
                execution_rate = "Ts_Control"
                final_value = "0.2"
                step_time = "2.75"
            }
            [
                position = 5984, 8416
            ]

            component "core/Step" qref2 {
                execution_rate = "Ts_Control"
                final_value = "-0.1"
                step_time = "3.25"
            }
            [
                position = 5984, 8496
            ]

            component "core/Gain" Gain1 {
                gain = "rad_2_hertz"
            }
            [
                position = 6152, 7728
            ]

            component Subsystem current_ctrl {
                layout = dynamic
                component "core/C function" "C function abc to dq" {
                    arb_defs = "/*Begin code section*/

/*End code section*/"
                    execution_rate = "Ts_Control"
                    input_terminals = "real abc;real theta;"
                    input_terminals_dimensions = "3;1"
                    input_terminals_feedthrough = "True;True"
                    input_terminals_show_labels = "True;True"
                    output_fnc = "/*Begin code section*/
d= 2.0/3.0*(cos(theta)*abc[0] + cos(theta - 2.0/3.0*M_PI)*abc[1]  + cos(theta + 2.0/3.0*M_PI)*abc[2] );
q = 2.0/3.0*(-sin(theta)*abc[0] - sin(theta - 2.0/3.0*M_PI)*abc[1]  - sin(theta + 2.0/3.0*M_PI)*abc[2] );
/*End code section*/"
                    output_terminals = "real d;real q;"
                    output_terminals_dimensions = "1;1"
                    output_terminals_feedthrough = "True;True"
                    output_terminals_show_labels = "True;True"
                }
                [
                    position = 7136, 7852
                    size = 88, 104
                ]

                component "core/Constant" Constant1 {
                    execution_rate = "Ts_Control"
                    value = "0"
                }
                [
                    position = 7004, 7888
                ]

                component "core/C function" "C function abc to dq1" {
                    arb_defs = "/*Begin code section*/

/*End code section*/"
                    execution_rate = "Ts_Control"
                    input_terminals = "real abc;real theta;"
                    input_terminals_dimensions = "3;1"
                    input_terminals_feedthrough = "True;True"
                    input_terminals_show_labels = "True;True"
                    output_fnc = "/*Begin code section*/
d= 2.0/3.0*(cos(theta)*abc[0] + cos(theta - 2.0/3.0*M_PI)*abc[1]  + cos(theta + 2.0/3.0*M_PI)*abc[2] );
q = 2.0/3.0*(-sin(theta)*abc[0] - sin(theta - 2.0/3.0*M_PI)*abc[1]  - sin(theta + 2.0/3.0*M_PI)*abc[2] );
/*End code section*/"
                    output_terminals = "real d;real q;"
                    output_terminals_dimensions = "1;1"
                    output_terminals_feedthrough = "True;True"
                    output_terminals_show_labels = "True;True"
                }
                [
                    position = 7132, 8040
                    size = 88, 104
                ]

                component "core/C function" "C function abc to dq2" {
                    arb_defs = "/*Begin code section*/

/*End code section*/"
                    execution_rate = "Ts_Control"
                    input_terminals = "real abc;real theta;"
                    input_terminals_dimensions = "3;1"
                    input_terminals_feedthrough = "True;True"
                    input_terminals_show_labels = "True;True"
                    output_fnc = "/*Begin code section*/
d= 2.0/3.0*(cos(theta)*abc[0] + cos(theta - 2.0/3.0*M_PI)*abc[1]  + cos(theta + 2.0/3.0*M_PI)*abc[2] );
q = 2.0/3.0*(-sin(theta)*abc[0] - sin(theta - 2.0/3.0*M_PI)*abc[1]  - sin(theta + 2.0/3.0*M_PI)*abc[2] );
/*End code section*/"
                    output_terminals = "real d;real q;"
                    output_terminals_dimensions = "1;1"
                    output_terminals_feedthrough = "True;True"
                    output_terminals_show_labels = "True;True"
                }
                [
                    position = 7128, 8216
                    size = 88, 104
                ]

                component "core/Constant" Constant2 {
                    execution_rate = "Ts_Control"
                    value = "0"
                }
                [
                    position = 7004, 8076
                ]

                component "core/Constant" Constant3 {
                    execution_rate = "Ts_Control"
                    value = "0"
                }
                [
                    position = 7004, 8252
                ]

                component "core/Sum" Sum1 {
                    execution_rate = "Ts_Control"
                    signs = "---"
                }
                [
                    position = 7152, 7740
                ]

                component "core/Bus Split" "Bus Split1" {
                    execution_rate = "Ts_Control"
                    outputs = "3"
                }
                [
                    position = 7064, 7740
                ]

                component "core/Sum" Sum2 {
                    signs = "+-"
                }
                [
                    position = 7524, 7780
                ]

                component "core/Gain" Gain1 {
                    execution_rate = "Ts_Control"
                    gain = "Kp_i"
                }
                [
                    position = 7684, 7732
                ]

                component "core/C function" "C function PLL" {
                    arb_defs = "/*Begin code section*/

/*End code section*/"
                    execution_rate = "Ts_Control"
                    global_variables = "real y_q;real theta;real y_d;"
                    init_fnc = "/*Begin code section*/
y_q = 0;
y_d = 0;
theta = 0;
/*End code section*/"
                    input_terminals = "real abc;"
                    input_terminals_dimensions = "3"
                    input_terminals_feedthrough = "True"
                    input_terminals_show_labels = "False"
                    output_fnc = "/*Begin code section*/
// dq transformation
d= 2.0/3.0*(cos(theta)*abc[0] + cos(theta - 2.0/3.0*M_PI)*abc[1]  + cos(theta + 2.0/3.0*M_PI)*abc[2] );
q = 2.0/3.0*(-sin(theta)*abc[0] - sin(theta - 2.0/3.0*M_PI)*abc[1]  - sin(theta + 2.0/3.0*M_PI)*abc[2] );

//error
//e_q = q;
e_d = d;

//omega
omega_pll = K_p_pll*e_d + y_d;
//theta
theta_pll = theta;
/*End code section*/"
                    output_terminals = "real d;real q;real theta_pll;real omega_pll;real e_q;real e_d;"
                    output_terminals_dimensions = "1;1;1;1;1;1"
                    output_terminals_feedthrough = "True;True;True;True;True;True"
                    output_terminals_show_labels = "False;False;True;True;True;True"
                    parameters = "real K_p_pll;real K_i_pll;real Ts_Control;"
                    update_fnc = "/*Begin code section*/
// Integrator of the PLL
//y_q= y_q + K_i_pll*Ts_Control*e_q;
y_d= y_d + K_i_pll*Ts_Control*e_d;

// Integrator of theta
theta = theta + Ts_Control*omega_pll;
if (theta>=2*M_PI){
    theta = theta - 2*M_PI;
}
if (theta<0.0){
    theta = theta + abs(theta);
}
/*End code section*/"
                }
                [
                    position = 7188, 7464
                    size = 224, 304
                ]

                component "core/Termination" Termination3 {
                }
                [
                    position = 7384, 7536
                ]

                component "core/Termination" Termination4 {
                }
                [
                    position = 7388, 7392
                ]

                component "core/Termination" Termination5 {
                }
                [
                    position = 7388, 7336
                ]

                component "core/Sum" Sum3 {
                }
                [
                    position = 7900, 7792
                ]

                component "core/Sum" Sum4 {
                }
                [
                    position = 8044, 7800
                ]

                component "core/Gain" Gain2 {
                    execution_rate = "Ts_Control"
                    gain = "2"
                }
                [
                    position = 8128, 7800
                ]

                component "core/Product" Product2 {
                    signs = "*/"
                }
                [
                    position = 8332, 7812
                ]

                component "core/Sum" Sum5 {
                    signs = "+-"
                }
                [
                    position = 7524, 8048
                ]

                component "core/Gain" Gain3 {
                    execution_rate = "Ts_Control"
                    gain = "Kp_i"
                }
                [
                    position = 7684, 8000
                ]

                component "core/Sum" Sum6 {
                    execution_rate = "Ts_Control"
                }
                [
                    position = 7900, 8060
                ]

                component "core/Sum" Sum7 {
                }
                [
                    position = 8044, 8068
                ]

                component "core/Gain" Gain4 {
                    execution_rate = "Ts_Control"
                    gain = "2"
                }
                [
                    position = 8128, 8068
                ]

                component "core/Product" Product3 {
                    execution_rate = "Ts_Control"
                    signs = "*/"
                }
                [
                    position = 8332, 8080
                ]

                component "core/Sum" Sum8 {
                    signs = "+-"
                }
                [
                    position = 7556, 8308
                ]

                component "core/Gain" Gain5 {
                    execution_rate = "Ts_Control"
                    gain = "Kp_i"
                }
                [
                    position = 7716, 8260
                ]

                component "core/Sum" Sum9 {
                    execution_rate = "Ts_Control"
                }
                [
                    position = 7932, 8320
                ]

                component "core/Gain" Gain6 {
                    execution_rate = "Ts_Control"
                    gain = "2"
                }
                [
                    position = 8096, 8320
                ]

                component "core/Product" Product4 {
                    execution_rate = "Ts_Control"
                    signs = "*/"
                }
                [
                    position = 8300, 8332
                ]

                component "core/Bus Join" "Bus Join1" {
                }
                [
                    position = 8676, 7852
                ]

                component "core/Probe" is_n_ref {
                    execution_rate = "Ts_Control"
                    signal_access = "Inherit"
                }
                [
                    position = 7308, 7700
                ]

                component Subsystem Subsystem6 {
                    layout = dynamic
                    component "core/Gain" Gain1 {
                        gain = "Kr_i"
                    }
                    [
                        position = 8068, 8120
                    ]

                    component "core/Discrete Transfer Function" "Discrete Transfer Function2" {
                        a_coeff = "[1,-1]"
                        b_coeff = "[Ts_Control,0]"
                        execution_rate = "Ts_Control"
                    }
                    [
                        position = 8328, 8260
                        rotation = down
                    ]

                    component "core/Product" Product1 {
                        signs = "3"
                    }
                    [
                        position = 8440, 8260
                        rotation = down
                    ]

                    component "core/Sum" Sum1 {
                        signs = "+-"
                    }
                    [
                        position = 8200, 8132
                    ]

                    component "core/Integrator" Integrator1 {
                        show_reset = "rising"
                    }
                    [
                        position = 8324, 8132
                    ]

                    component "core/Step" Step1 {
                        execution_rate = "Ts_Control"
                        step_time = "T_on_contactor"
                    }
                    [
                        position = 8248, 8192
                    ]

                    port omega {
                        position = left:2
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 8528, 8280
                        rotation = down
                    ]

                    port error {
                        position = left:1
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 8000, 8120
                    ]

                    port Out1 {
                        position = auto:auto
                        kind = sp
                        direction =  in
                        sp_type {
                            default = inherit
                            readonly = True
                        }
                    }
                    [
                        position = 8568, 8132
                    ]

                    junction Junction1 sp
                    [
                        position = 8488, 8276
                    ]

                    junction Junction2 sp
                    [
                        position = 8484, 8128
                    ]

                    connect Product1.in Junction1 as Connection963
                    connect Junction1 omega as Connection964
                    connect Product1.in1 Junction1 as Connection965
                    connect error Gain1.in as Connection969
                    connect Gain1.out Sum1.in as Connection970
                    connect Product1.out "Discrete Transfer Function2.in" as Connection957
                    connect "Discrete Transfer Function2.out" Sum1.in1 as Connection959
                    connect Integrator1.in Sum1.out as Connection982
                    connect Product1.in2 Junction2 as Connection983
                    connect Junction2 Out1 as Connection984
                    [
                        breakpoints = 8484, 8132
                    ]
                    connect Integrator1.out Junction2 as Connection985
                    connect Step1.out Integrator1.reset as Connection986
                }
                [
                    position = 7728, 7876
                    size = 128, 80
                ]

                component Subsystem Subsystem7 {
                    layout = dynamic
                    component "core/Gain" Gain1 {
                        gain = "Kr_i"
                    }
                    [
                        position = 8068, 8120
                    ]

                    component "core/Discrete Transfer Function" "Discrete Transfer Function2" {
                        a_coeff = "[1,-1]"
                        b_coeff = "[Ts_Control,0]"
                        execution_rate = "Ts_Control"
                    }
                    [
                        position = 8328, 8260
                        rotation = down
                    ]

                    component "core/Product" Product1 {
                        signs = "3"
                    }
                    [
                        position = 8440, 8260
                        rotation = down
                    ]

                    component "core/Sum" Sum1 {
                        signs = "+-"
                    }
                    [
                        position = 8200, 8132
                    ]

                    component "core/Integrator" Integrator1 {
                        show_reset = "rising"
                    }
                    [
                        position = 8324, 8132
                    ]

                    component "core/Step" Step1 {
                        execution_rate = "Ts_Control"
                        step_time = "T_on_contactor"
                    }
                    [
                        position = 8248, 8192
                    ]

                    port omega {
                        position = left:2
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 8528, 8280
                        rotation = down
                    ]

                    port error {
                        position = left:1
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 8000, 8120
                    ]

                    port Out1 {
                        position = auto:auto
                        kind = sp
                        direction =  in
                        sp_type {
                            default = inherit
                            readonly = True
                        }
                    }
                    [
                        position = 8568, 8132
                    ]

                    junction Junction1 sp
                    [
                        position = 8488, 8276
                    ]

                    junction Junction2 sp
                    [
                        position = 8484, 8128
                    ]

                    connect Product1.in Junction1 as Connection963
                    connect Junction1 omega as Connection964
                    connect Product1.in1 Junction1 as Connection965
                    connect error Gain1.in as Connection969
                    connect Gain1.out Sum1.in as Connection970
                    connect Product1.out "Discrete Transfer Function2.in" as Connection957
                    connect "Discrete Transfer Function2.out" Sum1.in1 as Connection959
                    connect Integrator1.in Sum1.out as Connection982
                    connect Product1.in2 Junction2 as Connection983
                    connect Junction2 Out1 as Connection984
                    [
                        breakpoints = 8484, 8132
                    ]
                    connect Integrator1.out Junction2 as Connection985
                    connect Step1.out Integrator1.reset as Connection986
                }
                [
                    position = 7724, 8120
                    size = 128, 80
                ]

                component Subsystem Subsystem8 {
                    layout = dynamic
                    component "core/Gain" Gain1 {
                        gain = "Kr_i"
                    }
                    [
                        position = 8068, 8120
                    ]

                    component "core/Discrete Transfer Function" "Discrete Transfer Function2" {
                        a_coeff = "[1,-1]"
                        b_coeff = "[Ts_Control,0]"
                        execution_rate = "Ts_Control"
                    }
                    [
                        position = 8328, 8260
                        rotation = down
                    ]

                    component "core/Product" Product1 {
                        signs = "3"
                    }
                    [
                        position = 8440, 8260
                        rotation = down
                    ]

                    component "core/Sum" Sum1 {
                        signs = "+-"
                    }
                    [
                        position = 8200, 8132
                    ]

                    component "core/Integrator" Integrator1 {
                        show_reset = "rising"
                    }
                    [
                        position = 8324, 8132
                    ]

                    component "core/Step" Step1 {
                        execution_rate = "Ts_Control"
                        step_time = "T_on_contactor"
                    }
                    [
                        position = 8248, 8192
                    ]

                    port omega {
                        position = left:2
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 8528, 8280
                        rotation = down
                    ]

                    port error {
                        position = left:1
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 8000, 8120
                    ]

                    port Out1 {
                        position = auto:auto
                        kind = sp
                        direction =  in
                        sp_type {
                            default = inherit
                            readonly = True
                        }
                    }
                    [
                        position = 8568, 8132
                    ]

                    junction Junction1 sp
                    [
                        position = 8488, 8276
                    ]

                    junction Junction2 sp
                    [
                        position = 8484, 8128
                    ]

                    connect Product1.in Junction1 as Connection963
                    connect Junction1 omega as Connection964
                    connect Product1.in1 Junction1 as Connection965
                    connect error Gain1.in as Connection969
                    connect Gain1.out Sum1.in as Connection970
                    connect Product1.out "Discrete Transfer Function2.in" as Connection957
                    connect "Discrete Transfer Function2.out" Sum1.in1 as Connection959
                    connect Integrator1.in Sum1.out as Connection982
                    connect Product1.in2 Junction2 as Connection983
                    connect Junction2 Out1 as Connection984
                    [
                        breakpoints = 8484, 8132
                    ]
                    connect Integrator1.out Junction2 as Connection985
                    connect Step1.out Integrator1.reset as Connection986
                }
                [
                    position = 7724, 8396
                    size = 128, 80
                ]

                component "core/Probe" is_al_ref {
                    execution_rate = "Ts_Control"
                    signal_access = "Inherit"
                }
                [
                    position = 7324, 7776
                ]

                component "core/Probe" is_be_ref {
                    execution_rate = "Ts_Control"
                    signal_access = "Inherit"
                }
                [
                    position = 7308, 7856
                ]

                component "core/Probe" is_al {
                    execution_rate = "Ts_Control"
                    signal_access = "Inherit"
                }
                [
                    position = 7320, 7944
                ]

                component "core/Probe" is_be {
                    execution_rate = "Ts_Control"
                    signal_access = "Inherit"
                }
                [
                    position = 7308, 8036
                ]

                port is_abc_ref {
                    position = left:1
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 6964, 7816
                ]

                port eta_albe {
                    position = right:1
                    kind = sp
                    direction =  in
                    sp_type {
                        default = inherit
                        readonly = True
                    }
                }
                [
                    position = 8804, 7852
                ]

                port is_abc {
                    position = left:2
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 6960, 8004
                ]

                port vs_abc {
                    position = left:3
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 6716, 8180
                ]

                port eta_n {
                    position = right:2
                    kind = sp
                    direction =  in
                    sp_type {
                        default = inherit
                        readonly = True
                    }
                }
                [
                    position = 8808, 7936
                ]

                port is_n {
                    position = left:4
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 7432, 8344
                ]

                port theta {
                    position = right:3
                    kind = sp
                    direction =  in
                    sp_type {
                        default = inherit
                        readonly = True
                    }
                }
                [
                    position = 8792, 8060
                ]

                port omega {
                    position = right:4
                    kind = sp
                    direction =  in
                    sp_type {
                        default = inherit
                        readonly = True
                    }
                }
                [
                    position = 8788, 8152
                ]

                tag Goto46 {
                    value = "is_n_ref"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 7244, 7740
                    hide_name = True
                    size = 60, 20
                ]

                tag Goto47 {
                    value = "is_al_ref"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 7244, 7816
                    hide_name = True
                    size = 60, 20
                ]

                tag Goto48 {
                    value = "is_be_ref"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 7244, 7888
                    hide_name = True
                    size = 60, 20
                ]

                tag Goto49 {
                    value = "is_al"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 7240, 8004
                    hide_name = True
                    size = 60, 20
                ]

                tag Goto50 {
                    value = "is_be"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 7236, 8076
                    hide_name = True
                    size = 60, 20
                ]

                tag Goto51 {
                    value = "vs_al"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 7236, 8180
                    hide_name = True
                    size = 60, 20
                ]

                tag Goto52 {
                    value = "vs_be"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 7232, 8252
                    hide_name = True
                    size = 60, 20
                ]

                tag From134 {
                    value = "is_al_ref"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 7404, 7772
                    rotation = down
                    hide_name = True
                    scale = -1, 1
                    size = 60, 20
                ]

                tag From135 {
                    value = "is_al"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 7396, 7808
                    rotation = down
                    hide_name = True
                    scale = -1, 1
                    size = 60, 20
                ]

                tag Goto36 {
                    value = "omega"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 7380, 7488
                    hide_name = True
                    size = 60, 20
                ]

                tag From136 {
                    value = "omega"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 7568, 7900
                    rotation = down
                    hide_name = True
                    scale = -1, 1
                    size = 60, 20
                ]

                tag From137 {
                    value = "vs_al"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 7948, 7864
                    rotation = down
                    hide_name = True
                    scale = -1, 1
                    size = 60, 20
                ]

                tag From101 {
                    value = "v_dc"
                    scope = global
                    kind = sp
                    direction = out
                }
                [
                    position = 8204, 7884
                    rotation = down
                    hide_name = True
                    scale = -1, 1
                    size = 60, 20
                ]

                tag Goto53 {
                    value = "eta_al"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 8436, 7816
                    hide_name = True
                    size = 60, 20
                ]

                tag From138 {
                    value = "is_be_ref"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 7404, 8040
                    rotation = down
                    hide_name = True
                    scale = -1, 1
                    size = 60, 20
                ]

                tag From139 {
                    value = "is_be"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 7396, 8076
                    rotation = down
                    hide_name = True
                    scale = -1, 1
                    size = 60, 20
                ]

                tag From140 {
                    value = "omega"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 7568, 8156
                    rotation = down
                    hide_name = True
                    scale = -1, 1
                    size = 60, 20
                ]

                tag From141 {
                    value = "vs_be"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 7948, 8132
                    rotation = down
                    hide_name = True
                    scale = -1, 1
                    size = 60, 20
                ]

                tag From142 {
                    value = "v_dc"
                    scope = global
                    kind = sp
                    direction = out
                }
                [
                    position = 8204, 8152
                    rotation = down
                    hide_name = True
                    scale = -1, 1
                    size = 60, 20
                ]

                tag Goto54 {
                    value = "eta_be"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 8436, 8084
                    hide_name = True
                    size = 60, 20
                ]

                tag From143 {
                    value = "is_n_ref"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 7436, 8300
                    rotation = down
                    hide_name = True
                    scale = -1, 1
                    size = 60, 20
                ]

                tag From145 {
                    value = "omega"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 7600, 8416
                    rotation = down
                    hide_name = True
                    scale = -1, 1
                    size = 60, 20
                ]

                tag From147 {
                    value = "v_dc"
                    scope = global
                    kind = sp
                    direction = out
                }
                [
                    position = 8140, 8400
                    rotation = down
                    hide_name = True
                    scale = -1, 1
                    size = 60, 20
                ]

                tag Goto55 {
                    value = "eta_n"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 8404, 8336
                    hide_name = True
                    size = 60, 20
                ]

                tag From148 {
                    value = "eta_al"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8540, 7828
                    rotation = down
                    hide_name = True
                    scale = -1, 1
                    size = 60, 20
                ]

                tag From149 {
                    value = "eta_be"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8540, 7884
                    rotation = down
                    hide_name = True
                    scale = -1, 1
                    size = 60, 20
                ]

                tag From150 {
                    value = "eta_n"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8644, 7952
                    rotation = down
                    hide_name = True
                    scale = -1, 1
                    size = 60, 20
                ]

                tag Goto56 {
                    value = "theta"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 7380, 7440
                    hide_name = True
                    size = 60, 20
                ]

                tag From151 {
                    value = "theta"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8680, 8060
                    rotation = down
                    hide_name = True
                    scale = -1, 1
                    size = 60, 20
                ]

                tag From152 {
                    value = "omega"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8676, 8152
                    rotation = down
                    hide_name = True
                    scale = -1, 1
                    size = 60, 20
                ]

                junction Junction1 sp
                [
                    position = 7004, 7816
                ]

                junction Junction188 sp
                [
                    position = 6800, 8180
                ]

                junction Junction192 sp
                [
                    position = 7196, 7740
                ]

                junction Junction194 sp
                [
                    position = 7564, 7780
                ]

                junction Junction195 sp
                [
                    position = 7564, 8048
                ]

                junction Junction196 sp
                [
                    position = 7596, 8304
                ]

                junction Junction197 sp
                [
                    position = 7204, 7816
                ]

                junction Junction198 sp
                [
                    position = 7192, 7888
                ]

                junction Junction199 sp
                [
                    position = 7192, 8004
                ]

                junction Junction200 sp
                [
                    position = 7188, 8076
                ]

                connect Constant1.out "C function abc to dq.theta" as Connection2
                connect is_abc "C function abc to dq1.abc" as Connection3
                connect Constant2.out "C function abc to dq1.theta" as Connection5
                connect Constant3.out "C function abc to dq2.theta" as Connection6
                connect "Bus Split1.out" Sum1.in as Connection7
                connect "Bus Split1.out1" Sum1.in1 as Connection8
                connect "Bus Split1.out2" Sum1.in2 as Connection9
                connect is_abc_ref Junction1 as Connection10
                connect Junction1 "C function abc to dq.abc" as Connection11
                connect "Bus Split1.in" Junction1 as Connection12
                connect Goto51 "C function abc to dq2.d" as Connection18
                connect Goto52 "C function abc to dq2.q" as Connection19
                connect From134 Sum2.in as Connection20
                connect From135 Sum2.in1 as Connection21
                connect "C function PLL.e_q" Termination3.in as Connection497
                connect Goto36 "C function PLL.omega_pll" as Connection502
                connect vs_abc Junction188 as Connection524
                connect Junction188 "C function abc to dq2.abc" as Connection525
                connect "C function PLL.abc" Junction188 as Connection526
                connect Termination4.in "C function PLL.q" as Connection527
                connect Termination5.in "C function PLL.d" as Connection528
                connect Sum3.in Gain1.out as Connection531
                connect Sum3.out Sum4.in as Connection533
                connect From137 Sum4.in1 as Connection534
                connect Gain2.in Sum4.out as Connection535
                connect From101 Product2.in1 as Connection832
                connect Gain2.out Product2.in as Connection833
                connect Goto53 Product2.out as Connection834
                connect From138 Sum5.in as Connection835
                connect From139 Sum5.in1 as Connection836
                connect Sum6.in Gain3.out as Connection841
                connect Sum6.out Sum7.in as Connection843
                connect From141 Sum7.in1 as Connection844
                connect Gain4.in Sum7.out as Connection845
                connect From142 Product3.in1 as Connection846
                connect Gain4.out Product3.in as Connection847
                connect Goto54 Product3.out as Connection848
                connect From143 Sum8.in as Connection849
                connect Sum9.in Gain5.out as Connection855
                connect From147 Product4.in1 as Connection860
                connect Gain6.out Product4.in as Connection861
                connect Goto55 Product4.out as Connection862
                connect Gain6.in Sum9.out as Connection863
                connect From148 "Bus Join1.in" as Connection864
                connect From149 "Bus Join1.in1" as Connection865
                connect eta_albe "Bus Join1.out" as Connection866
                connect From150 eta_n as Connection867
                connect is_n Sum8.in1 as Connection868
                connect "C function PLL.theta_pll" Goto56 as Connection881
                connect From151 theta as Connection882
                connect Goto46 Junction192 as Connection883
                connect Junction192 Sum1.out as Connection884
                connect is_n_ref.in Junction192 as Connection885
                connect Subsystem6.Out1 Sum3.in1 as Connection893
                connect From136 Subsystem6.omega as Connection894
                connect Sum2.out Junction194 as Connection895
                connect Junction194 Gain1.in as Connection896
                [
                    breakpoints = 7564, 7780
                ]
                connect Subsystem6.error Junction194 as Connection897
                connect Sum5.out Junction195 as Connection900
                connect Junction195 Gain3.in as Connection901
                [
                    breakpoints = 7564, 8048; 7564, 8044
                ]
                connect Subsystem7.error Junction195 as Connection902
                connect From140 Subsystem7.omega as Connection903
                [
                    breakpoints = 7652, 8148
                ]
                connect Subsystem7.Out1 Sum6.in1 as Connection904
                connect Subsystem8.Out1 Sum9.in1 as Connection905
                connect Gain5.in Junction196 as Connection906
                connect Junction196 Sum8.out as Connection907
                [
                    breakpoints = 7596, 8308
                ]
                connect Subsystem8.error Junction196 as Connection908
                connect From145 Subsystem8.omega as Connection909
                connect From152 omega as Connection910
                connect Goto47 Junction197 as Connection911
                connect Junction197 "C function abc to dq.d" as Connection912
                connect is_al_ref.in Junction197 as Connection913
                connect Goto48 Junction198 as Connection914
                connect Junction198 "C function abc to dq.q" as Connection915
                connect is_be_ref.in Junction198 as Connection916
                connect Goto49 Junction199 as Connection917
                connect Junction199 "C function abc to dq1.d" as Connection918
                connect is_al.in Junction199 as Connection919
                connect Goto50 Junction200 as Connection920
                connect Junction200 "C function abc to dq1.q" as Connection921
                connect is_be.in Junction200 as Connection922
            }
            [
                position = 7568, 7812
                size = 168, 448
            ]

            component "core/Bus Join" "Bus Join10" {
                execution_rate = "Ts_Control"
                inputs = "3"
            }
            [
                position = 7396, 7604
            ]

            component "core/Bus Join" "Bus Join11" {
                execution_rate = "Ts_Control"
                inputs = "3"
            }
            [
                position = 7396, 7748
            ]

            component "core/Bus Join" "Bus Join12" {
                execution_rate = "Ts_Control"
                inputs = "3"
            }
            [
                position = 7392, 7880
            ]

            component "core/C function" "C function dq to abc1" {
                arb_defs = "/*Begin code section*/

/*End code section*/"
                execution_rate = "Ts_Control"
                init_fnc = "/*Begin code section*/

/*End code section*/"
                input_terminals = "real dq;real theta;"
                input_terminals_dimensions = "2;1"
                input_terminals_feedthrough = "True;True"
                input_terminals_show_labels = "True;True"
                output_fnc = "/*Begin code section*/
a= cos(theta)*dq[0] - sin(theta)*dq[1];
b= cos(theta -2.0/3.0*M_PI)*dq[0]  - sin(theta-2.0/3.0*M_PI)*dq[1];
c= cos(theta +2.0/3.0*M_PI)*dq[0] - sin(theta+2.0/3.0*M_PI)*dq[1];
/*End code section*/"
                output_terminals = "real a;real b;real c;"
                output_terminals_dimensions = "1;1;1"
                output_terminals_feedthrough = "True;True;True"
                output_terminals_show_labels = "True;True;True"
                update_fnc = "/*Begin code section*/

/*End code section*/"
            }
            [
                position = 7864, 7668
                size = 176, 152
            ]

            component "core/Constant" Constant1 {
                execution_rate = "Ts_Control"
                value = "0"
            }
            [
                position = 7712, 7728
            ]

            component "core/Bus Join" "Bus Join13" {
                inputs = "3"
            }
            [
                position = 8052, 7668
            ]

            component "core/Probe" eta_a {
                execution_rate = "Ts_Control"
                signal_access = "Inherit"
            }
            [
                position = 8236, 7592
            ]

            component "core/Probe" eta_b {
                execution_rate = "Ts_Control"
                signal_access = "Inherit"
            }
            [
                position = 8244, 7760
            ]

            component "core/Probe" eta_c {
                execution_rate = "Ts_Control"
                signal_access = "Inherit"
            }
            [
                position = 8088, 7792
            ]

            component "core/Probe" etan {
                execution_rate = "Ts_Control"
                signal_access = "Inherit"
            }
            [
                position = 7840, 7784
            ]

            component "core/Scope" eta_abcn {
                selected_signals = "[\'Controller.eta_a\', \'Controller.eta_b\', \'Controller.eta_c\', \'Controller.etan\']"
                signals_data = "{\"signals\": {\"Controller.eta_a\": {\"viewports\": [1], \"type\": \"analog\", \"color\": {\"1\": \"#00CC00\"}, \"display\": {\"1\": \"solid\"}}, \"Controller.eta_b\": {\"viewports\": [1], \"type\": \"analog\", \"color\": {\"1\": \"#0099FF\"}, \"display\": {\"1\": \"solid\"}}, \"Controller.eta_c\": {\"viewports\": [1], \"type\": \"analog\", \"color\": {\"1\": \"#FFCC00\"}, \"display\": {\"1\": \"solid\"}}, \"Controller.etan\": {\"viewports\": [1], \"type\": \"analog\", \"color\": {\"1\": \"#FF0000\"}, \"display\": {\"1\": \"solid\"}}}, \"viewports\": {\"1\": {\"log_scale_x\": false, \"log_scale_y\": false, \"y_axis_db\": false}, \"2\": {\"log_scale_x\": false, \"log_scale_y\": false, \"y_axis_db\": false}, \"3\": {\"log_scale_x\": false, \"log_scale_y\": false, \"y_axis_db\": false}, \"4\": {\"log_scale_x\": false, \"log_scale_y\": false, \"y_axis_db\": false}}, \"plot_settings\": {\"layout\": \"Vertical\", \"background_color\": \"white\", \"legend_visible\": true}}"
            }
            [
                position = 8192, 7868
            ]

            component "core/C function" "C function1" {
                arb_defs = "/*Begin code section*/

/*End code section*/"
                execution_rate = "Ts_Control"
                init_fnc = "/*Begin code section*/

/*End code section*/"
                input_terminals = "real is_albe_ref;"
                input_terminals_dimensions = "2"
                input_terminals_feedthrough = "True"
                input_terminals_show_labels = "True"
                output_fnc = "/*Begin code section*/
is_ref=cos(0)*is_albe_ref[0] - sin(0)*is_albe_ref[1];
/*End code section*/"
                output_terminals = "real is_ref;"
                output_terminals_dimensions = "1"
                output_terminals_feedthrough = "True"
                output_terminals_show_labels = "True"
                update_fnc = "/*Begin code section*/

/*End code section*/"
            }
            [
                position = 7480, 8280
                size = 152, 104
            ]

            component "core/Gain" Gain2 {
                gain = "3"
            }
            [
                position = 6712, 7676
            ]

            component "core/Gain" Gain3 {
                gain = "3"
            }
            [
                position = 6712, 7724
            ]

            component "core/Gain" Gain4 {
                gain = "3"
            }
            [
                position = 6712, 7972
            ]

            component "core/Gain" Gain5 {
                gain = "3"
            }
            [
                position = 6704, 8032
            ]

            component "core/Gain" Gain6 {
                gain = "3"
            }
            [
                position = 6720, 8224
            ]

            component "core/Gain" Gain7 {
                gain = "3"
            }
            [
                position = 6720, 8272
            ]

            component "core/Scope" omega_vsg_abc_pll {
                selected_signals = "[\'Controller.omega_vsg_a\', \'Controller.omega_vsg_b\', \'Controller.omega_vsg_c\', \'Controller.omega_pll\']"
                signals_data = "{\"signals\": {\"Controller.omega_vsg_a\": {\"viewports\": [1], \"type\": \"analog\", \"color\": {\"1\": \"#00CC00\"}, \"display\": {\"1\": \"solid\"}}, \"Controller.omega_vsg_b\": {\"viewports\": [1], \"type\": \"analog\", \"color\": {\"1\": \"#0099FF\"}, \"display\": {\"1\": \"solid\"}}, \"Controller.omega_vsg_c\": {\"viewports\": [1], \"type\": \"analog\", \"color\": {\"1\": \"#FFCC00\"}, \"display\": {\"1\": \"solid\"}}, \"Controller.omega_pll\": {\"viewports\": [1], \"type\": \"analog\", \"color\": {\"1\": \"#FF0000\"}, \"display\": {\"1\": \"solid\"}}}, \"viewports\": {\"1\": {\"log_scale_x\": false, \"log_scale_y\": false, \"y_axis_db\": false}, \"2\": {\"log_scale_x\": false, \"log_scale_y\": false, \"y_axis_db\": false}, \"3\": {\"log_scale_x\": false, \"log_scale_y\": false, \"y_axis_db\": false}, \"4\": {\"log_scale_x\": false, \"log_scale_y\": false, \"y_axis_db\": false}}, \"plot_settings\": {\"layout\": \"Vertical\", \"background_color\": \"white\", \"legend_visible\": true}}"
            }
            [
                position = 7148, 7468
            ]

            component "core/Probe" omega_vsg_a {
                execution_rate = "Ts_Control"
                signal_access = "Inherit"
            }
            [
                position = 7108, 7588
            ]

            component "core/Probe" omega_vsg_b {
                execution_rate = "Ts_Control"
                signal_access = "Inherit"
            }
            [
                position = 7112, 7884
            ]

            component "core/Probe" omega_vsg_c {
                execution_rate = "Ts_Control"
                signal_access = "Inherit"
            }
            [
                position = 7140, 8116
            ]

            component "core/Probe" omega_pll {
                execution_rate = "Ts_Control"
                signal_access = "Inherit"
            }
            [
                position = 7868, 7948
            ]

            component "core/C function" "C function2" {
                arb_defs = "/*Begin code section*/

/*End code section*/"
                execution_rate = "Ts_Control"
                init_fnc = "/*Begin code section*/

/*End code section*/"
                input_terminals = "real is_albe_ref;"
                input_terminals_dimensions = "2"
                input_terminals_feedthrough = "True"
                input_terminals_show_labels = "True"
                output_fnc = "/*Begin code section*/
is_ref=cos(0)*is_albe_ref[0] - sin(0)*is_albe_ref[1];
/*End code section*/"
                output_terminals = "real is_ref;"
                output_terminals_dimensions = "1"
                output_terminals_feedthrough = "True"
                output_terminals_show_labels = "True"
                update_fnc = "/*Begin code section*/

/*End code section*/"
            }
            [
                position = 7460, 8444
                size = 152, 104
            ]

            component "core/C function" "C function3" {
                arb_defs = "/*Begin code section*/

/*End code section*/"
                execution_rate = "Ts_Control"
                init_fnc = "/*Begin code section*/

/*End code section*/"
                input_terminals = "real is_albe_ref;"
                input_terminals_dimensions = "2"
                input_terminals_feedthrough = "True"
                input_terminals_show_labels = "True"
                output_fnc = "/*Begin code section*/
is_ref=cos(0)*is_albe_ref[0] - sin(0)*is_albe_ref[1];
/*End code section*/"
                output_terminals = "real is_ref;"
                output_terminals_dimensions = "1"
                output_terminals_feedthrough = "True"
                output_terminals_show_labels = "True"
                update_fnc = "/*Begin code section*/

/*End code section*/"
            }
            [
                position = 7460, 8592
                size = 152, 104
            ]

            component "core/Gain" Gain8 {
                gain = "rad_2_hertz"
            }
            [
                position = 6176, 7772
            ]

            component "core/Gain" Gain9 {
                gain = "rad_2_hertz"
            }
            [
                position = 6068, 7828
            ]

            component "core/Unit Delay" "Unit Delay1" {
            }
            [
                position = 5900, 7712
            ]

            component "core/Unit Delay" "Unit Delay2" {
            }
            [
                position = 5812, 7812
            ]

            component "core/Unit Delay" "Unit Delay3" {
            }
            [
                position = 5732, 7988
            ]

            component "core/Probe" is_a_al {
            }
            [
                position = 6900, 7416
            ]

            component "core/Bus Split" "Bus Split1" {
            }
            [
                position = 6764, 7440
            ]

            component "core/Probe" is_b_al {
            }
            [
                position = 6904, 7504
            ]

            component "core/Probe" vs_a_al {
            }
            [
                position = 6412, 7352
            ]

            component "core/Bus Split" "Bus Split2" {
            }
            [
                position = 6276, 7376
            ]

            component "core/Probe" vs_a_be {
            }
            [
                position = 6416, 7440
            ]

            component Subsystem VSG_b {
                layout = dynamic
                component "core/Bus Join" "Bus Join11" {
                    execution_rate = "Ts_Control"
                }
                [
                    position = 8432, 8192
                ]

                component "core/Bus Join" "Bus Join14" {
                    execution_rate = "Ts_Control"
                }
                [
                    position = 8452, 8292
                ]

                component "core/C function" "C function dq to abc" {
                    arb_defs = "/*Begin code section*/

/*End code section*/"
                    execution_rate = "Ts_Control"
                    init_fnc = "/*Begin code section*/

/*End code section*/"
                    input_terminals = "real dq;real theta;"
                    input_terminals_dimensions = "2;1"
                    input_terminals_feedthrough = "True;True"
                    input_terminals_show_labels = "True;True"
                    output_fnc = "/*Begin code section*/
a= cos(theta)*dq[0] - sin(theta)*dq[1];
b= cos(theta -2.0/3.0*M_PI)*dq[0]  - sin(theta-2.0/3.0*M_PI)*dq[1];
c= cos(theta +2.0/3.0*M_PI)*dq[0] - sin(theta+2.0/3.0*M_PI)*dq[1];
/*End code section*/"
                    output_terminals = "real a;real b;real c;"
                    output_terminals_dimensions = "1;1;1"
                    output_terminals_feedthrough = "True;True;True"
                    output_terminals_show_labels = "True;True;True"
                    update_fnc = "/*Begin code section*/

/*End code section*/"
                }
                [
                    position = 8816, 8052
                    size = 152, 96
                ]

                component "core/C function" "C function abc to dq" {
                    arb_defs = "/*Begin code section*/

/*End code section*/"
                    execution_rate = "Ts_Control"
                    input_terminals = "real abc;real theta;"
                    input_terminals_dimensions = "3;1"
                    input_terminals_feedthrough = "True;True"
                    input_terminals_show_labels = "True;True"
                    output_fnc = "/*Begin code section*/
d= 2.0/3.0*(cos(theta)*abc[0] + cos(theta - 2.0/3.0*M_PI)*abc[1]  + cos(theta + 2.0/3.0*M_PI)*abc[2] );
q = 2.0/3.0*(-sin(theta)*abc[0] - sin(theta - 2.0/3.0*M_PI)*abc[1]  - sin(theta + 2.0/3.0*M_PI)*abc[2] );
/*End code section*/"
                    output_terminals = "real d;real q;"
                    output_terminals_dimensions = "1;1"
                    output_terminals_feedthrough = "True;True"
                    output_terminals_show_labels = "True;True"
                }
                [
                    position = 9200, 8100
                    size = 176, 152
                ]

                component "core/Bus Join" "Bus Join15" {
                    execution_rate = "Ts_Control"
                    inputs = "3"
                }
                [
                    position = 8960, 8056
                ]

                component "core/Constant" Constant1 {
                    execution_rate = "Ts_Control"
                    value = "0"
                }
                [
                    position = 9020, 8144
                ]

                component "core/Bus Join" "Bus Join16" {
                    execution_rate = "Ts_Control"
                }
                [
                    position = 9364, 8096
                ]

                component "core/Signal switch" "Signal switch1" {
                    execution_rate = "Ts_Control"
                }
                [
                    position = 7788, 8340
                ]

                component "core/Constant" Constant2 {
                    execution_rate = "Ts_Control"
                }
                [
                    position = 7652, 8312
                ]

                component "core/Step" Step1 {
                    execution_rate = "Ts_Control"
                    step_time = "T_on_vsg"
                }
                [
                    position = 7492, 8264
                ]

                component "core/Gain" Gain1 {
                    execution_rate = "Ts_Control"
                    gain = "1/omega_base_rads"
                }
                [
                    position = 7512, 8416
                ]

                component "core/Probe" is_al_ref {
                }
                [
                    position = 9416, 7968
                ]

                component "core/Probe" is_be_ref {
                }
                [
                    position = 9460, 8208
                ]

                component "core/Probe" e {
                }
                [
                    position = 8700, 7928
                ]

                component "core/Probe" is_d {
                }
                [
                    position = 8632, 8148
                ]

                component "core/Probe" is_q {
                }
                [
                    position = 8616, 8252
                ]

                component "core/Probe" vs_d {
                }
                [
                    position = 8580, 8360
                ]

                component "core/Probe" vs_q {
                }
                [
                    position = 8420, 8396
                ]

                component "core/Bus Split" "Bus Split2" {
                }
                [
                    position = 8440, 7720
                ]

                component "core/Probe" is_d_ref {
                }
                [
                    position = 8584, 7616
                ]

                component "core/Probe" is_q_ref {
                }
                [
                    position = 8568, 7720
                ]

                component "core/C function" "C function PLL" {
                    arb_defs = "/*Begin code section*/

/*End code section*/"
                    execution_rate = "Ts_Control"
                    global_variables = "real y_q;real theta;real y_d;"
                    init_fnc = "/*Begin code section*/
y_q = 0;
y_d = 0;
theta = 0;
/*End code section*/"
                    input_terminals = "real abc;"
                    input_terminals_dimensions = "3"
                    input_terminals_feedthrough = "True"
                    input_terminals_show_labels = "True"
                    output_fnc = "/*Begin code section*/
// dq transformation
d= 2.0/3.0*(cos(theta)*abc[0] + cos(theta - 2.0/3.0*M_PI)*abc[1]  + cos(theta + 2.0/3.0*M_PI)*abc[2] );
q = 2.0/3.0*(-sin(theta)*abc[0] - sin(theta - 2.0/3.0*M_PI)*abc[1]  - sin(theta + 2.0/3.0*M_PI)*abc[2] );

//error
//e_q = q;
e_d = d;

//omega
omega_pll = K_p_pll*e_d + y_d;
//theta
theta_pll = theta;
/*End code section*/"
                    output_terminals = "real d;real q;real theta_pll;real omega_pll;real e_q;real e_d;"
                    output_terminals_dimensions = "1;1;1;1;1;1"
                    output_terminals_feedthrough = "True;True;True;True;True;True"
                    output_terminals_show_labels = "False;False;True;True;True;True"
                    parameters = "real K_p_pll;real K_i_pll;real Ts_Control;"
                    update_fnc = "/*Begin code section*/
// Integrator of the PLL
//y_q= y_q + K_i_pll*Ts_Control*e_q;
y_d= y_d + K_i_pll*Ts_Control*e_d;

// Integrator of theta
theta = theta + Ts_Control*omega_pll;
if (theta>=2*M_PI){
    theta = theta - 2*M_PI;
}
if (theta<0.0){
    theta = theta + abs(theta);
}
/*End code section*/"
                }
                [
                    position = 7736, 7804
                    size = 224, 304
                ]

                component "core/C function" "C function dq to abc1" {
                    arb_defs = "/*Begin code section*/

/*End code section*/"
                    execution_rate = "Ts_Control"
                    init_fnc = "/*Begin code section*/

/*End code section*/"
                    input_terminals = "real dq;real theta;"
                    input_terminals_dimensions = "2;1"
                    input_terminals_feedthrough = "True;True"
                    input_terminals_show_labels = "True;True"
                    output_fnc = "/*Begin code section*/
a= cos(theta)*dq[0] - sin(theta)*dq[1];
b= cos(theta -2.0/3.0*M_PI)*dq[0]  - sin(theta-2.0/3.0*M_PI)*dq[1];
c= cos(theta +2.0/3.0*M_PI)*dq[0] - sin(theta+2.0/3.0*M_PI)*dq[1];
/*End code section*/"
                    output_terminals = "real a;real b;real c;"
                    output_terminals_dimensions = "1;1;1"
                    output_terminals_feedthrough = "True;True;True"
                    output_terminals_show_labels = "True;True;True"
                    update_fnc = "/*Begin code section*/

/*End code section*/"
                }
                [
                    position = 7348, 7792
                    size = 176, 152
                ]

                component "core/Bus Join" "Bus Join17" {
                    execution_rate = "Ts_Control"
                    inputs = "3"
                }
                [
                    position = 7556, 7804
                ]

                component "core/Constant" Constant3 {
                    execution_rate = "Ts_Control"
                    value = "0"
                }
                [
                    position = 7180, 7852
                ]

                component "core/Termination" Termination3 {
                }
                [
                    position = 7928, 7684
                ]

                component "core/Termination" Termination4 {
                }
                [
                    position = 7932, 7732
                ]

                component "core/Termination" Termination5 {
                }
                [
                    position = 7916, 7780
                ]

                component "core/Termination" Termination6 {
                }
                [
                    position = 7900, 7884
                ]

                component "core/Termination" Termination7 {
                }
                [
                    position = 7904, 7924
                ]

                component "core/C function" "C function VSG" {
                    arb_defs = "/*Begin code section*/

/*End code section*/"
                    execution_rate = "Ts_Control"
                    global_variables = "real x_p;real x_q;real theta;real x_isd;real x_isq;real e_p;real e_q;"
                    init_fnc = "/*Begin code section*/
x_p = 0.0;
x_q = 0.0;
theta = 0.0;
x_isd = 0.0;
x_isq = 0.0;
e_p = 0.0;
e_q = 0.0;
/*End code section*/"
                    input_terminals = "real p_m_ref;real q_s_ref;real time;real is_albe;real vs_albe;inherit omega_base;"
                    input_terminals_dimensions = "1;1;1;2;2;1"
                    input_terminals_feedthrough = "True;True;True;True;True;True"
                    input_terminals_show_labels = "True;True;True;True;True;True"
                    output_fnc = "/*Begin code section*/
// current dq transformation
is_d= is_albe[0]*cos(theta)+ is_albe[1]*sin(theta);
is_q = -is_albe[0]*sin(theta) + is_albe[1]*cos(theta);

// voltage dq transformation
vs_d= vs_albe[0]*cos(theta)+ vs_albe[1]*sin(theta);
vs_q = -vs_albe[0]*sin(theta) + vs_albe[1]*cos(theta);

//if (time<=T_on_contactor){
//    vs_q = -sqrt(pow(vs_d,2)+pow(vs_q,2));
//    vs_d = 0.0;
    
//}
// powers in pu
p_s = (is_d* vs_d + is_q*vs_q)/(I_bdq*U_bdq);
q_s = (is_d* vs_q -  is_q*vs_d)/(I_bdq*U_bdq);

//omega VSG rads
omega_vsg = (Kp_p*e_p + x_p + omega_base)*2.0*M_PI*50.0;
//theta VSG
theta_vsg= theta;

// electromotive force pu
e = e_o + Kp_q*e_q + x_q;
e_dq[0] = 0;
e_dq[1] = -e*U_bdq;

//current references SI
is_dq_ref[0] = -I_bdq*(Xv*e + Rv*vs_d/U_bdq + Xv*vs_q/U_bdq)/(pow(Rv,2)+pow(Xv,2));
is_dq_ref[1] = -I_bdq*(Rv*e + Rv*vs_q/U_bdq - Xv*vs_d/U_bdq)/(pow(Rv,2)+pow(Xv,2));

//current references SI filtered
is_dq_ref_fil[0] = x_isd;
is_dq_ref_fil[1] = x_isq;
/*End code section*/"
                    output_terminals = "real is_dq_ref;real omega_vsg;real theta_vsg;real e;real p_s;real q_s;real is_dq_ref_fil;inherit is_d;inherit is_q;inherit vs_d;inherit vs_q;real e_dq;"
                    output_terminals_dimensions = "2;1;1;1;1;1;2;1;1;1;1;2"
                    output_terminals_feedthrough = "True;True;True;True;True;True;True;True;True;True;True;True"
                    output_terminals_show_labels = "True;True;True;True;True;True;True;True;True;True;True;True"
                    parameters = "real Kp_p;real Ki_p;real Kp_q;real Ki_q;real Xv;real Rv;real I_bdq;real e_o;real U_bdq;real Ts_Control;real tau_vsg;real T_on_contactor;"
                    update_fnc = "/*Begin code section*/
//active and reactive power error pu
e_p = p_m_ref - p_s;
e_q = q_s_ref - q_s;

//integrator PI active adn reactive power
x_p = x_p + Ki_p*Ts_Control*e_p;
x_q = x_q + Ki_q*Ts_Control*e_q;

//integrator omega rad
theta = theta + omega_vsg*Ts_Control;
if (theta>=2*M_PI){
    theta = theta - 2*M_PI;
}
if (theta<0.0){
    theta = theta + abs(theta);
}

//filter of the reference currents
x_isd = x_isd + Ts_Control*2*M_PI*1/(tau_vsg)*(is_dq_ref[0] - x_isd);
x_isq = x_isq + Ts_Control*2*M_PI*1/(tau_vsg)*(is_dq_ref[1] - x_isq);

//if (time<=T_on_contactor){
//    x_p = 0.0;
//    theta = 0.0;
//    x_q = 0.0;
//}
/*End code section*/"
                }
                [
                    position = 8232, 8148
                    size = 232, 648
                ]

                port i_albe {
                    position = left:1
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 7992, 8132
                ]

                port is_albe_ref {
                    position = right:1
                    kind = sp
                    direction =  in
                    sp_type {
                        default = inherit
                        readonly = True
                    }
                }
                [
                    position = 9508, 8028
                ]

                port v_albe {
                    position = left:2
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 8008, 8224
                ]

                port p_m_ref {
                    position = left:3
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 8024, 7840
                ]

                port q_s_ref {
                    position = left:4
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 8044, 7936
                ]

                port omega_vsg {
                    position = right:2
                    kind = sp
                    direction =  in
                    sp_type {
                        default = inherit
                        readonly = True
                    }
                }
                [
                    position = 9088, 8312
                ]

                port p_s {
                    position = right:3
                    kind = sp
                    direction =  in
                    sp_type {
                        default = inherit
                        readonly = True
                    }
                }
                [
                    position = 9096, 8368
                ]

                port q_s {
                    position = right:4
                    kind = sp
                    direction =  in
                    sp_type {
                        default = inherit
                        readonly = True
                    }
                }
                [
                    position = 9100, 8456
                ]

                port e_dq {
                    position = right:5
                    kind = sp
                    direction =  in
                    sp_type {
                        default = inherit
                        readonly = True
                    }
                }
                [
                    position = 9480, 8112
                ]

                tag From95 {
                    value = "time"
                    scope = global
                    kind = sp
                    direction = out
                }
                [
                    position = 8048, 8032
                    hide_name = True
                    size = 60, 20
                ]

                tag Goto46 {
                    value = "is_dq_ref"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 8440, 7840
                    hide_name = True
                    size = 60, 20
                ]

                tag Goto47 {
                    value = "omega_vsg"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 8440, 7888
                    hide_name = True
                    size = 68, 20
                ]

                tag Goto48 {
                    value = "theta_vsg"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 8432, 7936
                    hide_name = True
                    size = 68, 20
                ]

                tag Goto49 {
                    value = "e"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 8436, 7984
                    hide_name = True
                    size = 68, 20
                ]

                tag Goto50 {
                    value = "p_s"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 8440, 8032
                    hide_name = True
                    size = 68, 20
                ]

                tag Goto51 {
                    value = "q_s"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 8436, 8080
                    hide_name = True
                    size = 68, 20
                ]

                tag Goto54 {
                    value = "is_dq_ref_fil"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 8452, 8128
                    hide_name = True
                    size = 92, 20
                ]

                tag Goto52 {
                    value = "is_dq"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 8540, 8192
                    hide_name = True
                    size = 60, 20
                ]

                tag Goto53 {
                    value = "vs_dq"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 8556, 8292
                    hide_name = True
                    size = 60, 20
                ]

                tag From128 {
                    value = "is_dq_ref"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8588, 8004
                    hide_name = True
                    size = 60, 20
                ]

                tag From129 {
                    value = "theta_vsg"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8628, 8084
                    rotation = down
                    hide_name = True
                    scale = -1, 1
                    size = 60, 20
                ]

                tag From130 {
                    value = "omega_vsg"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8988, 8312
                    rotation = down
                    hide_name = True
                    scale = -1, 1
                    size = 60, 20
                ]

                tag From131 {
                    value = "p_s"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8980, 8368
                    rotation = down
                    hide_name = True
                    scale = -1, 1
                    size = 60, 20
                ]

                tag From132 {
                    value = "q_s"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8976, 8456
                    rotation = down
                    hide_name = True
                    scale = -1, 1
                    size = 60, 20
                ]

                tag Goto36 {
                    value = "omega"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 7916, 7832
                    hide_name = True
                    size = 60, 20
                ]

                tag From133 {
                    value = "omega"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 7320, 8416
                    hide_name = True
                    size = 60, 20
                ]

                tag Goto55 {
                    value = "e_dq"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 8424, 8456
                    hide_name = True
                    size = 60, 20
                ]

                tag From134 {
                    value = "e_dq"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8684, 8024
                    rotation = down
                    hide_name = True
                    scale = -1, 1
                    size = 60, 20
                ]

                junction Junction1 sp
                [
                    position = 9328, 8040
                ]

                junction Junction2 sp
                [
                    position = 9304, 8156
                ]

                junction Junction3 sp
                [
                    position = 8076, 8224
                ]

                junction Junction4 sp
                [
                    position = 8392, 7840
                ]

                junction Junction5 sp
                [
                    position = 8380, 7988
                ]

                junction Junction6 sp
                [
                    position = 8388, 8184
                ]

                junction Junction7 sp
                [
                    position = 8392, 8252
                ]

                junction Junction8 sp
                [
                    position = 8408, 8284
                ]

                junction Junction9 sp
                [
                    position = 8372, 8368
                ]

                connect From129 "C function dq to abc.theta" as Connection898
                connect omega_vsg From130 as Connection902
                connect From131 p_s as Connection903
                [
                    breakpoints = 9072, 8364
                ]
                connect q_s From132 as Connection904
                connect Goto53 "Bus Join14.out" as Connection913
                connect Goto52 "Bus Join11.out" as Connection914
                connect "Bus Join15.in1" "C function dq to abc.b" as Connection915
                connect "Bus Join15.in" "C function dq to abc.a" as Connection916
                connect "C function dq to abc.c" "Bus Join15.in2" as Connection917
                connect "Bus Join15.out" "C function abc to dq.abc" as Connection918
                connect Constant1.out "C function abc to dq.theta" as Connection919
                connect Step1.out "Signal switch1.in2" as Connection925
                [
                    breakpoints = 7512, 8264; 7788, 8264
                ]
                connect "C function abc to dq.d" Junction1 as Connection929
                connect Junction1 "Bus Join16.in" as Connection930
                [
                    breakpoints = 9332, 8084
                ]
                connect is_al_ref.in Junction1 as Connection931
                connect "Bus Join16.in1" Junction2 as Connection932
                connect Junction2 "C function abc to dq.q" as Connection933
                connect is_be_ref.in Junction2 as Connection934
                connect is_d_ref.in "Bus Split2.out" as Connection959
                connect is_q_ref.in "Bus Split2.out1" as Connection960
                connect Gain1.out "Signal switch1.in1" as Connection962
                connect "C function dq to abc1.a" "Bus Join17.in" as Connection971
                connect "Bus Join17.in1" "C function dq to abc1.b" as Connection972
                connect "C function dq to abc1.c" "Bus Join17.in2" as Connection973
                connect "Bus Join17.out" "C function PLL.abc" as Connection974
                connect Constant3.out "C function dq to abc1.theta" as Connection975
                connect Constant2.out "Signal switch1.in" as Connection979
                connect Goto36 "C function PLL.omega_pll" as Connection981
                connect From133 Gain1.in as Connection982
                connect Termination3.in "C function PLL.d" as Connection983
                connect Termination4.in "C function PLL.q" as Connection984
                connect Termination5.in "C function PLL.theta_pll" as Connection985
                connect "C function PLL.e_q" Termination6.in as Connection986
                connect Termination7.in "C function PLL.e_d" as Connection987
                connect p_m_ref "C function VSG.p_m_ref" as Connection995
                connect q_s_ref "C function VSG.q_s_ref" as Connection996
                connect From95 "C function VSG.time" as Connection997
                connect i_albe "C function VSG.is_albe" as Connection998
                connect v_albe Junction3 as Connection999
                connect Junction3 "C function dq to abc1.dq" as Connection1000
                [
                    breakpoints = 8084, 8200; 7528, 8200
                ]
                connect "C function VSG.vs_albe" Junction3 as Connection1001
                connect "C function VSG.omega_base" "Signal switch1.out" as Connection1002
                connect "Bus Split2.in" Junction4 as Connection1003
                connect Junction4 Goto46 as Connection1004
                connect "C function VSG.is_dq_ref" Junction4 as Connection1005
                connect "C function VSG.omega_vsg" Goto47 as Connection1006
                connect "C function VSG.theta_vsg" Goto48 as Connection1007
                connect e.in Junction5 as Connection1008
                connect Junction5 Goto49 as Connection1009
                [
                    breakpoints = 8380, 7984
                ]
                connect "C function VSG.e" Junction5 as Connection1010
                connect "C function VSG.p_s" Goto50 as Connection1011
                connect "C function VSG.q_s" Goto51 as Connection1012
                connect "C function VSG.is_dq_ref_fil" Goto54 as Connection1013
                connect is_d.in Junction6 as Connection1014
                connect Junction6 "Bus Join11.in" as Connection1015
                [
                    breakpoints = 8388, 8184
                ]
                connect "C function VSG.is_d" Junction6 as Connection1016
                connect "Bus Join11.in1" Junction7 as Connection1017
                [
                    breakpoints = 8392, 8224
                ]
                connect Junction7 is_q.in as Connection1018
                connect "C function VSG.is_q" Junction7 as Connection1019
                connect vs_d.in Junction8 as Connection1020
                [
                    breakpoints = 8396, 8284
                ]
                connect Junction8 "Bus Join14.in" as Connection1021
                connect "C function VSG.vs_d" Junction8 as Connection1022
                connect "Bus Join14.in1" Junction9 as Connection1023
                [
                    breakpoints = 8372, 8320
                ]
                connect Junction9 vs_q.in as Connection1024
                connect "C function VSG.vs_q" Junction9 as Connection1025
                connect Goto55 "C function VSG.e_dq" as Connection1026
                connect From134 "C function dq to abc.dq" as Connection1027
                connect e_dq "Bus Join16.out" as Connection1028
            }
            [
                position = 6848, 7936
                size = 152, 224
            ]

            component "core/Probe" is_a_ref {
                execution_rate = "Ts_Control"
                signal_access = "Inherit"
            }
            [
                position = 7508, 7460
            ]

            component "core/Probe" is_b_ref {
                execution_rate = "Ts_Control"
                signal_access = "Inherit"
            }
            [
                position = 7520, 7524
            ]

            component "core/Probe" is_c_ref {
                execution_rate = "Ts_Control"
                signal_access = "Inherit"
            }
            [
                position = 7432, 7656
            ]

            component "core/Signal switch" "Signal switch1" {
                execution_rate = "Ts_Control"
            }
            [
                position = 6060, 7676
            ]

            component "core/Step" Step1 {
                execution_rate = "Ts_Control"
                step_time = "T_on_vsg"
            }
            [
                position = 5972, 7580
            ]

            component "core/Signal switch" "Signal switch2" {
                execution_rate = "Ts_Control"
            }
            [
                position = 5932, 7808
            ]

            component "core/Step" Step2 {
                execution_rate = "Ts_Control"
                step_time = "T_on_vsg"
            }
            [
                position = 5800, 7748
            ]

            component "core/Signal switch" "Signal switch3" {
                execution_rate = "Ts_Control"
            }
            [
                position = 5928, 7972
            ]

            component "core/Step" Step3 {
                execution_rate = "Ts_Control"
                step_time = "T_on_vsg"
            }
            [
                position = 5836, 7924
            ]

            component "core/SCADA Input" "SCADA Input1" {
                unit = ""
            }
            [
                position = 6052, 8064
            ]

            component Subsystem VSG_b1 {
                layout = dynamic
                component "core/Bus Join" "Bus Join11" {
                    execution_rate = "Ts_Control"
                }
                [
                    position = 8432, 8192
                ]

                component "core/Bus Join" "Bus Join14" {
                    execution_rate = "Ts_Control"
                }
                [
                    position = 8452, 8292
                ]

                component "core/C function" "C function dq to abc" {
                    arb_defs = "/*Begin code section*/

/*End code section*/"
                    execution_rate = "Ts_Control"
                    init_fnc = "/*Begin code section*/

/*End code section*/"
                    input_terminals = "real dq;real theta;"
                    input_terminals_dimensions = "2;1"
                    input_terminals_feedthrough = "True;True"
                    input_terminals_show_labels = "True;True"
                    output_fnc = "/*Begin code section*/
a= cos(theta)*dq[0] - sin(theta)*dq[1];
b= cos(theta -2.0/3.0*M_PI)*dq[0]  - sin(theta-2.0/3.0*M_PI)*dq[1];
c= cos(theta +2.0/3.0*M_PI)*dq[0] - sin(theta+2.0/3.0*M_PI)*dq[1];
/*End code section*/"
                    output_terminals = "real a;real b;real c;"
                    output_terminals_dimensions = "1;1;1"
                    output_terminals_feedthrough = "True;True;True"
                    output_terminals_show_labels = "True;True;True"
                    update_fnc = "/*Begin code section*/

/*End code section*/"
                }
                [
                    position = 8816, 8052
                    size = 152, 96
                ]

                component "core/C function" "C function abc to dq" {
                    arb_defs = "/*Begin code section*/

/*End code section*/"
                    execution_rate = "Ts_Control"
                    input_terminals = "real abc;real theta;"
                    input_terminals_dimensions = "3;1"
                    input_terminals_feedthrough = "True;True"
                    input_terminals_show_labels = "True;True"
                    output_fnc = "/*Begin code section*/
d= 2.0/3.0*(cos(theta)*abc[0] + cos(theta - 2.0/3.0*M_PI)*abc[1]  + cos(theta + 2.0/3.0*M_PI)*abc[2] );
q = 2.0/3.0*(-sin(theta)*abc[0] - sin(theta - 2.0/3.0*M_PI)*abc[1]  - sin(theta + 2.0/3.0*M_PI)*abc[2] );
/*End code section*/"
                    output_terminals = "real d;real q;"
                    output_terminals_dimensions = "1;1"
                    output_terminals_feedthrough = "True;True"
                    output_terminals_show_labels = "True;True"
                }
                [
                    position = 9200, 8100
                    size = 176, 152
                ]

                component "core/Bus Join" "Bus Join15" {
                    execution_rate = "Ts_Control"
                    inputs = "3"
                }
                [
                    position = 8960, 8056
                ]

                component "core/Constant" Constant1 {
                    execution_rate = "Ts_Control"
                    value = "0"
                }
                [
                    position = 9020, 8144
                ]

                component "core/Bus Join" "Bus Join16" {
                    execution_rate = "Ts_Control"
                }
                [
                    position = 9364, 8096
                ]

                component "core/Signal switch" "Signal switch1" {
                    execution_rate = "Ts_Control"
                }
                [
                    position = 7788, 8340
                ]

                component "core/Constant" Constant2 {
                    execution_rate = "Ts_Control"
                }
                [
                    position = 7652, 8312
                ]

                component "core/Step" Step1 {
                    execution_rate = "Ts_Control"
                    step_time = "T_on_vsg"
                }
                [
                    position = 7492, 8264
                ]

                component "core/Gain" Gain1 {
                    execution_rate = "Ts_Control"
                    gain = "1/omega_base_rads"
                }
                [
                    position = 7512, 8416
                ]

                component "core/Probe" is_al_ref {
                }
                [
                    position = 9416, 7968
                ]

                component "core/Probe" is_be_ref {
                }
                [
                    position = 9460, 8208
                ]

                component "core/Probe" e {
                }
                [
                    position = 8700, 7928
                ]

                component "core/Probe" is_d {
                }
                [
                    position = 8632, 8148
                ]

                component "core/Probe" is_q {
                }
                [
                    position = 8616, 8252
                ]

                component "core/Probe" vs_d {
                }
                [
                    position = 8580, 8360
                ]

                component "core/Probe" vs_q {
                }
                [
                    position = 8420, 8396
                ]

                component "core/Bus Split" "Bus Split2" {
                }
                [
                    position = 8440, 7720
                ]

                component "core/Probe" is_d_ref {
                }
                [
                    position = 8584, 7616
                ]

                component "core/Probe" is_q_ref {
                }
                [
                    position = 8568, 7720
                ]

                component "core/C function" "C function PLL" {
                    arb_defs = "/*Begin code section*/

/*End code section*/"
                    execution_rate = "Ts_Control"
                    global_variables = "real y_q;real theta;real y_d;"
                    init_fnc = "/*Begin code section*/
y_q = 0;
y_d = 0;
theta = 0;
/*End code section*/"
                    input_terminals = "real abc;"
                    input_terminals_dimensions = "3"
                    input_terminals_feedthrough = "True"
                    input_terminals_show_labels = "True"
                    output_fnc = "/*Begin code section*/
// dq transformation
d= 2.0/3.0*(cos(theta)*abc[0] + cos(theta - 2.0/3.0*M_PI)*abc[1]  + cos(theta + 2.0/3.0*M_PI)*abc[2] );
q = 2.0/3.0*(-sin(theta)*abc[0] - sin(theta - 2.0/3.0*M_PI)*abc[1]  - sin(theta + 2.0/3.0*M_PI)*abc[2] );

//error
//e_q = q;
e_d = d;

//omega
omega_pll = K_p_pll*e_d + y_d;
//theta
theta_pll = theta;
/*End code section*/"
                    output_terminals = "real d;real q;real theta_pll;real omega_pll;real e_q;real e_d;"
                    output_terminals_dimensions = "1;1;1;1;1;1"
                    output_terminals_feedthrough = "True;True;True;True;True;True"
                    output_terminals_show_labels = "False;False;True;True;True;True"
                    parameters = "real K_p_pll;real K_i_pll;real Ts_Control;"
                    update_fnc = "/*Begin code section*/
// Integrator of the PLL
//y_q= y_q + K_i_pll*Ts_Control*e_q;
y_d= y_d + K_i_pll*Ts_Control*e_d;

// Integrator of theta
theta = theta + Ts_Control*omega_pll;
if (theta>=2*M_PI){
    theta = theta - 2*M_PI;
}
if (theta<0.0){
    theta = theta + abs(theta);
}
/*End code section*/"
                }
                [
                    position = 7736, 7804
                    size = 224, 304
                ]

                component "core/C function" "C function dq to abc1" {
                    arb_defs = "/*Begin code section*/

/*End code section*/"
                    execution_rate = "Ts_Control"
                    init_fnc = "/*Begin code section*/

/*End code section*/"
                    input_terminals = "real dq;real theta;"
                    input_terminals_dimensions = "2;1"
                    input_terminals_feedthrough = "True;True"
                    input_terminals_show_labels = "True;True"
                    output_fnc = "/*Begin code section*/
a= cos(theta)*dq[0] - sin(theta)*dq[1];
b= cos(theta -2.0/3.0*M_PI)*dq[0]  - sin(theta-2.0/3.0*M_PI)*dq[1];
c= cos(theta +2.0/3.0*M_PI)*dq[0] - sin(theta+2.0/3.0*M_PI)*dq[1];
/*End code section*/"
                    output_terminals = "real a;real b;real c;"
                    output_terminals_dimensions = "1;1;1"
                    output_terminals_feedthrough = "True;True;True"
                    output_terminals_show_labels = "True;True;True"
                    update_fnc = "/*Begin code section*/

/*End code section*/"
                }
                [
                    position = 7348, 7792
                    size = 176, 152
                ]

                component "core/Bus Join" "Bus Join17" {
                    execution_rate = "Ts_Control"
                    inputs = "3"
                }
                [
                    position = 7556, 7804
                ]

                component "core/Constant" Constant3 {
                    execution_rate = "Ts_Control"
                    value = "0"
                }
                [
                    position = 7180, 7852
                ]

                component "core/Termination" Termination3 {
                }
                [
                    position = 7928, 7684
                ]

                component "core/Termination" Termination4 {
                }
                [
                    position = 7932, 7732
                ]

                component "core/Termination" Termination5 {
                }
                [
                    position = 7916, 7780
                ]

                component "core/Termination" Termination6 {
                }
                [
                    position = 7900, 7884
                ]

                component "core/Termination" Termination7 {
                }
                [
                    position = 7904, 7924
                ]

                component "core/C function" "C function VSG" {
                    arb_defs = "/*Begin code section*/

/*End code section*/"
                    execution_rate = "Ts_Control"
                    global_variables = "real x_p;real x_q;real theta;real x_isd;real x_isq;real e_p;real e_q;"
                    init_fnc = "/*Begin code section*/
x_p = 0.0;
x_q = 0.0;
theta = 0.0;
x_isd = 0.0;
x_isq = 0.0;
e_p = 0.0;
e_q = 0.0;
/*End code section*/"
                    input_terminals = "real p_m_ref;real q_s_ref;real time;real is_albe;real vs_albe;inherit omega_base;"
                    input_terminals_dimensions = "1;1;1;2;2;1"
                    input_terminals_feedthrough = "True;True;True;True;True;True"
                    input_terminals_show_labels = "True;True;True;True;True;True"
                    output_fnc = "/*Begin code section*/
// current dq transformation
is_d= is_albe[0]*cos(theta)+ is_albe[1]*sin(theta);
is_q = -is_albe[0]*sin(theta) + is_albe[1]*cos(theta);

// voltage dq transformation
vs_d= vs_albe[0]*cos(theta)+ vs_albe[1]*sin(theta);
vs_q = -vs_albe[0]*sin(theta) + vs_albe[1]*cos(theta);

//if (time<=T_on_contactor){
//    vs_q = -sqrt(pow(vs_d,2)+pow(vs_q,2));
//    vs_d = 0.0;
    
//}
// powers in pu
p_s = (is_d* vs_d + is_q*vs_q)/(I_bdq*U_bdq);
q_s = (is_d* vs_q -  is_q*vs_d)/(I_bdq*U_bdq);

//omega VSG rads
omega_vsg = (Kp_p*e_p + x_p + omega_base)*2.0*M_PI*50.0;
//theta VSG
theta_vsg= theta;

// electromotive force pu
e = e_o + Kp_q*e_q + x_q;
e_dq[0] = 0;
e_dq[1] = -e*U_bdq;

//current references SI
is_dq_ref[0] = -I_bdq*(Xv*e + Rv*vs_d/U_bdq + Xv*vs_q/U_bdq)/(pow(Rv,2)+pow(Xv,2));
is_dq_ref[1] = -I_bdq*(Rv*e + Rv*vs_q/U_bdq - Xv*vs_d/U_bdq)/(pow(Rv,2)+pow(Xv,2));

//current references SI filtered
is_dq_ref_fil[0] = x_isd;
is_dq_ref_fil[1] = x_isq;
/*End code section*/"
                    output_terminals = "real is_dq_ref;real omega_vsg;real theta_vsg;real e;real p_s;real q_s;real is_dq_ref_fil;inherit is_d;inherit is_q;inherit vs_d;inherit vs_q;real e_dq;"
                    output_terminals_dimensions = "2;1;1;1;1;1;2;1;1;1;1;2"
                    output_terminals_feedthrough = "True;True;True;True;True;True;True;True;True;True;True;True"
                    output_terminals_show_labels = "True;True;True;True;True;True;True;True;True;True;True;True"
                    parameters = "real Kp_p;real Ki_p;real Kp_q;real Ki_q;real Xv;real Rv;real I_bdq;real e_o;real U_bdq;real Ts_Control;real tau_vsg;real T_on_contactor;"
                    update_fnc = "/*Begin code section*/
//active and reactive power error pu
e_p = p_m_ref - p_s;
e_q = q_s_ref - q_s;

//integrator PI active adn reactive power
x_p = x_p + Ki_p*Ts_Control*e_p;
x_q = x_q + Ki_q*Ts_Control*e_q;

//integrator omega rad
theta = theta + omega_vsg*Ts_Control;
if (theta>=2*M_PI){
    theta = theta - 2*M_PI;
}
if (theta<0.0){
    theta = theta + abs(theta);
}

//filter of the reference currents
x_isd = x_isd + Ts_Control*2*M_PI*1/(tau_vsg)*(is_dq_ref[0] - x_isd);
x_isq = x_isq + Ts_Control*2*M_PI*1/(tau_vsg)*(is_dq_ref[1] - x_isq);

//if (time<=T_on_contactor){
//    x_p = 0.0;
//    theta = 0.0;
//    x_q = 0.0;
//}
/*End code section*/"
                }
                [
                    position = 8232, 8148
                    size = 232, 648
                ]

                port i_albe {
                    position = left:1
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 7992, 8132
                ]

                port is_albe_ref {
                    position = right:1
                    kind = sp
                    direction =  in
                    sp_type {
                        default = inherit
                        readonly = True
                    }
                }
                [
                    position = 9508, 8028
                ]

                port v_albe {
                    position = left:2
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 8008, 8224
                ]

                port p_m_ref {
                    position = left:3
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 8024, 7840
                ]

                port q_s_ref {
                    position = left:4
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 8044, 7936
                ]

                port omega_vsg {
                    position = right:2
                    kind = sp
                    direction =  in
                    sp_type {
                        default = inherit
                        readonly = True
                    }
                }
                [
                    position = 9088, 8312
                ]

                port p_s {
                    position = right:3
                    kind = sp
                    direction =  in
                    sp_type {
                        default = inherit
                        readonly = True
                    }
                }
                [
                    position = 9096, 8368
                ]

                port q_s {
                    position = right:4
                    kind = sp
                    direction =  in
                    sp_type {
                        default = inherit
                        readonly = True
                    }
                }
                [
                    position = 9100, 8456
                ]

                port e_dq {
                    position = right:5
                    kind = sp
                    direction =  in
                    sp_type {
                        default = inherit
                        readonly = True
                    }
                }
                [
                    position = 9480, 8112
                ]

                tag From95 {
                    value = "time"
                    scope = global
                    kind = sp
                    direction = out
                }
                [
                    position = 8048, 8032
                    hide_name = True
                    size = 60, 20
                ]

                tag Goto46 {
                    value = "is_dq_ref"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 8440, 7840
                    hide_name = True
                    size = 60, 20
                ]

                tag Goto47 {
                    value = "omega_vsg"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 8440, 7888
                    hide_name = True
                    size = 68, 20
                ]

                tag Goto48 {
                    value = "theta_vsg"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 8432, 7936
                    hide_name = True
                    size = 68, 20
                ]

                tag Goto49 {
                    value = "e"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 8436, 7984
                    hide_name = True
                    size = 68, 20
                ]

                tag Goto50 {
                    value = "p_s"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 8440, 8032
                    hide_name = True
                    size = 68, 20
                ]

                tag Goto51 {
                    value = "q_s"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 8436, 8080
                    hide_name = True
                    size = 68, 20
                ]

                tag Goto54 {
                    value = "is_dq_ref_fil"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 8452, 8128
                    hide_name = True
                    size = 92, 20
                ]

                tag Goto52 {
                    value = "is_dq"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 8540, 8192
                    hide_name = True
                    size = 60, 20
                ]

                tag Goto53 {
                    value = "vs_dq"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 8556, 8292
                    hide_name = True
                    size = 60, 20
                ]

                tag From128 {
                    value = "is_dq_ref"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8588, 8004
                    hide_name = True
                    size = 60, 20
                ]

                tag From129 {
                    value = "theta_vsg"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8628, 8084
                    rotation = down
                    hide_name = True
                    scale = -1, 1
                    size = 60, 20
                ]

                tag From130 {
                    value = "omega_vsg"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8988, 8312
                    rotation = down
                    hide_name = True
                    scale = -1, 1
                    size = 60, 20
                ]

                tag From131 {
                    value = "p_s"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8980, 8368
                    rotation = down
                    hide_name = True
                    scale = -1, 1
                    size = 60, 20
                ]

                tag From132 {
                    value = "q_s"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8976, 8456
                    rotation = down
                    hide_name = True
                    scale = -1, 1
                    size = 60, 20
                ]

                tag Goto36 {
                    value = "omega"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 7916, 7832
                    hide_name = True
                    size = 60, 20
                ]

                tag From133 {
                    value = "omega"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 7320, 8416
                    hide_name = True
                    size = 60, 20
                ]

                tag Goto55 {
                    value = "e_dq"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 8424, 8456
                    hide_name = True
                    size = 60, 20
                ]

                tag From134 {
                    value = "e_dq"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8684, 8024
                    rotation = down
                    hide_name = True
                    scale = -1, 1
                    size = 60, 20
                ]

                junction Junction1 sp
                [
                    position = 9328, 8040
                ]

                junction Junction2 sp
                [
                    position = 9304, 8156
                ]

                junction Junction3 sp
                [
                    position = 8076, 8224
                ]

                junction Junction4 sp
                [
                    position = 8392, 7840
                ]

                junction Junction5 sp
                [
                    position = 8380, 7988
                ]

                junction Junction6 sp
                [
                    position = 8388, 8184
                ]

                junction Junction7 sp
                [
                    position = 8392, 8252
                ]

                junction Junction8 sp
                [
                    position = 8408, 8284
                ]

                junction Junction9 sp
                [
                    position = 8372, 8368
                ]

                connect From129 "C function dq to abc.theta" as Connection898
                connect omega_vsg From130 as Connection902
                connect From131 p_s as Connection903
                [
                    breakpoints = 9072, 8364
                ]
                connect q_s From132 as Connection904
                connect Goto53 "Bus Join14.out" as Connection913
                connect Goto52 "Bus Join11.out" as Connection914
                connect "Bus Join15.in1" "C function dq to abc.b" as Connection915
                connect "Bus Join15.in" "C function dq to abc.a" as Connection916
                connect "C function dq to abc.c" "Bus Join15.in2" as Connection917
                connect "Bus Join15.out" "C function abc to dq.abc" as Connection918
                connect Constant1.out "C function abc to dq.theta" as Connection919
                connect Step1.out "Signal switch1.in2" as Connection925
                [
                    breakpoints = 7512, 8264; 7788, 8264
                ]
                connect "C function abc to dq.d" Junction1 as Connection929
                connect Junction1 "Bus Join16.in" as Connection930
                [
                    breakpoints = 9332, 8084
                ]
                connect is_al_ref.in Junction1 as Connection931
                connect "Bus Join16.in1" Junction2 as Connection932
                connect Junction2 "C function abc to dq.q" as Connection933
                connect is_be_ref.in Junction2 as Connection934
                connect is_d_ref.in "Bus Split2.out" as Connection959
                connect is_q_ref.in "Bus Split2.out1" as Connection960
                connect Gain1.out "Signal switch1.in1" as Connection962
                connect "C function dq to abc1.a" "Bus Join17.in" as Connection971
                connect "Bus Join17.in1" "C function dq to abc1.b" as Connection972
                connect "C function dq to abc1.c" "Bus Join17.in2" as Connection973
                connect "Bus Join17.out" "C function PLL.abc" as Connection974
                connect Constant3.out "C function dq to abc1.theta" as Connection975
                connect Constant2.out "Signal switch1.in" as Connection979
                connect Goto36 "C function PLL.omega_pll" as Connection981
                connect From133 Gain1.in as Connection982
                connect Termination3.in "C function PLL.d" as Connection983
                connect Termination4.in "C function PLL.q" as Connection984
                connect Termination5.in "C function PLL.theta_pll" as Connection985
                connect "C function PLL.e_q" Termination6.in as Connection986
                connect Termination7.in "C function PLL.e_d" as Connection987
                connect p_m_ref "C function VSG.p_m_ref" as Connection995
                connect q_s_ref "C function VSG.q_s_ref" as Connection996
                connect From95 "C function VSG.time" as Connection997
                connect i_albe "C function VSG.is_albe" as Connection998
                connect v_albe Junction3 as Connection999
                connect Junction3 "C function dq to abc1.dq" as Connection1000
                [
                    breakpoints = 8084, 8200; 7528, 8200
                ]
                connect "C function VSG.vs_albe" Junction3 as Connection1001
                connect "C function VSG.omega_base" "Signal switch1.out" as Connection1002
                connect "Bus Split2.in" Junction4 as Connection1003
                connect Junction4 Goto46 as Connection1004
                connect "C function VSG.is_dq_ref" Junction4 as Connection1005
                connect "C function VSG.omega_vsg" Goto47 as Connection1006
                connect "C function VSG.theta_vsg" Goto48 as Connection1007
                connect e.in Junction5 as Connection1008
                connect Junction5 Goto49 as Connection1009
                [
                    breakpoints = 8380, 7984
                ]
                connect "C function VSG.e" Junction5 as Connection1010
                connect "C function VSG.p_s" Goto50 as Connection1011
                connect "C function VSG.q_s" Goto51 as Connection1012
                connect "C function VSG.is_dq_ref_fil" Goto54 as Connection1013
                connect is_d.in Junction6 as Connection1014
                connect Junction6 "Bus Join11.in" as Connection1015
                [
                    breakpoints = 8388, 8184
                ]
                connect "C function VSG.is_d" Junction6 as Connection1016
                connect "Bus Join11.in1" Junction7 as Connection1017
                [
                    breakpoints = 8392, 8224
                ]
                connect Junction7 is_q.in as Connection1018
                connect "C function VSG.is_q" Junction7 as Connection1019
                connect vs_d.in Junction8 as Connection1020
                [
                    breakpoints = 8396, 8284
                ]
                connect Junction8 "Bus Join14.in" as Connection1021
                connect "C function VSG.vs_d" Junction8 as Connection1022
                connect "Bus Join14.in1" Junction9 as Connection1023
                [
                    breakpoints = 8372, 8320
                ]
                connect Junction9 vs_q.in as Connection1024
                connect "C function VSG.vs_q" Junction9 as Connection1025
                connect Goto55 "C function VSG.e_dq" as Connection1026
                connect From134 "C function dq to abc.dq" as Connection1027
                connect e_dq "Bus Join16.out" as Connection1028
            }
            [
                position = 6844, 8224
                size = 152, 224
            ]

            component "core/C function" "C function4" {
                arb_defs = "/*Begin code section*/

/*End code section*/"
                execution_rate = "Ts_Control"
                init_fnc = "/*Begin code section*/

/*End code section*/"
                input_terminals = "real is_albe_ref;"
                input_terminals_dimensions = "2"
                input_terminals_feedthrough = "True"
                input_terminals_show_labels = "True"
                output_fnc = "/*Begin code section*/
is_ref=cos(0)*is_albe_ref[0] - sin(0)*is_albe_ref[1];
/*End code section*/"
                output_terminals = "real is_ref;"
                output_terminals_dimensions = "1"
                output_terminals_feedthrough = "True"
                output_terminals_show_labels = "True"
                update_fnc = "/*Begin code section*/

/*End code section*/"
            }
            [
                position = 8088, 8472
                size = 152, 104
            ]

            component "core/C function" "C function5" {
                arb_defs = "/*Begin code section*/

/*End code section*/"
                execution_rate = "Ts_Control"
                init_fnc = "/*Begin code section*/

/*End code section*/"
                input_terminals = "real is_albe_ref;"
                input_terminals_dimensions = "2"
                input_terminals_feedthrough = "True"
                input_terminals_show_labels = "True"
                output_fnc = "/*Begin code section*/
is_ref=cos(0)*is_albe_ref[0] - sin(0)*is_albe_ref[1];
/*End code section*/"
                output_terminals = "real is_ref;"
                output_terminals_dimensions = "1"
                output_terminals_feedthrough = "True"
                output_terminals_show_labels = "True"
                update_fnc = "/*Begin code section*/

/*End code section*/"
            }
            [
                position = 8092, 8624
                size = 152, 104
            ]

            component "core/C function" "C function6" {
                arb_defs = "/*Begin code section*/

/*End code section*/"
                execution_rate = "Ts_Control"
                init_fnc = "/*Begin code section*/

/*End code section*/"
                input_terminals = "real is_albe_ref;"
                input_terminals_dimensions = "2"
                input_terminals_feedthrough = "True"
                input_terminals_show_labels = "True"
                output_fnc = "/*Begin code section*/
is_ref=cos(0)*is_albe_ref[0] - sin(0)*is_albe_ref[1];
/*End code section*/"
                output_terminals = "real is_ref;"
                output_terminals_dimensions = "1"
                output_terminals_feedthrough = "True"
                output_terminals_show_labels = "True"
                update_fnc = "/*Begin code section*/

/*End code section*/"
            }
            [
                position = 8076, 8756
                size = 152, 104
            ]

            component "core/Product" Product3 {
                execution_rate = "Ts_Control"
                signs = "*/"
            }
            [
                position = 8328, 7968
            ]

            component "core/Termination" Termination1 {
            }
            [
                position = 8144, 7652
            ]

            component "core/Gain" Gain10 {
                execution_rate = "Ts_Control"
                gain = "2"
            }
            [
                position = 8196, 7960
            ]

            component "core/Bus Join" "Bus Join14" {
                inputs = "3"
            }
            [
                position = 8460, 7992
            ]

            component "core/Product" Product4 {
                execution_rate = "Ts_Control"
                signs = "*/"
            }
            [
                position = 8300, 8096
            ]

            component "core/Gain" Gain11 {
                execution_rate = "Ts_Control"
                gain = "2"
            }
            [
                position = 8168, 8088
            ]

            component "core/Product" Product5 {
                execution_rate = "Ts_Control"
                signs = "*/"
            }
            [
                position = 8280, 8252
            ]

            component "core/Gain" Gain12 {
                execution_rate = "Ts_Control"
                gain = "2"
            }
            [
                position = 8148, 8244
            ]

            component "core/Constant" Constant2 {
                execution_rate = "Ts_Control"
                value = "0"
            }
            [
                position = 8432, 7872
            ]

            port eta_abc {
                position = right:1
                kind = sp
                direction =  in
                sp_type {
                    default = inherit
                    readonly = True
                }
            }
            [
                position = 8568, 7976
            ]

            port eta_n {
                position = right:2
                kind = sp
                direction =  in
                sp_type {
                    default = inherit
                    readonly = True
                }
            }
            [
                position = 8588, 7868
            ]

            port p_m_a_ref {
                position = auto:auto
                kind = sp
                direction =  out
                sp_type {
                    default = auto
                    readonly = True
                }
            }
            [
                position = 6152, 7884
            ]

            port q_s_a_ref {
                position = auto:auto
                kind = sp
                direction =  out
                sp_type {
                    default = auto
                    readonly = True
                }
            }
            [
                position = 6132, 7976
            ]

            port p_m_b_ref {
                position = auto:auto
                kind = sp
                direction =  out
                sp_type {
                    default = auto
                    readonly = True
                }
            }
            [
                position = 6140, 8048
            ]

            port q_s_b_ref {
                position = auto:auto
                kind = sp
                direction =  out
                sp_type {
                    default = auto
                    readonly = True
                }
            }
            [
                position = 6156, 8120
            ]

            port p_m_c_ref {
                position = auto:auto
                kind = sp
                direction =  out
                sp_type {
                    default = auto
                    readonly = True
                }
            }
            [
                position = 6152, 8196
            ]

            port q_s_c_ref {
                position = auto:auto
                kind = sp
                direction =  out
                sp_type {
                    default = auto
                    readonly = True
                }
            }
            [
                position = 6148, 8272
            ]

            tag Goto39 {
                value = "p_m_a_ref"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 6308, 7888
                hide_name = True
                size = 60, 20
            ]

            tag Goto44 {
                value = "time"
                scope = global
                kind = sp
                direction = in
            }
            [
                position = 6996, 7324
                hide_name = True
                size = 60, 20
            ]

            tag Goto45 {
                value = "q_s_a_ref"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 6308, 7968
                hide_name = True
                size = 60, 20
            ]

            tag From113 {
                value = "is_a"
                scope = global
                kind = sp
                direction = out
            }
            [
                position = 6152, 7536
                rotation = down
                hide_name = True
                scale = -1, 1
                size = 60, 20
            ]

            tag From114 {
                value = "vs_a"
                scope = global
                kind = sp
                direction = out
            }
            [
                position = 6156, 7568
                rotation = down
                hide_name = True
                scale = -1, 1
                size = 60, 20
            ]

            tag Goto59 {
                value = "is_a_albe"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 6456, 7544
                hide_name = True
                size = 68, 20
            ]

            tag Goto60 {
                value = "vs_a_albe"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 6460, 7592
                hide_name = True
                size = 68, 20
            ]

            tag Goto61 {
                value = "is_b_albe"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 6460, 7640
                hide_name = True
                size = 68, 20
            ]

            tag Goto62 {
                value = "vs_b_albe"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 6460, 7688
                hide_name = True
                size = 68, 20
            ]

            tag Goto63 {
                value = "is_c_albe"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 6456, 7736
                hide_name = True
                size = 68, 20
            ]

            tag Goto64 {
                value = "vs_c_albe"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 6456, 7784
                hide_name = True
                size = 68, 20
            ]

            tag From115 {
                value = "is_b"
                scope = global
                kind = sp
                direction = out
            }
            [
                position = 6156, 7600
                rotation = down
                hide_name = True
                scale = -1, 1
                size = 60, 20
            ]

            tag From116 {
                value = "vs_b"
                scope = global
                kind = sp
                direction = out
            }
            [
                position = 6160, 7632
                rotation = down
                hide_name = True
                scale = -1, 1
                size = 60, 20
            ]

            tag From117 {
                value = "is_c"
                scope = global
                kind = sp
                direction = out
            }
            [
                position = 6156, 7664
                rotation = down
                hide_name = True
                scale = -1, 1
                size = 60, 20
            ]

            tag From118 {
                value = "vs_c"
                scope = global
                kind = sp
                direction = out
            }
            [
                position = 6160, 7696
                rotation = down
                hide_name = True
                scale = -1, 1
                size = 60, 20
            ]

            tag From122 {
                value = "is_a_albe"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 6664, 7580
                rotation = down
                hide_name = True
                scale = -1, 1
                size = 60, 20
            ]

            tag From123 {
                value = "vs_a_albe"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 6664, 7628
                rotation = down
                hide_name = True
                scale = -1, 1
                size = 60, 20
            ]

            tag From124 {
                value = "is_b_albe"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 6680, 7844
                rotation = down
                hide_name = True
                scale = -1, 1
                size = 60, 20
            ]

            tag From125 {
                value = "vs_b_albe"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 6680, 7904
                rotation = down
                hide_name = True
                scale = -1, 1
                size = 60, 20
            ]

            tag From126 {
                value = "is_c_albe"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 6700, 8128
                rotation = down
                hide_name = True
                scale = -1, 1
                size = 60, 20
            ]

            tag From127 {
                value = "vs_c_albe"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 6696, 8176
                rotation = down
                hide_name = True
                scale = -1, 1
                size = 60, 20
            ]

            tag Goto65 {
                value = "is_a_albe_ref"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 7032, 7580
                hide_name = True
                size = 68, 20
            ]

            tag Goto66 {
                value = "omega_vsg_a"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 7024, 7644
                hide_name = True
                size = 68, 20
            ]

            tag Goto67 {
                value = "ps_a"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 7024, 7708
                hide_name = True
                size = 68, 20
            ]

            tag Goto68 {
                value = "qs_a"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 7016, 7744
                hide_name = True
                size = 68, 20
            ]

            tag Goto69 {
                value = "is_b_albe_ref"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 7024, 7860
                hide_name = True
                size = 68, 20
            ]

            tag Goto70 {
                value = "omega_vsg_b"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 7016, 7908
                hide_name = True
                size = 68, 20
            ]

            tag Goto71 {
                value = "ps_b"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 7016, 7956
                hide_name = True
                size = 68, 20
            ]

            tag Goto72 {
                value = "qs_b"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 7012, 8024
                hide_name = True
                size = 68, 20
            ]

            tag Goto73 {
                value = "is_c_albe_ref"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 7020, 8128
                hide_name = True
                size = 68, 20
            ]

            tag Goto74 {
                value = "omega_vsg_c"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 7032, 8176
                hide_name = True
                size = 108, 20
            ]

            tag Goto75 {
                value = "ps_c"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 7012, 8224
                hide_name = True
                size = 68, 20
            ]

            tag Goto76 {
                value = "qs_c"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 7008, 8272
                hide_name = True
                size = 68, 20
            ]

            tag Goto77 {
                value = "p_m_b_ref"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 6308, 8044
                hide_name = True
                size = 60, 20
            ]

            tag Goto78 {
                value = "q_s_b_ref"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 6308, 8124
                hide_name = True
                size = 60, 20
            ]

            tag Goto79 {
                value = "p_m_c_ref"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 6308, 8192
                hide_name = True
                size = 60, 20
            ]

            tag Goto80 {
                value = "q_s_c_ref"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 6308, 8272
                hide_name = True
                size = 60, 20
            ]

            tag From128 {
                value = "p_m_a_ref"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 6624, 7676
                rotation = down
                hide_name = True
                scale = -1, 1
                size = 60, 20
            ]

            tag From129 {
                value = "q_s_a_ref"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 6620, 7724
                rotation = down
                hide_name = True
                scale = -1, 1
                size = 60, 20
            ]

            tag From130 {
                value = "p_m_b_ref"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 6628, 7972
                rotation = down
                hide_name = True
                scale = -1, 1
                size = 60, 20
            ]

            tag From131 {
                value = "q_s_b_ref"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 6620, 8032
                rotation = down
                hide_name = True
                scale = -1, 1
                size = 60, 20
            ]

            tag From132 {
                value = "p_m_c_ref"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 6636, 8224
                rotation = down
                hide_name = True
                scale = -1, 1
                size = 60, 20
            ]

            tag From133 {
                value = "q_s_c_ref"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 6628, 8272
                rotation = down
                hide_name = True
                scale = -1, 1
                size = 60, 20
            ]

            tag From134 {
                value = "is_a_ref"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 7288, 7576
                rotation = down
                hide_name = True
                scale = -1, 1
                size = 60, 20
            ]

            tag From135 {
                value = "is_b_ref"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 7284, 7604
                rotation = down
                hide_name = True
                scale = -1, 1
                size = 60, 20
            ]

            tag From136 {
                value = "is_c_ref"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 7288, 7636
                rotation = down
                hide_name = True
                scale = -1, 1
                size = 60, 20
            ]

            tag From137 {
                value = "is_a"
                scope = global
                kind = sp
                direction = out
            }
            [
                position = 7284, 7720
                rotation = down
                hide_name = True
                scale = -1, 1
                size = 60, 20
            ]

            tag From138 {
                value = "vs_a"
                scope = global
                kind = sp
                direction = out
            }
            [
                position = 7692, 8004
                rotation = down
                hide_name = True
                scale = -1, 1
                size = 60, 20
            ]

            tag From139 {
                value = "is_b"
                scope = global
                kind = sp
                direction = out
            }
            [
                position = 7284, 7748
                rotation = down
                hide_name = True
                scale = -1, 1
                size = 60, 20
            ]

            tag From140 {
                value = "vs_b"
                scope = global
                kind = sp
                direction = out
            }
            [
                position = 7276, 7880
                rotation = down
                hide_name = True
                scale = -1, 1
                size = 60, 20
            ]

            tag From142 {
                value = "vs_c"
                scope = global
                kind = sp
                direction = out
            }
            [
                position = 7276, 7920
                rotation = down
                hide_name = True
                scale = -1, 1
                size = 60, 20
            ]

            tag From143 {
                value = "is_c"
                scope = global
                kind = sp
                direction = out
            }
            [
                position = 7284, 7784
                rotation = down
                hide_name = True
                scale = -1, 1
                size = 60, 20
            ]

            tag From144 {
                value = "is_n"
                scope = global
                kind = sp
                direction = out
            }
            [
                position = 7320, 8016
                rotation = down
                hide_name = True
                scale = -1, 1
                size = 60, 20
            ]

            tag Goto81 {
                value = "theta"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 7760, 7880
                hide_name = True
                size = 60, 20
            ]

            tag Goto82 {
                value = "omega"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 7764, 8016
                hide_name = True
                size = 60, 20
            ]

            tag From148 {
                value = "is_a_albe_ref"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 7300, 8280
                rotation = down
                hide_name = True
                scale = -1, 1
                size = 84, 20
            ]

            tag Goto83 {
                value = "is_a_ref"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 8544, 8372
                hide_name = True
                size = 60, 20
            ]

            tag From149 {
                value = "is_b_albe_ref"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 7300, 8444
                rotation = down
                hide_name = True
                scale = -1, 1
                size = 84, 20
            ]

            tag Goto84 {
                value = "is_b_ref"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 8540, 8536
                hide_name = True
                size = 68, 20
            ]

            tag From150 {
                value = "is_c_albe_ref"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 7300, 8592
                rotation = down
                hide_name = True
                scale = -1, 1
                size = 84, 20
            ]

            tag Goto85 {
                value = "is_c_ref"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 8540, 8684
                hide_name = True
                size = 68, 20
            ]

            tag From151 {
                value = "omega"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 6680, 7772
                rotation = down
                hide_name = True
                scale = -1, 1
                size = 60, 20
            ]

            tag From152 {
                value = "omega"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 5968, 7752
                rotation = down
                hide_name = True
                scale = -1, 1
                size = 60, 20
            ]

            tag From154 {
                value = "omega_vsg_a"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 5760, 7712
                rotation = down
                hide_name = True
                scale = -1, 1
                size = 60, 20
            ]

            tag From155 {
                value = "omega_vsg_b"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 5680, 7812
                rotation = down
                hide_name = True
                scale = -1, 1
                size = 60, 20
            ]

            tag From156 {
                value = "omega_vsg_c"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 5620, 7988
                rotation = down
                hide_name = True
                scale = -1, 1
                size = 60, 20
            ]

            tag From157 {
                value = "is_a_albe"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 6676, 7440
                rotation = down
                hide_name = True
                scale = -1, 1
                size = 60, 20
            ]

            tag From158 {
                value = "vs_a_albe"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 6188, 7376
                rotation = down
                hide_name = True
                scale = -1, 1
                size = 60, 20
            ]

            tag From159 {
                value = "omega"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 5844, 7888
                rotation = down
                hide_name = True
                scale = -1, 1
                size = 60, 20
            ]

            tag From160 {
                value = "omega"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 5840, 8052
                rotation = down
                hide_name = True
                scale = -1, 1
                size = 60, 20
            ]

            tag Goto86 {
                value = "e_albe_a"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 7024, 7776
                hide_name = True
                size = 68, 20
            ]

            tag Goto87 {
                value = "e_albe_b"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 7004, 8060
                hide_name = True
                size = 68, 20
            ]

            tag Goto88 {
                value = "e_albe_c"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 7016, 8336
                hide_name = True
                size = 68, 20
            ]

            tag From161 {
                value = "e_albe_a"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 7892, 8472
                rotation = down
                hide_name = True
                scale = -1, 1
                size = 84, 20
            ]

            tag Goto89 {
                value = "e_a_ref"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 8252, 8476
                hide_name = True
                size = 68, 20
            ]

            tag From162 {
                value = "e_albe_b"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 7896, 8624
                rotation = down
                hide_name = True
                scale = -1, 1
                size = 84, 20
            ]

            tag Goto90 {
                value = "e_b_ref"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 8256, 8628
                hide_name = True
                size = 68, 20
            ]

            tag From163 {
                value = "e_albe_c"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 7880, 8756
                rotation = down
                hide_name = True
                scale = -1, 1
                size = 84, 20
            ]

            tag Goto91 {
                value = "e_c_ref"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 8240, 8760
                hide_name = True
                size = 68, 20
            ]

            tag From164 {
                value = "v_dc"
                scope = global
                kind = sp
                direction = out
            }
            [
                position = 8200, 8040
                rotation = down
                hide_name = True
                scale = -1, 1
                size = 60, 20
            ]

            tag From165 {
                value = "e_a_ref"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 8036, 7968
                rotation = down
                hide_name = True
                scale = -1, 1
                size = 84, 20
            ]

            tag From166 {
                value = "v_dc"
                scope = global
                kind = sp
                direction = out
            }
            [
                position = 8172, 8168
                rotation = down
                hide_name = True
                scale = -1, 1
                size = 60, 20
            ]

            tag From167 {
                value = "e_b_ref"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 8008, 8096
                rotation = down
                hide_name = True
                scale = -1, 1
                size = 84, 20
            ]

            tag From168 {
                value = "v_dc"
                scope = global
                kind = sp
                direction = out
            }
            [
                position = 8152, 8324
                rotation = down
                hide_name = True
                scale = -1, 1
                size = 60, 20
            ]

            tag From169 {
                value = "e_c_ref"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 7988, 8252
                rotation = down
                hide_name = True
                scale = -1, 1
                size = 84, 20
            ]

            junction Junction3 sp
            [
                position = 7968, 7616
            ]

            junction Junction4 sp
            [
                position = 8004, 7668
            ]

            junction Junction5 sp
            [
                position = 7968, 7720
            ]

            junction Junction7 sp
            [
                position = 6956, 7628
            ]

            junction Junction10 sp
            [
                position = 7696, 8016
            ]

            junction Junction13 sp
            [
                position = 6948, 7908
            ]

            junction Junction15 sp
            [
                position = 7340, 7576
            ]

            junction Junction16 sp
            [
                position = 7344, 7604
            ]

            junction Junction17 sp
            [
                position = 7352, 7636
            ]

            junction Junction18 sp
            [
                position = 6944, 8176
            ]

            junction Junction19 sp
            [
                position = 8196, 8476
            ]

            junction Junction20 sp
            [
                position = 8196, 8628
            ]

            junction Junction21 sp
            [
                position = 8172, 8760
            ]

            comment Comment6 START <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd"><html><head><meta name="qrichtext" content="1" /><style type="text/css">p, li { white-space: pre-wrap; }</style></head><body style=" font-family:'Arial'; font-size:12pt; font-weight:400; font-style:normal;"><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">dq PI controller with feedforward voltages and cross-coupling terms cancellation</p></body></html> ENDCOMMENT 
            [
                position = 8116, 7132
            ]

            comment Comment7 START <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd"><html><head><meta name="qrichtext" content="1" /><style type="text/css">p, li { white-space: pre-wrap; }</style></head><body style=" font-family:'Arial'; font-size:12pt; font-weight:400; font-style:normal;"><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">dq to abc transformation</p></body></html> ENDCOMMENT 
            [
                position = 9080, 7136
            ]

            comment Comment8 START <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd"><html><head><meta name="qrichtext" content="1" /><style type="text/css">p, li { white-space: pre-wrap; }</style></head><body style=" font-family:'Arial'; font-size:12pt; font-weight:400; font-style:normal;"><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Grid-Forming Virtual Synchronous Generator</p></body></html> ENDCOMMENT 
            [
                position = 7532, 7140
            ]

            connect Clock2.out Goto44 as Connection759
            connect From113 "Virtual 3ph3w.is_a" as Connection894
            connect From114 "Virtual 3ph3w.vs_a" as Connection897
            connect "Virtual 3ph3w.is_a_albe" Goto59 as Connection898
            connect "Virtual 3ph3w.vs_a_albe" Goto60 as Connection899
            connect "Virtual 3ph3w.is_b_albe" Goto61 as Connection900
            connect "Virtual 3ph3w.vs_b_albe" Goto62 as Connection901
            connect "Virtual 3ph3w.is_c_albe" Goto63 as Connection902
            connect "Virtual 3ph3w.vs_c_albe" Goto64 as Connection903
            connect From115 "Virtual 3ph3w.is_b" as Connection904
            connect From116 "Virtual 3ph3w.vs_b" as Connection905
            connect From117 "Virtual 3ph3w.is_c" as Connection906
            connect From118 "Virtual 3ph3w.vs_c" as Connection907
            connect From122 VSG_a.i_albe as Connection911
            connect From123 VSG_a.v_albe as Connection912
            [
                breakpoints = 6756, 7628
            ]
            connect Goto67 VSG_a.p_s as Connection919
            connect Goto68 VSG_a.q_s as Connection920
            connect "Bus Join10.out" current_ctrl.is_abc_ref as Connection948
            connect From137 "Bus Join11.in" as Connection949
            connect "Bus Join11.in1" From139 as Connection950
            connect From143 "Bus Join11.in2" as Connection951
            connect From140 "Bus Join12.in1" as Connection952
            connect From138 "Bus Join12.in" as Connection953
            connect From142 "Bus Join12.in2" as Connection954
            connect "Bus Join12.out" current_ctrl.vs_abc as Connection955
            connect "Bus Join11.out" current_ctrl.is_abc as Connection956
            [
                breakpoints = 7476, 7748
            ]
            connect "C function dq to abc1.dq" current_ctrl.eta_albe as Connection957
            connect Constant1.out "C function dq to abc1.theta" as Connection958
            connect From144 current_ctrl.is_n as Connection964
            connect "Bus Join13.in" Junction3 as Connection987
            connect Junction3 "C function dq to abc1.a" as Connection988
            connect eta_a.in Junction3 as Connection989
            connect "C function dq to abc1.b" Junction4 as Connection990
            connect Junction4 "Bus Join13.in1" as Connection991
            connect eta_b.in Junction4 as Connection992
            connect "Bus Join13.in2" Junction5 as Connection993
            connect Junction5 "C function dq to abc1.c" as Connection994
            connect eta_c.in Junction5 as Connection995
            connect Goto81 current_ctrl.theta as Connection1000
            connect From148 "C function1.is_albe_ref" as Connection1107
            connect Gain2.in From128 as Connection1113
            connect Gain2.out VSG_a.p_m_ref as Connection1114
            [
                breakpoints = 6768, 7676
            ]
            connect VSG_a.q_s_ref Gain3.out as Connection1115
            connect Gain3.in From129 as Connection1116
            connect From130 Gain4.in as Connection1117
            connect From131 Gain5.in as Connection1119
            connect Gain6.in From132 as Connection1122
            connect Gain7.in From133 as Connection1124
            connect Goto66 Junction7 as Connection1141
            connect Junction7 VSG_a.omega_vsg as Connection1142
            connect omega_vsg_a.in Junction7 as Connection1143
            connect current_ctrl.omega Junction10 as Connection1175
            connect Junction10 Goto82 as Connection1176
            connect omega_pll.in Junction10 as Connection1177
            connect From149 "C function2.is_albe_ref" as Connection1178
            connect From150 "C function3.is_albe_ref" as Connection1180
            connect Gain1.out "Virtual 3ph3w.omega_rads_a" as Connection1183
            connect Gain8.out "Virtual 3ph3w.omega_rads_b" as Connection1185
            connect Gain9.out "Virtual 3ph3w.omega_rads_c" as Connection1187
            connect From154 "Unit Delay1.in" as Connection1188
            connect From155 "Unit Delay2.in" as Connection1190
            connect From156 "Unit Delay3.in" as Connection1192
            connect "Bus Split1.in" From157 as Connection1194
            connect is_a_al.in "Bus Split1.out" as Connection1195
            connect is_b_al.in "Bus Split1.out1" as Connection1196
            connect "Bus Split2.in" From158 as Connection1197
            connect vs_a_al.in "Bus Split2.out" as Connection1198
            connect vs_a_be.in "Bus Split2.out1" as Connection1199
            connect From124 VSG_b.i_albe as Connection1208
            connect From125 VSG_b.v_albe as Connection1209
            connect Gain4.out VSG_b.p_m_ref as Connection1210
            connect Gain5.out VSG_b.q_s_ref as Connection1211
            connect Goto70 Junction13 as Connection1212
            connect Junction13 omega_vsg_b.in as Connection1213
            [
                breakpoints = 6948, 7908; 6956, 7900
            ]
            connect VSG_b.omega_vsg Junction13 as Connection1214
            connect Goto71 VSG_b.p_s as Connection1216
            connect VSG_b.q_s Goto72 as Connection1217
            connect From151 VSG_a.omega_pll as Connection1229
            connect From134 Junction15 as Connection1230
            connect Junction15 "Bus Join10.in" as Connection1231
            connect is_a_ref.in Junction15 as Connection1232
            connect From135 Junction16 as Connection1233
            connect Junction16 "Bus Join10.in1" as Connection1234
            connect is_b_ref.in Junction16 as Connection1235
            connect From136 Junction17 as Connection1236
            connect Junction17 "Bus Join10.in2" as Connection1237
            connect is_c_ref.in Junction17 as Connection1238
            connect Step1.out "Signal switch1.in2" as Connection1239
            connect "Unit Delay1.out" "Signal switch1.in" as Connection1240
            [
                breakpoints = 5960, 7712; 5960, 7660
            ]
            connect From152 "Signal switch1.in1" as Connection1241
            connect "Signal switch1.out" Gain1.in as Connection1242
            connect "Unit Delay2.out" "Signal switch2.in" as Connection1243
            connect From159 "Signal switch2.in1" as Connection1244
            connect "Signal switch2.out" Gain8.in as Connection1245
            connect Step2.out "Signal switch2.in2" as Connection1246
            connect From160 "Signal switch3.in1" as Connection1247
            connect "Unit Delay3.out" "Signal switch3.in" as Connection1248
            [
                breakpoints = 5764, 7964; 5896, 7964
            ]
            connect "Signal switch3.out" Gain9.in as Connection1249
            connect Step3.out "Signal switch3.in2" as Connection1250
            connect p_m_a_ref Goto39 as Connection1251
            connect q_s_a_ref Goto45 as Connection1252
            connect p_m_b_ref Goto77 as Connection1253
            connect p_m_c_ref Goto79 as Connection1254
            connect q_s_b_ref Goto78 as Connection1255
            connect q_s_c_ref Goto80 as Connection1256
            connect Goto86 VSG_a.e_albe as Connection1257
            connect Goto87 VSG_b.e_dq as Connection1258
            connect VSG_b1.i_albe From126 as Connection1260
            connect From127 VSG_b1.v_albe as Connection1261
            connect VSG_b1.p_m_ref Gain6.out as Connection1262
            connect Gain7.out VSG_b1.q_s_ref as Connection1263
            connect Goto76 VSG_b1.q_s as Connection1264
            connect VSG_b1.p_s Goto75 as Connection1265
            [
                breakpoints = 6968, 8216
            ]
            connect Goto74 Junction18 as Connection1266
            connect Junction18 omega_vsg_c.in as Connection1267
            [
                breakpoints = 6948, 8172
            ]
            connect VSG_b1.omega_vsg Junction18 as Connection1268
            connect Goto88 VSG_b1.e_dq as Connection1269
            connect From161 "C function4.is_albe_ref" as Connection1270
            connect From162 "C function5.is_albe_ref" as Connection1272
            connect From163 "C function6.is_albe_ref" as Connection1274
            connect From164 Product3.in1 as Connection846
            connect Termination1.in "Bus Join13.out" as Connection1277
            connect Gain10.out Product3.in as Connection1278
            connect "Bus Join14.out" eta_abc as Connection1279
            connect From165 Gain10.in as Connection1280
            [
                breakpoints = 8168, 7956
            ]
            connect Product3.out "Bus Join14.in" as Connection1281
            connect From166 Product4.in1 as Connection1282
            connect Gain11.out Product4.in as Connection1283
            connect From167 Gain11.in as Connection1284
            [
                breakpoints = 8140, 8084
            ]
            connect Product4.out "Bus Join14.in1" as Connection1285
            connect From168 Product5.in1 as Connection1286
            connect Gain12.out Product5.in as Connection1287
            connect From169 Gain12.in as Connection1288
            [
                breakpoints = 8120, 8240
            ]
            connect Product5.out "Bus Join14.in2" as Connection1289
            connect current_ctrl.eta_n etan.in as Connection1290
            [
                breakpoints = 7668, 7812; 7700, 7812; 7700, 7816; 7720, 7816; 7724, 7804
            ]
            connect Constant2.out eta_n as Connection1291
            connect Goto89 Junction19 as Connection1292
            connect Junction19 "C function4.is_ref" as Connection1293
            connect Goto83 Junction19 as Connection1294
            connect Goto90 Junction20 as Connection1295
            connect Junction20 "C function5.is_ref" as Connection1296
            connect Goto84 Junction20 as Connection1297
            connect Goto91 Junction21 as Connection1298
            connect Junction21 "C function6.is_ref" as Connection1299
            connect Goto85 Junction21 as Connection1300
        }
        [
            position = 8748, 8308
            size = 256, 232
        ]

        component "core/C function" "C function powers" {
            arb_defs = "/*Begin code section*/

/*End code section*/"
            execution_rate = "Ts_Control"
            global_variables = "real p_fil;real q_fil;"
            init_fnc = "/*Begin code section*/
p_fil = 0;
q_fil = 0;
/*End code section*/"
            input_terminals = "real v_a;real v_b;real v_c;real i_a;real i_b;real i_c;"
            input_terminals_dimensions = "inherit;inherit;inherit;inherit;inherit;inherit"
            input_terminals_feedthrough = "True;True;True;True;True;True"
            input_terminals_show_labels = "True;True;True;True;True;True"
            output_fnc = "/*Begin code section*/
p = v_a*i_a + v_b*i_b + v_c*i_c;
q = 1/sqrt(3)*(i_c*(v_a - v_b) + i_a*(v_b - v_c) + i_b*(v_c - v_a));
p_f = p_fil;
q_f = q_fil;
/*End code section*/"
            output_terminals = "real p;real q;real p_f;real q_f;"
            output_terminals_dimensions = "inherit;inherit;inherit;inherit"
            output_terminals_feedthrough = "True;True;True;True"
            output_terminals_show_labels = "True;True;True;True"
            parameters = "real Ts_Control;real fc;"
            update_fnc = "/*Begin code section*/
p_fil = p_fil + Ts_Control*2*M_PI*fc*(p - p_fil);
q_fil = q_fil + Ts_Control*2*M_PI*fc*(q - q_fil);
/*End code section*/"
        }
        [
            position = 8104, 8684
            size = 184, 312
        ]

        component "core/Probe" q_fil {
            execution_rate = "Ts_Control"
            signal_access = "Inherit"
        }
        [
            position = 8588, 8756
        ]

        component "core/Probe" vs_a {
            execution_rate = "Ts_Control"
            signal_access = "Inherit"
        }
        [
            position = 8984, 8852
        ]

        component "core/Probe" vs_b {
            execution_rate = "Ts_Control"
            signal_access = "Inherit"
        }
        [
            position = 8984, 8916
        ]

        component "core/Probe" vs_c {
            execution_rate = "Ts_Control"
            signal_access = "Inherit"
        }
        [
            position = 8984, 8984
        ]

        component "core/Probe" is_n {
            execution_rate = "Ts_Control"
            signal_access = "Inherit"
        }
        [
            position = 8984, 8756
        ]

        component Subsystem Plant {
            layout = dynamic
            component "core/Bus Split" "Bus Split1" {
                execution_rate = "Ts_Control"
                outputs = "3"
            }
            [
                position = 7160, 8472
            ]

            component "core/Voltage Source" Vdc_link {
                init_const_value = "800.0"
                param_set = ""
            }
            [
                position = 6824, 8144
                rotation = right
            ]

            component "core/Capacitor" Cdc {
                capacitance = "2e-3"
            }
            [
                position = 6976, 8136
                rotation = right
            ]

            component "core/Resistor" Rdc {
                resistance = "50e-3"
            }
            [
                position = 6896, 8048
            ]

            component "core/Voltage Measurement" vs_a {
                addr = "7"
                execution_rate = "Tfast"
                sig_output = "True"
            }
            [
                position = 9560, 8364
                rotation = right
                scale = -1, 1
                size = 64, 32
            ]

            component "core/Voltage Measurement" v_sb {
                addr = "9"
                execution_rate = "Tfast"
                sig_output = "True"
            }
            [
                position = 9632, 8412
                rotation = right
                scale = -1, 1
                size = 64, 32
            ]

            component "core/Voltage Measurement" vs_c {
                addr = "11"
                execution_rate = "Tfast"
                sig_output = "True"
            }
            [
                position = 9712, 8460
                rotation = right
                scale = -1, 1
                size = 64, 32
            ]

            component "core/Current Measurement" is_a {
                addr = "14"
                execution_rate = "Tfast"
                sig_output = "True"
            }
            [
                position = 8936, 8064
                scale = 1, -1
                size = 64, 32
            ]

            component "core/Current Measurement" is_b {
                addr = "15"
                execution_rate = "Tfast"
                sig_output = "True"
            }
            [
                position = 8940, 8160
                scale = 1, -1
                size = 64, 32
            ]

            component "core/Current Measurement" is_c {
                addr = "16"
                execution_rate = "Tfast"
                sig_output = "True"
            }
            [
                position = 8932, 8256
                scale = 1, -1
                size = 64, 32
            ]

            component "core/Current Measurement" Idc_link {
                addr = "7"
                execution_rate = "Tfast"
            }
            [
                position = 7176, 8048
                scale = 1, -1
                size = 64, 32
            ]

            component "core/Voltage Measurement" VDC {
                execution_rate = "Tfast"
                sig_output = "True"
            }
            [
                position = 7080, 8144
                rotation = right
                size = 64, 32
            ]

            component "core/Triple Pole Single Throw Contactor" S1 {
                ctrl_src = "Model"
            }
            [
                position = 9344, 8160
                size = 64, 256
            ]

            component "core/Step" contactor {
                execution_rate = "Ts_Control"
                step_time = "T_on_contactor"
            }
            [
                position = 9228, 7952
            ]

            component "core/Series RLC Branch" "VSC side inductor_Rt_Lt" {
                branch_type = "RL"
                inductance = "Lt"
                num_phases = "Three-Phase"
                resistance = "Rt"
            }
            [
                position = 8004, 8156
                size = 128, 256
            ]

            component "core/Series RLC Branch" "Capacitor and dampin resistor" {
                branch_type = "RC"
                capacitance = "C"
                inductance = "Lt"
                num_phases = "Three-Phase"
                resistance = "Rd"
            }
            [
                position = 8288, 8448
                rotation = right
                size = 128, 256
            ]

            component "core/Series RLC Branch" "Grid side inductor_Rs_Ls" {
                branch_type = "RL"
                inductance = "Ls"
                num_phases = "Three-Phase"
                resistance = "Rs"
            }
            [
                position = 9148, 8160
                size = 128, 256
            ]

            component "core/Ground" gnd5 {
            }
            [
                position = 10056, 8276
                hide_name = True
            ]

            component "core/Signal Controlled Voltage Source" Vsp1 {
                execution_rate = "Ts_Control"
            }
            [
                position = 9884, 8064
                size = 64, 32
            ]

            component "core/Signal Controlled Voltage Source" Vsp2 {
                execution_rate = "Ts_Control"
            }
            [
                position = 9880, 8160
                size = 64, 32
            ]

            component "core/Signal Controlled Voltage Source" Vsp3 {
                execution_rate = "Ts_Control"
            }
            [
                position = 9876, 8256
                size = 64, 32
            ]

            component "core/C function" "C function1" {
                arb_defs = "/*Begin code section*/

/*End code section*/"
                execution_rate = "Ts_Control"
                global_variables = "real theta;"
                init_fnc = "/*Begin code section*/
theta = 0.0;
/*End code section*/"
                input_terminals = "real t;"
                input_terminals_dimensions = "1"
                input_terminals_feedthrough = "True"
                input_terminals_show_labels = "True"
                output_fnc = "/*Begin code section*/
omega = 2.0*M_PI*50.0;
f = omega/(2.0*M_PI);
delta_t = 0.0;
vga =326.5*sin(omega*t);
vgb =326.5*sin(omega*t - 2.0*M_PI/3.0);
vgc = 326.5*sin(omega*t + 2.0*M_PI/3.0);
if (t<3.0){
    omega = 2.0*M_PI*50.0;
}
if (t>=4.0){
    delta_t = t-4.0;
    omega = 2.0*M_PI*50.0 - 2.0*M_PI*0.5*delta_t;
}
if (t>=5.0){
    omega = 2.0*M_PI*49.5;
}

vga =326.5*sin(theta);
vgb =326.5*sin(theta - 2.0*M_PI/3.0);
vgc = 326.5*sin(theta+ 2.0*M_PI/3.0);
/*End code section*/"
                output_terminals = "real vga;real vgb;real vgc;real delta_t;real omega;real f;"
                output_terminals_dimensions = "1;1;1;1;1;1"
                output_terminals_feedthrough = "True;True;True;True;True;True"
                output_terminals_show_labels = "True;True;True;True;True;True"
                parameters = "real Ts_Control;"
                update_fnc = "/*Begin code section*/
theta = theta + Ts_Control*omega;
if (theta>=2*M_PI){
    theta = theta - 2*M_PI;
}
if (theta<0.0){
    theta = theta + abs(theta);
}
/*End code section*/"
            }
            [
                position = 9532, 7748
                size = 224, 288
            ]

            component "core/Scope" omega_f_grid {
                selected_signals = "[\'Plant.omega_grid\', \'Plant.f_grid\']"
                signals_data = "{\"signals\": {\"Plant.omega_grid\": {\"viewports\": [1], \"type\": \"analog\", \"color\": {\"1\": \"#FF0000\"}, \"display\": {\"1\": \"solid\"}}, \"Plant.f_grid\": {\"viewports\": [2], \"type\": \"analog\", \"color\": {\"2\": \"#FF0000\"}, \"display\": {\"2\": \"solid\"}}}, \"viewports\": {\"1\": {\"log_scale_x\": false, \"log_scale_y\": false, \"y_axis_db\": false}, \"2\": {\"log_scale_x\": false, \"log_scale_y\": false, \"y_axis_db\": false}, \"3\": {\"log_scale_x\": false, \"log_scale_y\": false, \"y_axis_db\": false}, \"4\": {\"log_scale_x\": false, \"log_scale_y\": false, \"y_axis_db\": false}}, \"plot_settings\": {\"layout\": \"Vertical\", \"background_color\": \"white\", \"legend_visible\": true}}"
            }
            [
                position = 9884, 7744
            ]

            component "core/Probe" omega_grid {
                execution_rate = "Ts_Control"
                signal_access = "Inherit"
            }
            [
                position = 9740, 7820
            ]

            component "core/Probe" f_grid {
                execution_rate = "Ts_Control"
                signal_access = "Inherit"
            }
            [
                position = 9724, 7868
            ]

            component "core/Termination" Termination1 {
            }
            [
                position = 9724, 7772
            ]

            component "core/Half Bridge" "Half Bridge1" {
                carrier_freq = "fs"
                ctrl_src = "Internal modulator"
                d_time = "dt"
                execution_rate = "0.1e-6"
                fvd_def_method = "LUT"
            }
            [
                position = 7724, 8492
                size = 80, 192
            ]

            component "core/Half Bridge" "Half Bridge2" {
                carrier_freq = "fs"
                ctrl_src = "Internal modulator"
                d_time = "dt"
                execution_rate = "0.1e-6"
                fvd_def_method = "LUT"
            }
            [
                position = 7596, 8264
                size = 80, 192
            ]

            component "core/Half Bridge" "Half Bridge3" {
                carrier_freq = "fs"
                ctrl_src = "Internal modulator"
                d_time = "dt"
                execution_rate = "0.1e-6"
                fvd_def_method = "LUT"
            }
            [
                position = 7488, 8040
                size = 80, 192
            ]

            component "core/Half Bridge" "Half Bridge4" {
                carrier_freq = "fs"
                ctrl_src = "Internal modulator"
                d_time = "dt"
                execution_rate = "0.1e-6"
                fvd_def_method = "LUT"
            }
            [
                position = 7360, 7824
                size = 80, 192
            ]

            component "core/Series RLC Branch" "Series RLC Branch1" {
                branch_type = "RL"
                inductance = "Ln"
                resistance = "Rn"
            }
            [
                position = 7936, 8496
                size = 128, 100
            ]

            component "core/Current Measurement" is_a1 {
                addr = "14"
                execution_rate = "Tfast"
                sig_output = "True"
            }
            [
                position = 9012, 8612
                scale = 1, -1
                size = 64, 32
            ]

            component "core/Step" Step1 {
                execution_rate = "Ts_Control"
                step_time = "T_on_contactor"
            }
            [
                position = 7020, 7808
            ]

            component "core/Three Phase Core Coupling" "Core Coupling 1" {
            }
            [
                position = 8632, 8416
                size = 12, 256
            ]

            port eta_abc {
                position = auto:auto
                kind = sp
                direction =  out
                sp_type {
                    default = auto
                    readonly = True
                }
            }
            [
                position = 7008, 8472
            ]

            port eta_n {
                position = auto:auto
                kind = sp
                direction =  out
                sp_type {
                    default = auto
                    readonly = True
                }
            }
            [
                position = 7628, 8500
            ]

            tag Goto22 {
                value = "vs_a"
                scope = global
                kind = sp
                direction = in
            }
            [
                position = 9464, 8364
                hide_name = True
                scale = -1, 1
                size = 60, 20
            ]

            tag Goto23 {
                value = "vs_b"
                scope = global
                kind = sp
                direction = in
            }
            [
                position = 9464, 8412
                hide_name = True
                scale = -1, 1
                size = 60, 20
            ]

            tag Goto24 {
                value = "vs_c"
                scope = global
                kind = sp
                direction = in
            }
            [
                position = 9464, 8460
                hide_name = True
                scale = -1, 1
                size = 60, 20
            ]

            tag Goto25 {
                value = "is_c"
                scope = global
                kind = sp
                direction = in
            }
            [
                position = 8844, 8304
                hide_name = True
                scale = -1, 1
                size = 60, 20
            ]

            tag Goto26 {
                value = "is_b"
                scope = global
                kind = sp
                direction = in
            }
            [
                position = 8848, 8208
                hide_name = True
                scale = -1, 1
                size = 60, 20
            ]

            tag Goto27 {
                value = "is_a"
                scope = global
                kind = sp
                direction = in
            }
            [
                position = 8844, 8112
                hide_name = True
                scale = -1, 1
                size = 60, 20
            ]

            tag Goto42 {
                value = "v_dc"
                scope = global
                kind = sp
                direction = in
            }
            [
                position = 7176, 8144
                hide_name = True
                size = 60, 20
            ]

            tag From83 {
                value = "vga"
                scope = global
                kind = sp
                direction = out
            }
            [
                position = 9792, 8024
                hide_name = True
                size = 60, 20
            ]

            tag From84 {
                value = "vgb"
                scope = global
                kind = sp
                direction = out
            }
            [
                position = 9780, 8104
                hide_name = True
                size = 60, 20
            ]

            tag From85 {
                value = "vgc"
                scope = global
                kind = sp
                direction = out
            }
            [
                position = 9792, 8212
                hide_name = True
                size = 60, 20
            ]

            tag From82 {
                value = "time"
                scope = global
                kind = sp
                direction = out
            }
            [
                position = 9344, 7748
                hide_name = True
                size = 60, 20
            ]

            tag Goto46 {
                value = "vga"
                scope = global
                kind = sp
                direction = in
            }
            [
                position = 9720, 7628
                hide_name = True
                size = 60, 20
            ]

            tag Goto47 {
                value = "vgb"
                scope = global
                kind = sp
                direction = in
            }
            [
                position = 9716, 7676
                hide_name = True
                size = 60, 20
            ]

            tag Goto48 {
                value = "vgc"
                scope = global
                kind = sp
                direction = in
            }
            [
                position = 9720, 7724
                hide_name = True
                size = 60, 20
            ]

            tag Goto49 {
                value = "eta_a"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 7244, 8412
                hide_name = True
                size = 60, 20
            ]

            tag Goto50 {
                value = "eta_b"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 7272, 8472
                hide_name = True
                size = 60, 20
            ]

            tag Goto51 {
                value = "eta_c"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 7244, 8516
                hide_name = True
                size = 60, 20
            ]

            tag From86 {
                value = "eta_a"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 7260, 7896
                hide_name = True
                size = 60, 20
            ]

            tag From87 {
                value = "eta_b"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 7392, 8148
                hide_name = True
                size = 60, 20
            ]

            tag From88 {
                value = "eta_c"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 7480, 8376
                hide_name = True
                size = 60, 20
            ]

            tag Goto52 {
                value = "is_n"
                scope = global
                kind = sp
                direction = in
            }
            [
                position = 8920, 8676
                hide_name = True
                scale = -1, 1
                size = 60, 20
            ]

            junction Junction150 pe
            [
                position = 7080, 8048
            ]

            junction Junction173 pe
            [
                position = 6976, 8048
            ]

            junction Junction220 pe
            [
                position = 8192, 8060
            ]

            junction Junction221 pe
            [
                position = 8288, 8156
            ]

            junction Junction222 pe
            [
                position = 8384, 8252
            ]

            junction Junction223 pe
            [
                position = 9928, 8160
            ]

            junction Junction225 pe
            [
                position = 9712, 8256
            ]

            junction Junction226 pe
            [
                position = 9632, 8160
            ]

            junction Junction227 pe
            [
                position = 9560, 8064
            ]

            junction Junction228 pe
            [
                position = 7600, 8596
            ]

            junction Junction229 pe
            [
                position = 7488, 8592
            ]

            junction Junction230 pe
            [
                position = 7360, 8276
            ]

            junction Junction231 pe
            [
                position = 6976, 8280
            ]

            junction Junction232 pe
            [
                position = 7076, 8280
            ]

            junction Junction233 pe
            [
                position = 7600, 8160
            ]

            junction Junction234 pe
            [
                position = 7488, 7936
            ]

            junction Junction235 pe
            [
                position = 7360, 7716
            ]

            junction Junction236 pe
            [
                position = 9980, 8184
            ]

            junction Junction237 pe
            [
                position = 8192, 8620
            ]

            junction Junction238 pe
            [
                position = 8284, 8620
            ]

            junction Junction239 pe
            [
                position = 8396, 8620
            ]

            junction Junction241 pe
            [
                position = 9624, 8616
            ]

            junction Junction242 pe
            [
                position = 9712, 8616
            ]

            junction Junction245 sp
            [
                position = 7160, 7808
            ]

            junction Junction246 sp
            [
                position = 7268, 8032
            ]

            junction Junction247 sp
            [
                position = 7328, 8256
            ]

            junction Junction248 pe
            [
                position = 9560, 8612
            ]

            comment Comment2 START <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd"><html><head><meta name="qrichtext" content="1" /><style type="text/css">p, li { white-space: pre-wrap; }</style></head><body style=" font-family:'Arial'; font-size:12pt; font-weight:400; font-style:normal;"><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Three Phase Inverter</p></body></html> ENDCOMMENT 
            [
                position = 7576, 7652
            ]

            comment Comment4 START <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd"><html><head><meta name="qrichtext" content="1" /><style type="text/css">p, li { white-space: pre-wrap; }</style></head><body style=" font-family:'Arial'; font-size:12pt; font-weight:400; font-style:normal;"><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">LCL filter</p></body></html> ENDCOMMENT 
            [
                position = 8348, 7816
            ]

            comment Comment5 START <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd"><html><head><meta name="qrichtext" content="1" /><style type="text/css">p, li { white-space: pre-wrap; }</style></head><body style=" font-family:'Arial'; font-size:12pt; font-weight:400; font-style:normal;"><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:16pt;">Grid</span>   </p></body></html> ENDCOMMENT 
            [
                position = 9780, 7948
            ]

            connect Cdc.p_node Junction173 as Connection385
            connect Goto22 vs_a.out as Connection288
            connect Goto23 v_sb.out as Connection289
            connect Goto24 vs_c.out as Connection290
            connect Junction150 Idc_link.p_node as Connection161
            connect Junction173 Junction150 as Connection384
            connect Rdc.n_node Junction173 as Connection390
            connect VDC.p_node Junction150 as Connection162
            connect Vdc_link.p_node Rdc.p_node as Connection389
            connect Goto27 is_a.out as Connection703
            connect Goto26 is_b.out as Connection704
            connect Goto25 is_c.out as Connection705
            connect Goto42 VDC.out as Connection714
            connect is_a.p_node Junction220 as Connection753
            connect Junction220 "VSC side inductor_Rt_Lt.P1_neg" as Connection754
            connect "Capacitor and dampin resistor.P3_pos" Junction220 as Connection755
            connect "VSC side inductor_Rt_Lt.P2_neg" Junction221 as Connection756
            connect Junction221 is_b.p_node as Connection757
            connect "Capacitor and dampin resistor.P2_pos" Junction221 as Connection758
            connect is_c.p_node Junction222 as Connection759
            connect Junction222 "VSC side inductor_Rt_Lt.P3_neg" as Connection760
            connect "Capacitor and dampin resistor.P1_pos" Junction222 as Connection761
            connect "Grid side inductor_Rs_Ls.P2_pos" is_b.n_node as Connection762
            connect "Grid side inductor_Rs_Ls.P3_pos" is_c.n_node as Connection763
            connect is_a.n_node "Grid side inductor_Rs_Ls.P1_pos" as Connection764
            connect "Grid side inductor_Rs_Ls.P1_neg" S1.a_in as Connection765
            connect "Grid side inductor_Rs_Ls.P2_neg" S1.b_in as Connection766
            connect "Grid side inductor_Rs_Ls.P3_neg" S1.c_in as Connection767
            connect Vsp1.n_node Junction223 as Connection768
            [
                breakpoints = 9928, 8064; 9928, 8160
            ]
            connect Junction223 Vsp2.n_node as Connection769
            connect From83 Vsp1.in as Connection773
            connect From84 Vsp2.in as Connection774
            connect From85 Vsp3.in as Connection775
            connect From82 "C function1.t" as Connection748
            connect "C function1.vgc" Goto48 as Connection779
            connect "C function1.vgb" Goto47 as Connection780
            connect omega_grid.in "C function1.omega" as Connection781
            connect f_grid.in "C function1.f" as Connection782
            connect "C function1.vga" Goto46 as Connection812
            connect Termination1.in "C function1.delta_t" as Connection813
            connect S1.c_out Junction225 as Connection814
            connect Junction225 vs_c.p_node as Connection815
            connect Vsp3.p_node Junction225 as Connection816
            connect v_sb.p_node Junction226 as Connection817
            connect Junction226 S1.b_out as Connection818
            connect Vsp2.p_node Junction226 as Connection819
            connect vs_a.p_node Junction227 as Connection820
            connect Junction227 S1.a_out as Connection821
            connect Vsp1.p_node Junction227 as Connection822
            connect eta_abc "Bus Split1.in" as Connection823
            connect "Half Bridge1.neg_out" Junction228 as Connection835
            connect Junction228 "Half Bridge2.neg_out" as Connection836
            connect "Half Bridge3.neg_out" Junction229 as Connection838
            [
                breakpoints = 7420, 8204; 7420, 8592
            ]
            connect Junction229 Junction228 as Connection839
            connect "Half Bridge4.neg_out" Junction230 as Connection841
            connect Junction230 Junction229 as Connection842
            connect Vdc_link.n_node Junction231 as Connection844
            connect Cdc.n_node Junction231 as Connection846
            connect Junction231 Junction232 as Connection847
            connect Junction232 Junction230 as Connection848
            [
                breakpoints = 7352, 8280
            ]
            connect VDC.n_node Junction232 as Connection849
            [
                breakpoints = 7080, 8272
            ]
            connect "Half Bridge1.pos_out" Junction233 as Connection851
            connect Junction233 "Half Bridge2.pos_out" as Connection852
            [
                breakpoints = 7592, 8160
            ]
            connect "Half Bridge3.pos_out" Junction234 as Connection854
            connect Junction234 Junction233 as Connection855
            connect "Half Bridge4.pos_out" Junction235 as Connection857
            connect Junction235 Junction234 as Connection858
            connect Idc_link.n_node Junction235 as Connection859
            [
                breakpoints = 7224, 8048; 7224, 7716
            ]
            connect "Half Bridge4.a_in" "VSC side inductor_Rt_Lt.P1_pos" as Connection860
            connect "Half Bridge3.a_in" "VSC side inductor_Rt_Lt.P2_pos" as Connection861
            [
                breakpoints = 7748, 8040; 7748, 8156
            ]
            connect "Half Bridge2.a_in" "VSC side inductor_Rt_Lt.P3_pos" as Connection862
            connect "Series RLC Branch1.P1_pos" "Half Bridge1.a_in" as Connection866
            connect eta_n "Half Bridge1.In" as Connection871
            connect Goto51 "Bus Split1.out2" as Connection872
            connect Goto50 "Bus Split1.out1" as Connection873
            connect Goto49 "Bus Split1.out" as Connection874
            connect "Half Bridge4.In" From86 as Connection875
            connect From87 "Half Bridge3.In" as Connection876
            connect From88 "Half Bridge2.In" as Connection877
            connect Vsp3.n_node Junction223 as Connection878
            [
                breakpoints = 9928, 8156
            ]
            connect Junction236 Junction223 as Connection882
            [
                breakpoints = 9980, 8184
            ]
            connect gnd5.node Junction236 as Connection883
            connect "Series RLC Branch1.P1_neg" Junction237 as Connection884
            [
                breakpoints = 8016, 8620
            ]
            connect "Capacitor and dampin resistor.P3_neg" Junction237 as Connection886
            connect Junction237 Junction238 as Connection887
            connect "Capacitor and dampin resistor.P2_neg" Junction238 as Connection889
            connect Junction238 Junction239 as Connection890
            connect Junction239 is_a1.p_node as Connection891
            [
                breakpoints = 8616, 8620
            ]
            connect "Capacitor and dampin resistor.P1_neg" Junction239 as Connection892
            connect v_sb.n_node Junction241 as Connection898
            connect Junction241 Junction242 as Connection899
            connect Junction242 Junction236 as Connection900
            [
                breakpoints = 9980, 8616; 9980, 8404
            ]
            connect vs_c.n_node Junction242 as Connection901
            connect Goto52 is_a1.out as Connection902
            connect Step1.out Junction245 as Connection913
            connect Junction245 "Half Bridge4.En" as Connection914
            connect "Half Bridge3.En" Junction246 as Connection916
            connect Junction246 Junction245 as Connection917
            [
                breakpoints = 7204, 8032; 7204, 7808
            ]
            connect "Half Bridge2.En" Junction247 as Connection919
            connect Junction247 Junction246 as Connection920
            connect "Half Bridge1.En" Junction247 as Connection921
            [
                breakpoints = 7324, 8264
            ]
            connect contactor.out S1.ctrl_in as Connection922
            [
                breakpoints = 9288, 7952
            ]
            connect vs_a.n_node Junction248 as Connection924
            connect Junction248 Junction241 as Connection925
            [
                breakpoints = 9560, 8612; 9556, 8616; 9600, 8616
            ]
            connect is_a1.n_node Junction248 as Connection926
        }
        [
            position = 8232, 8292
            size = 248, 224
        ]

        component "core/Scope" vs_abc {
            selected_signals = "[\'vs_a\', \'vs_b\', \'vs_c\']"
            signals_data = "{\"signals\": {\"vs_a\": {\"viewports\": [1], \"type\": \"analog\", \"color\": {\"1\": \"#FF0000\"}, \"display\": {\"1\": \"solid\"}}, \"vs_b\": {\"viewports\": [1], \"type\": \"analog\", \"color\": {\"1\": \"#00CC00\"}, \"display\": {\"1\": \"solid\"}}, \"vs_c\": {\"viewports\": [1], \"type\": \"analog\", \"color\": {\"1\": \"#0099FF\"}, \"display\": {\"1\": \"solid\"}}}, \"viewports\": {\"1\": {\"log_scale_x\": false, \"log_scale_y\": false, \"y_axis_db\": false}, \"2\": {\"log_scale_x\": false, \"log_scale_y\": false, \"y_axis_db\": false}, \"3\": {\"log_scale_x\": false, \"log_scale_y\": false, \"y_axis_db\": false}, \"4\": {\"log_scale_x\": false, \"log_scale_y\": false, \"y_axis_db\": false}}, \"plot_settings\": {\"layout\": \"Vertical\", \"background_color\": \"white\", \"legend_visible\": true}}"
        }
        [
            position = 9100, 8920
        ]

        component "core/SCADA Input" p_m_a_ref {
            execution_rate = "Ts_Control"
            unit = ""
        }
        [
            position = 8472, 8072
        ]

        component "core/SCADA Input" q_s_a_ref {
            execution_rate = "Ts_Control"
            unit = ""
        }
        [
            position = 8472, 8148
        ]

        component "core/SCADA Input" p_m_b_ref {
            execution_rate = "Ts_Control"
            unit = ""
        }
        [
            position = 8464, 8224
        ]

        component "core/SCADA Input" q_s_b_ref {
            execution_rate = "Ts_Control"
            unit = ""
        }
        [
            position = 8464, 8300
        ]

        component "core/SCADA Input" p_m_c_ref {
            execution_rate = "Ts_Control"
            unit = ""
        }
        [
            position = 8464, 8380
        ]

        component "core/SCADA Input" q_s_c_ref {
            execution_rate = "Ts_Control"
            unit = ""
        }
        [
            position = 8464, 8456
        ]

        tag From50 {
            value = "p"
            scope = global
            kind = sp
            direction = out
        }
        [
            position = 8464, 8540
            hide_name = True
            size = 60, 20
        ]

        tag From51 {
            value = "q"
            scope = global
            kind = sp
            direction = out
        }
        [
            position = 8460, 8608
            hide_name = True
            size = 60, 20
        ]

        tag From52 {
            value = "p_fil"
            scope = global
            kind = sp
            direction = out
        }
        [
            position = 8464, 8680
            hide_name = True
            size = 60, 20
        ]

        tag From75 {
            value = "is_a"
            scope = global
            kind = sp
            direction = out
        }
        [
            position = 8864, 8544
            hide_name = True
            size = 60, 20
        ]

        tag From76 {
            value = "is_b"
            scope = global
            kind = sp
            direction = out
        }
        [
            position = 8864, 8608
            hide_name = True
            size = 60, 20
        ]

        tag From77 {
            value = "is_c"
            scope = global
            kind = sp
            direction = out
        }
        [
            position = 8864, 8676
            hide_name = True
            size = 60, 20
        ]

        tag From44 {
            value = "vs_a"
            scope = global
            kind = sp
            direction = out
        }
        [
            position = 7864, 8564
            hide_name = True
            size = 60, 20
        ]

        tag From45 {
            value = "vs_b"
            scope = global
            kind = sp
            direction = out
        }
        [
            position = 7864, 8612
            hide_name = True
            size = 60, 20
        ]

        tag From46 {
            value = "vs_c"
            scope = global
            kind = sp
            direction = out
        }
        [
            position = 7864, 8660
            hide_name = True
            size = 60, 20
        ]

        tag From47 {
            value = "is_a"
            scope = global
            kind = sp
            direction = out
        }
        [
            position = 7864, 8708
            rotation = down
            hide_name = True
            scale = -1, 1
            size = 60, 20
        ]

        tag From48 {
            value = "is_b"
            scope = global
            kind = sp
            direction = out
        }
        [
            position = 7864, 8756
            rotation = down
            hide_name = True
            scale = -1, 1
            size = 60, 20
        ]

        tag From49 {
            value = "is_c"
            scope = global
            kind = sp
            direction = out
        }
        [
            position = 7864, 8804
            rotation = down
            hide_name = True
            scale = -1, 1
            size = 60, 20
        ]

        tag Goto32 {
            value = "p"
            scope = global
            kind = sp
            direction = in
        }
        [
            position = 8272, 8552
            hide_name = True
            size = 60, 20
        ]

        tag Goto33 {
            value = "q"
            scope = global
            kind = sp
            direction = in
        }
        [
            position = 8272, 8640
            hide_name = True
            size = 60, 20
        ]

        tag Goto34 {
            value = "p_fil"
            scope = global
            kind = sp
            direction = in
        }
        [
            position = 8272, 8728
            hide_name = True
            size = 60, 20
        ]

        tag Goto35 {
            value = "q_fil"
            scope = global
            kind = sp
            direction = in
        }
        [
            position = 8272, 8816
            hide_name = True
            size = 60, 20
        ]

        tag From78 {
            value = "q_fil"
            scope = global
            kind = sp
            direction = out
        }
        [
            position = 8464, 8756
            hide_name = True
            size = 60, 20
        ]

        tag From79 {
            value = "vs_a"
            scope = global
            kind = sp
            direction = out
        }
        [
            position = 8860, 8852
            hide_name = True
            size = 60, 20
        ]

        tag From80 {
            value = "vs_b"
            scope = global
            kind = sp
            direction = out
        }
        [
            position = 8860, 8916
            hide_name = True
            size = 60, 20
        ]

        tag From81 {
            value = "vs_c"
            scope = global
            kind = sp
            direction = out
        }
        [
            position = 8860, 8984
            hide_name = True
            size = 60, 20
        ]

        tag From82 {
            value = "is_n"
            scope = global
            kind = sp
            direction = out
        }
        [
            position = 8860, 8756
            hide_name = True
            size = 60, 20
        ]

        comment Comment8 START <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd"><html><head><meta name="qrichtext" content="1" /><style type="text/css">p, li { white-space: pre-wrap; }</style></head><body style=" font-family:'Arial'; font-size:12pt; font-weight:400; font-style:normal;"><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:16pt;">This file contains a grid-forming based on a PI Virtual Synchronous Generator. This controller and its validation was proposed by:</span></p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:16pt;">-Juan Manuel Mauricio, Associate Professor of the Department of Electrical Engineering at the University of Sevilla, Spain</span></p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:16pt;">-Georgios C. Kryonidis, Postdoctoral Researcher of the School of Electrical and Computer Engineering at the Aristotle Universiy of Thesaloniki, Greece</span></p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:16pt;">-Manuel Barragan-Villarejo, Associate Professor of the Department of Electrical Engineering at the University of Sevilla, Spain</span></p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:16pt;">-Kyriaki-Nefeli Malamaki, Postdoctoral Researcher of the School of Electrical and Computer Engineering at the Aristotle Universiy of Thesaloniki, Greece</span></p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:16pt;">-Jose Maria Maza-Ortega, Full Professor of the Department of Electrical Engineering at the University of Sevilla, Spain</span></p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:16pt;">-Charis S. Demoulias, Full Professor of the School of Electrical and Computer Engineering at the Aristotle Universiy of Thesaloniki, Greece</span></p><p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-size:16pt;"><br /></p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:16pt;">The proposed grid-forming PI-VSG can be found in the following papers:</span></p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="LPlnk187793"></a><a href="https://www.sciencedirect.com/science/article/abs/pii/S0378779623004960"><span style=" font-family:'Aptos','Aptos_EmbeddedFont','Aptos_MSFontService','Calibri','Helvetica','sans-serif'; text-decoration: underline; color:#0000ff;">h</span></a><span style=" font-family:'Aptos','Aptos_EmbeddedFont','Aptos_MSFontService','Calibri','Helvetica','sans-serif'; text-decoration: underline; color:#0000ff;">ttps://www.sciencedirect.com/science/article/abs/pii/S0378779623004960</span></p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="LPlnk353700"></a><a href="https://www.sciencedirect.com/science/article/abs/pii/S0142061522001144"><span style=" font-family:'Aptos','Aptos_EmbeddedFont','Aptos_MSFontService','Calibri','Helvetica','sans-serif'; text-decoration: underline; color:#0000ff;">h</span></a><span style=" font-family:'Aptos','Aptos_EmbeddedFont','Aptos_MSFontService','Calibri','Helvetica','sans-serif'; text-decoration: underline; color:#0000ff;">ttps://www.sciencedirect.com/science/article/abs/pii/S0142061522001144</span></p></body></html> ENDCOMMENT 
        [
            position = 7892, 7768
        ]

        connect p.in From50 as Connection451
        connect From51 q.in as Connection453
        connect From52 p_fil.in as Connection455
        connect From75 is_a.in as Connection715
        connect From76 is_b.in as Connection716
        connect From77 is_c.in as Connection717
        connect Goto32 "C function powers.p" as Connection450
        connect Goto33 "C function powers.q" as Connection452
        connect "C function powers.p_f" Goto34 as Connection454
        connect From44 "C function powers.v_a" as Connection654
        connect "C function powers.v_b" From45 as Connection655
        connect From46 "C function powers.v_c" as Connection656
        connect From47 "C function powers.i_a" as Connection657
        connect From48 "C function powers.i_b" as Connection658
        connect From49 "C function powers.i_c" as Connection659
        connect Goto35 "C function powers.q_f" as Connection718
        connect From78 q_fil.in as Connection719
        connect From79 vs_a.in as Connection720
        connect From80 vs_b.in as Connection721
        connect From81 vs_c.in as Connection722
        connect From82 is_n.in as Connection725
        connect Controller.eta_abc Plant.eta_abc as Connection726
        [
            breakpoints = 8892, 8060; 8092, 8060
        ]
        connect Controller.eta_n Plant.eta_n as Connection727
        [
            breakpoints = 8892, 8512; 8092, 8512
        ]
        connect p_m_a_ref.out Controller.p_m_a_ref as Connection728
        connect Controller.q_s_a_ref q_s_a_ref.out as Connection729
        connect p_m_b_ref.out Controller.p_m_b_ref as Connection730
        connect Controller.q_s_b_ref q_s_b_ref.out as Connection731
        connect p_m_c_ref.out Controller.p_m_c_ref as Connection732
        connect q_s_c_ref.out Controller.q_s_c_ref as Connection733
    }

    logically_deleted {
        "Powers"
        "p"
        "q"
        "p_fil"
        "Controller.pref"
        "Controller.qref"
        "Controller.VSG_a.is_al_ref"
        "Controller.VSG_a.e"
        "Controller.VSG_a.is_d"
        "Controller.VSG_a.is_q"
        "Controller.VSG_a.vs_d"
        "Controller.VSG_a.vs_q"
        "Controller.VSG_a.Bus Split2"
        "Controller.VSG_a.is_d_ref"
        "Controller.VSG_a.is_q_ref"
        "Controller.VSG_a.is_albe_ref"
        "Controller.VSG_a.From128"
        "Controller.VSG_a.Connection931"
        "Controller.VSG_a.Connection937"
        "Controller.VSG_a.Connection946"
        "Controller.VSG_a.Connection949"
        "Controller.VSG_a.Connection952"
        "Controller.VSG_a.Connection955"
        "Controller.VSG_a.Connection958"
        "Controller.VSG_a.Connection959"
        "Controller.VSG_a.Connection960"
        "Controller.pref1"
        "Controller.qref1"
        "Controller.pref2"
        "Controller.qref2"
        "Controller.C function1"
        "Controller.C function2"
        "Controller.C function3"
        "Controller.is_a_al"
        "Controller.Bus Split1"
        "Controller.is_b_al"
        "Controller.vs_a_al"
        "Controller.Bus Split2"
        "Controller.vs_a_be"
        "Controller.VSG_b.is_al_ref"
        "Controller.VSG_b.is_be_ref"
        "Controller.VSG_b.e"
        "Controller.VSG_b.is_d"
        "Controller.VSG_b.is_q"
        "Controller.VSG_b.vs_d"
        "Controller.VSG_b.vs_q"
        "Controller.VSG_b.Bus Split2"
        "Controller.VSG_b.is_d_ref"
        "Controller.VSG_b.is_q_ref"
        "Controller.VSG_b.is_albe_ref"
        "Controller.VSG_b.From128"
        "Controller.VSG_b.Connection931"
        "Controller.VSG_b.Connection934"
        "Controller.VSG_b.Connection959"
        "Controller.VSG_b.Connection960"
        "Controller.VSG_b.Connection1003"
        "Controller.VSG_b.Connection1008"
        "Controller.VSG_b.Connection1014"
        "Controller.VSG_b.Connection1018"
        "Controller.VSG_b.Connection1020"
        "Controller.VSG_b.Connection1024"
        "Controller.From148"
        "Controller.From149"
        "Controller.From150"
        "Controller.From157"
        "Controller.From158"
        "Controller.Connection1107"
        "Controller.Connection1178"
        "Controller.Connection1180"
        "Controller.Connection1194"
        "Controller.Connection1195"
        "Controller.Connection1196"
        "Controller.Connection1197"
        "Controller.Connection1198"
        "Controller.Connection1199"
        "Controller.VSG_b1.is_albe_ref"
        "Controller.VSG_b1.From128"
        "Controller.VSG_b1.is_q_ref"
        "Controller.VSG_b1.is_al_ref"
        "Controller.VSG_b1.is_be_ref"
        "Controller.VSG_b1.e"
        "Controller.VSG_b1.is_d"
        "Controller.VSG_b1.is_q"
        "Controller.VSG_b1.vs_d"
        "Controller.VSG_b1.vs_q"
        "Controller.VSG_b1.Bus Split2"
        "Controller.VSG_b1.is_d_ref"
        "Controller.VSG_b1.Connection1020"
        "Controller.VSG_b1.Connection1014"
        "Controller.VSG_b1.Connection1003"
        "Controller.VSG_b1.Connection1008"
        "Controller.VSG_b1.Connection959"
        "Controller.VSG_b1.Connection960"
        "Controller.VSG_b1.Connection1018"
        "Controller.VSG_b1.Connection1024"
        "Controller.VSG_b1.Connection931"
        "Controller.VSG_b1.Connection934"
        "C function powers"
        "q_fil"
        "Plant.Core Coupling 1"
        "From50"
        "From51"
        "From52"
        "From44"
        "From45"
        "From46"
        "From47"
        "From48"
        "From49"
        "Goto32"
        "Goto33"
        "Goto34"
        "Goto35"
        "From78"
        "Connection451"
        "Connection453"
        "Connection455"
        "Connection450"
        "Connection452"
        "Connection454"
        "Connection654"
        "Connection655"
        "Connection656"
        "Connection657"
        "Connection658"
        "Connection659"
        "Connection718"
        "Connection719"
    }

    default {
        "core/Bus Join" {
            inputs = "2"
            execution_rate = "inherit"
        }

        "core/Bus Split" {
            outputs = "2"
            execution_rate = "inherit"
        }

        "core/C function" {
            input_terminals = "real in;"
            input_terminals_show_labels = "False;"
            input_terminals_feedthrough = "True;"
            input_terminals_dimensions = "inherit;"
            output_terminals = "real out;"
            output_terminals_show_labels = "False;"
            output_terminals_feedthrough = "True;"
            output_terminals_dimensions = "inherit;"
            output_fnc = ""
            update_fnc = ""
            init_fnc = ""
            global_variables = ""
            parameters = ""
            library_load_type = "Compile-time load"
            dll_file_path = ""
            dll_file_path_full = ""
            arm_a9_file_path = ""
            arm_a9_file_path_full = ""
            arm_a53_file_path = ""
            arm_a53_file_path_full = ""
            h_file_path = ""
            h_file_path_full = ""
            add_src_path = ""
            add_src_path_full = ""
            convert_to_relative_dll = "True"
            convert_to_relative_a = "True"
            convert_to_relative_src = "True"
            arb_defs = ""
            add_macros = ""
            skip_pre_cmpl_check = "False"
            generate_for_hil = "True"
            execution_rate = "inherit"
            _supported_platforms = "[\'generic\']"
            refresh = "refresh"
        }

        "core/Capacitor" {
            signal_access = "inherit"
            capacitance = "1e-6"
            initial_voltage = "0"
            pole_shift_ignore = "False"
            visible = "True"
        }

        "core/Clock" {
            enb_reset = "False"
            reset_at = "1.0"
            execution_rate = "100e-6"
        }

        "core/Constant" {
            value = "1"
            signal_type = "real"
            execution_rate = "100e-6"
            _tunable = "False"
        }

        "core/Discrete Transfer Function" {
            domain = "Z-domain"
            method = "Zero-order hold"
            b_coeff = "[1,1]"
            a_coeff = "[1,1]"
            signal_out_type = "inherit"
            execution_rate = "inherit"
        }

        "core/Gain" {
            gain = "1"
            multiplication = "Element-wise(K.*u)"
            _tunable = "False"
            execution_rate = "inherit"
        }

        "core/Integrator" {
            show_reset = "none"
            reset_type = "asynchronous"
            show_init_condition = "internal"
            init_value = "0"
            limit_output = "False"
            limit_upper = "inf"
            limit_lower = "-inf"
            show_state = "False"
            state_port_type = "inherit"
            execution_rate = "inherit"
        }

        "core/Probe" {
            signal_access = "inherit"
            addr = "0"
            override_signal_name = "False"
            signal_name = ""
            signal_type = "generic"
            streaming_en = "False"
            streaming_er_idx = "0"
            execution_rate = "inherit"
        }

        "core/Product" {
            signs = "2"
            execution_rate = "inherit"
        }

        "core/Resistor" {
            resistance = "1"
            param_set = ""
        }

        "core/SCADA Input" {
            signal_access = "inherit"
            addr = "0"
            format = "real"
            override_signal_name = "False"
            signal_name = ""
            signal_type = "real"
            min = "-1e6"
            max = "1e6"
            def_value = "0"
            unit = " "
            execution_rate = "100e-6"
        }

        "core/Scope" {
            signals_data = "{}"
            selected_signals = "[]"
        }

        "core/Signal switch" {
            criterion = "ctrl > threshold"
            threshold = "0.5"
            execution_rate = "inherit"
        }

        "core/Step" {
            step_time = "1"
            initial_value = "0"
            final_value = "1"
            signal_type = "real"
            execution_rate = "100e-6"
        }

        "core/Sum" {
            signs = "2"
            execution_rate = "inherit"
        }

        "core/Termination" {
            execution_rate = "inherit"
        }

        "core/Unit Delay" {
            init_value = "0"
            signal_out_type = "inherit"
            execution_rate = "inherit"
        }

        "core/Voltage Source" {
            sig_input = "False"
            type = "signal generator"
            param_set = "1phase"
            parent_label = ""
            dtsm_switch_name = ""
            addr = "0"
            spc_nb = "0"
            execution_rate = "100e-6"
            cpd_visible = "True"
            enable_snb = "False"
            snb_type = "R2"
            R2 = "0.0"
            L1 = "0.1"
            override_signal_name = "False"
            signal_name = ""
            init_source_nature = "Constant"
            init_const_value = "0.0"
            init_rms_value = "0.0"
            init_frequency = "50.0"
            init_phase = "0.0"
        }

        "core/Advanced Low-Pass Filter" {
            type_combo = "Chebyshev1"
            N = "5"
            fc_combo = "Internal"
            fc = "500"
            apb = "fc"
            asb = "40"
            ch_1 = "0"
            ch_2 = "0"
            ch_3 = "0"
            ep = "0"
            es = "0"
            Ke = "0"
            d0e = "0"
            Ne = "0"
            execution_rate = "10e-6"
            bode_plot = "Bode plot"
        }

        "core/Current Measurement" {
            signal_access = "inherit"
            bw_limit = "False"
            frequency = "10e3"
            comparator_enable = "False"
            operator = "greater"
            threshold = "0"
            cmp_abs_value = "False"
            feed_forward = "false"
            sig_output = "False"
            sig_output_filt_and_full_bw = "False"
            execution_rate = "100e-6"
            addr = "0"
            nd_msr_estimation = "false"
            dev_cpl_msr = "false"
            host_device = "0"
            output_to_device = "0"
            dev_cpl_index = "0"
            dev_cpl_var_nb = "0"
            visible = "True"
            override_signal_name = "False"
            signal_name = ""
        }

        "core/Half Bridge" {
            signal_access = "inherit"
            model_type = "Global GDS oversampling"
            ctrl_src = "Digital input per switch"
            op_mode = "Fixed carrier frequency"
            carrier_freq = "10000.0"
            phase_op_mode = "Fixed carrier phase offset"
            carr_ph_offset = "0.0"
            d_time = "5e-6"
            ref_sig_min_max = "[-1.0, 1.0]"
            load_mode = "on min"
            execution_rate = "inherit"
            S_top = "1"
            S_top_logic = "active high"
            S_bot = "2"
            S_bot_logic = "active high"
            S_top_I = "False"
            S_bot_I = "False"
            _control_property = "all high"
            switches_names_at_mask = "[]"
            pwm_enabling = "False"
            pwm_enable_di = "13"
            pwm_enable_inv = "active high"
            delay_enabled = "False"
            fixed_delay = "1e-6"
            var_delay_lut = "[-10.0, 1e-6, 10.0, 1e-6]"
            preview_var_delay = "Preview"
            vout_cmp_pullup_mode = "False"
            vout_cmp_timeout = "5e-6"
            show_monitoring = "False"
            fvd = "False"
            losses_estimation = "False"
            fvd_def_method = "Voltage and Resistance"
            Import_igbt_xml = "not selected"
            Import_diode_xml = "not selected"
            Switch_type = "IGBT"
            Vce = "1.3"
            Rce = "0"
            Vd = "1.2"
            Rd = "0"
            i_sw = "[0.0, 6.0, 12.0, 18.0, 24.0]"
            v_sw = "[0.0, 600.0]"
            temp_sw = "[25.0, 50.0, 75.0, 100.0, 125.0]"
            vce_table_out = "[1.3, 1.3, 1.3, 1.3, 1.3]"
            vd_table_out = "[1.2, 1.2, 1.2, 1.2, 1.2]"
            et_on_table_out = "[[0.0, 0.0275e-3, 0.15e-3, 0.275e-3, 0.3e-3], [0.35*3.8e-3, 0.4*3.8e-3, 0.8*3.8e-3, 0.68*3.8e-3, 0.9*3.8e-3], [0.65*3.8e-3, 0.9*3.8e-3, 1.2*3.8e-3, 1.5*3.8e-3, 1.7*3.8e-3], [0.9*3.8e-3, 1.3*3.8e-3, 1.7*3.8e-3, 1.9*3.8e-3, 2.25*3.8e-3], [1.1*3.8e-3, 1.7*3.8e-3, 2.1*3.8e-3, 2.3*3.8e-3, 2.5*3.8e-3]]"
            et_off_table_out = "[[0.0, 0.0275e-3, 0.15e-3, 0.275e-3, 0.3e-3], [0.35*2.1e-3, 0.4*2.1e-3, 0.8*2.1e-3, 0.68*2.1e-3, 0.9*2.1e-3], [0.65*2.1e-3, 0.9*2.1e-3, 1.2*2.1e-3, 1.5*2.1e-3, 1.7*2.1e-3], [0.9*2.1e-3, 1.3*2.1e-3, 1.7*2.1e-3, 1.9*2.1e-3, 2.25*2.1e-3], [1.1*2.1e-3, 1.7*2.1e-3, 2.1*2.1e-3, 2.3*2.1e-3, 2.5*2.1e-3]]"
            ed_off_table_out = "[[0.0, 0.0275e-3, 0.15e-3, 0.275e-3, 0.3e-3], [0.35*2.2e-3, 0.4*2.2e-3, 0.8*2.2e-3, 0.68*2.2e-3, 0.9*2.2e-3], [0.65*2.2e-3, 0.9*2.2e-3, 1.2*2.2e-3, 1.5*2.2e-3, 1.7*2.2e-3], [0.9*2.2e-3, 1.3*2.2e-3, 1.7*2.2e-3, 1.9*2.2e-3, 2.25*2.2e-3], [1.1*2.2e-3, 1.7*2.2e-3, 2.1*2.2e-3, 2.3*2.2e-3, 2.5*2.2e-3]]"
            temp_estimation = "False"
            thermal_networks_type = "Foster"
            switch_Rth = "[0.159, 0.133, 0.120, 0.038]"
            switch_Tth = "[1.1e-1, 1.56e-2, 1.35e-3, 1.51e-4]"
            switch_Cth = "[0.0029, 0.0097, 0.1068, 0.8500]"
            diode_Rth = "[0.159, 0.133, 0.120, 0.038]"
            diode_Tth = "[1.1e-1, 1.56e-2, 1.35e-3, 1.51e-4]"
            diode_Cth = "[0.0029, 0.0097, 0.1068, 0.8500]"
            loss_exec_rate = "100e-6"
            visualize_luts = "Visualize Lookup Tables"
            show_cnt_out = "False"
            PESB_Optimization = "True"
            dtv_flag_en = "True"
            reserved_parameter1 = "0"
            predictive_diode_turn_off = "False"
        }

        "core/Series RLC Branch" {
            num_phases = "Single-Phase"
            branch_type = "RLC"
            resistance = "10"
            inductance = "10e-3"
            initial_current = "0"
            capacitance = "10e-6"
            initial_voltage = "0"
        }

        "core/Signal Controlled Voltage Source" {
            execution_rate = "inherit"
        }

        "core/Three Phase Core Coupling" {
            snb_type_i = "none"
            R1 = "100e3"
            C1 = "1e-06"
            C2 = "1e-06"
            fixed_snb_i = "false"
            snb_type_u = "none"
            R2 = "0.1"
            L1 = "0.1"
            L2 = "0.1"
            fixed_snb_u = "false"
            cpl_connection = "star"
        }

        "core/Triple Pole Single Throw Contactor" {
            signal_access = "inherit"
            switches_option = "False"
            resistance = "1.0"
            ctrl_src = "Digital input"
            Sa = "1"
            Sa_logic = "active high"
            enable_fb_out = "False"
            fb_out_type = "real"
            execution_rate = "inherit"
            dtsm_switch_name = ""
            initial_state = "off"
            on_delay = "0"
            off_delay = "0"
            switching = "zero current"
            hide_int_meas = "False"
        }

        "core/Voltage Measurement" {
            signal_access = "inherit"
            bw_limit = "False"
            frequency = "10e3"
            comparator_enable = "False"
            operator = "greater"
            threshold = "0"
            cmp_abs_value = "False"
            feed_forward = "false"
            sig_output = "False"
            sig_output_filt_and_full_bw = "False"
            execution_rate = "100e-6"
            addr = "0"
            nd_msr_estimation = "false"
            dev_cpl_msr = "false"
            host_device = "0"
            output_to_device = "0"
            dev_cpl_index = "0"
            dev_cpl_var_nb = "0"
            visible = "True"
            override_signal_name = "False"
            signal_name = ""
        }
    }

    CODE model_init
        # Numpy module is imported as 'np'
        # Scipy module is imported as 'sp'
        Tfast = 50e-6
        Ts_Control = 50e-6
        #LPF power
        fc= 30
        # Filter parameter
        Lt=2.5e-3
        Rt=.1
        Ls=Lt
        Rs=Rt
        Rd = 27
        C = 1e-6
        Ln = 5e-3
        Rn = Rt
        # Switching frequency
        fs = 10e3
        #dead time
        dt = 0.1e-6
        
        # PI current controller gains
        tau_c = 1e-3
        L = Ls + Lt
        R = Rs + Rt
        Kp_i = 2*L/tau_c
        Ki_i = R/tau_c
        Kr_i = 2*Ki_i
        
        #Ton contactor
        T_on_contactor = 0.1
        
        #VSG
        S_b = 20e3
        U_b = 400
        I_b = S_b/(np.sqrt(3)*U_b)
        I_bdq = I_b*np.sqrt(2)
        U_bdq = U_b*(np.sqrt(2/3))
        
        H = 5.0 # desired virtual inertia 
        Kp_p = 0.01 # active power proportinal gain
        Ki_p = 1.0/(2.0*H) #proportional gain active power control loop
        Kp_q = 0.1
        Ki_q = 1.0
        Xv = 0.20
        Rv = 0.0
        e_o = 1.0
        omega_base = 1.0
        omega_base_rads = 2*np.pi*50
        f_base_rads = 50
        #LPF VSG
        tau_vsg = 2.4e-3
        
        #PLL control gains
        K_p_pll = 1.8
        K_i_pll = 1.8/0.00251
        #rads to hertz
        rad_2_hertz= 1/(2*np.pi)
        T_on_vsg = 3
    ENDCODE
}
