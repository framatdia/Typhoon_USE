version = 4.2

//
// Saved by sw version: 2025.1 SP1
//

model "pll_testing" {
    configuration {
        hil_device = "HIL101"
        hil_configuration_id = 1
        simulation_method = exact
        simulation_time_step = auto
        simulation_discret_scaling = 1.0
        dsp_timer_periods = 100e-6, 50e-3
        ss_calc_method = "systematic elimination"
        enb_pole_shift = True
        enb_gds_oversampling = True
        show_modes = False
        device_ao_limit_enable = False
        reset_analog_outputs_on_sim_stop = True
        reset_analog_outputs_on_sim_stop_mode = Offset values
        reset_digital_outputs_on_sim_stop = True
        vhil_adio_loopback = False
        cpl_stb = False
        enb_dep_sw_detect = False
        code_section = "internal memory"
        data_section = "internal memory"
        sys_sp_rate_1 = 0.0001
        sys_sp_rate_2 = 0.05
        sys_real_type_precision = "default"
        user_real_type_precision = "default"
        sys_cpu_optimization = "high"
        user_cpu_optimization = "high"
        user_cpu_part_option = "default"
        matrix_based_reduction = True
        cpl_dynamics_analysis = False
        export_ss_to_pickle = False
        ground_scope_core = False
        dss_num_tol = 1e-15
        cce_platform = "launchxl-f28379d"
        cce_use_relative_names = False
        cce_type_mapping_real = "launchxl-f28379d"
        cce_type_mapping_uint = "unsigned int"
        cce_type_mapping_int = "int"
        cce_platform = "launchxl-f28379d"
        cce_use_relative_names = False
        cce_type_mapping_real = "launchxl-f28379d"
        cce_type_mapping_uint = "unsigned int"
        cce_type_mapping_int = "int"
        cce_term_var_location = "local"
        cce_directory = ""
        cce_custom_type_int = ""
        cce_custom_type_uint = ""
        cce_custom_type_real = ""
        tunable_params = "component defined"
        sp_compiler_type = "C compiler"
        sig_stim = "off"
        export_resource_list = ""
        export_dependency_list = ""
        excluded_resource_list = ""
        excluded_component_from_locking_list = ""
        export_out_file = ""
        export_lock_top_level = True
        export_encrypt_library = True
        export_encrypt_resources = True
        solver_type = "DAE"
        integration_method = "BDF"
        max_sim_step = 1e-4
        simulation_time = 1.0
        abs_tol = 1e-3
        rel_tol = 1e-3
        init_sim_step = 1e-6
        r_on_sw = 1e-3
        v_on_diode = 0.2
        data_sampling_rate = 0
        feedthrough_validation_error_level = warning
    }

    component Subsystem Root {
        component Subsystem dq_current_ctrl {
            layout = dynamic
            component "core/C function" "C function PLL" {
                arb_defs = "/*Begin code section*/

/*End code section*/"
                execution_rate = "Ts_Control"
                global_variables = "real y_q;real theta;"
                init_fnc = "/*Begin code section*/
y_q = 0;
theta = 0;
/*End code section*/"
                input_terminals = "real abc;inherit init_pll;"
                input_terminals_dimensions = "3;inherit"
                input_terminals_feedthrough = "True;True"
                input_terminals_show_labels = "True;True"
                output_fnc = "/*Begin code section*/
// dq transformation
d= 2.0/3.0*(cos(theta)*abc[0] + cos(theta - 2.0/3.0*M_PI)*abc[1]  + cos(theta + 2.0/3.0*M_PI)*abc[2] );
q = 2.0/3.0*(-sin(theta)*abc[0] - sin(theta - 2.0/3.0*M_PI)*abc[1]  - sin(theta + 2.0/3.0*M_PI)*abc[2] );

//error
e_q = q;

//omega
omega_pll = K_p_pll*e_q + y_q;
//theta
theta_pll = theta;
/*End code section*/"
                output_terminals = "real d;real q;real theta_pll;real omega_pll;real e_q;"
                output_terminals_dimensions = "1;1;1;1;1"
                output_terminals_feedthrough = "True;True;True;True;True"
                output_terminals_show_labels = "True;True;True;True;True"
                parameters = "real K_p_pll;real K_i_pll;real Ts_Control;"
                update_fnc = "/*Begin code section*/
// Integrator of the PLL
y_q= y_q + K_i_pll*Ts_Control*e_q;
// Integrator of theta
theta = theta + Ts_Control*omega_pll;
if (init_pll<0.5){
    theta = 0;
    y_q = 0;
}

if (theta>=2*M_PI){
    theta = theta - 2*M_PI;
}
if (theta<0.0){
    theta = theta + abs(theta);
}
/*End code section*/"
            }
            [
                position = 7008, 7480
                size = 224, 304
            ]

            component "core/Bus Join" "Bus Join4" {
                execution_rate = "Ts_Control"
                inputs = "3"
            }
            [
                position = 6716, 7344
            ]

            component "core/Termination" Termination3 {
            }
            [
                position = 7208, 7608
            ]

            component "TI C2000 Toolbox/ADC (Generic)" "ADC (Generic)4" {
                conv_trigger = "ePWM6"
                execution_rate = "Ts_Control"
                inten = "True"
                offset = "AO_offset"
                scaling = "V_scale"
            }
            [
                position = 6024, 7284
                size = 127, 63
            ]

            component "TI C2000 Toolbox/ADC (Generic)" "ADC (Generic)5" {
                conv_trigger = "ePWM6"
                execution_rate = "Ts_Control"
                hil_ao_nr = "2"
                inten = "True"
                offset = "AO_offset"
                scaling = "V_scale"
            }
            [
                position = 6024, 7384
                size = 127, 63
            ]

            component "TI C2000 Toolbox/ADC (Generic)" "ADC (Generic)6" {
                conv_trigger = "ePWM6"
                execution_rate = "Ts_Control"
                hil_ao_nr = "3"
                inten = "True"
                offset = "AO_offset"
                scaling = "V_scale"
            }
            [
                position = 6032, 7492
                size = 127, 63
            ]

            component "TI C2000 Toolbox/SCI Setup (Generic)" "SCI Setup1" {
                execution_rate = "Tslow"
            }
            [
                position = 7972, 7516
                size = 127, 63
            ]

            component "TI C2000 Toolbox/SCI Receive (Generic)" "SCI Receive1" {
                execution_rate = "Ts_Control"
                timeout = "0"
                var_names = "id_ref,iq_ref,init_pll,reset_int"
                vct_size = "4"
            }
            [
                position = 7592, 7516
                size = 127, 144
            ]

            component "TI C2000 Toolbox/SCI Send (Generic)" "SCI Send1" {
                var_names = "is_d, is_q,vs_d,vs_q"
                vct_size = "4"
            }
            [
                position = 8300, 7508
                size = 127, 144
            ]

            component "TI C2000 Toolbox/GPIO DO (Generic)" "GPIO DO (Generic)1" {
                hil_di_nr = "12"
                pin_action = "Pin Ctrl"
            }
            [
                position = 7780, 7700
                size = 127, 63
            ]

            component "TI C2000 Toolbox/ePWM (Generic)" "ePWM (Generic)2" {
                dead_time = "0"
                frequency = "20e3"
                hil_di_nr = "13"
                hil_di_nr_b = "14"
                soc_en = "True"
                soc_timing = "Counter equals zero or period"
            }
            [
                position = 8764, 7572
                size = 127, 63
            ]

            component "core/Constant" Constant2 {
                execution_rate = "Ts_Control"
                value = "0.5"
            }
            [
                position = 8620, 7572
            ]

            component "core/Constant" Constant4 {
                execution_rate = "Ts_Control"
            }
            [
                position = 7392, 8056
            ]

            component "core/Sum" Sum2 {
                execution_rate = "Ts_Control"
                signs = "+-"
            }
            [
                position = 7520, 8064
            ]

            component "core/Delay" Delay1 {
                del_length = "1"
                execution_rate = "Ts_Control"
            }
            [
                position = 7516, 8180
                rotation = down
            ]

            component "TI C2000 Toolbox/GPIO DO (Generic)" "GPIO DO (Generic)2" {
                hil_di_nr = "7"
                pin_action = "Pin Ctrl"
            }
            [
                position = 7688, 8064
                size = 127, 63
            ]

            component "core/C function" "C function abc to dq" {
                arb_defs = "/*Begin code section*/

/*End code section*/"
                execution_rate = "Ts_Control"
                input_terminals = "real abc;real theta;"
                input_terminals_dimensions = "3;1"
                input_terminals_feedthrough = "True;True"
                input_terminals_show_labels = "True;True"
                output_fnc = "/*Begin code section*/
d= 2.0/3.0*(cos(theta)*abc[0] + cos(theta - 2.0/3.0*M_PI)*abc[1]  + cos(theta + 2.0/3.0*M_PI)*abc[2] );
q = 2.0/3.0*(-sin(theta)*abc[0] - sin(theta - 2.0/3.0*M_PI)*abc[1]  - sin(theta + 2.0/3.0*M_PI)*abc[2] );
/*End code section*/"
                output_terminals = "real d;real q;"
                output_terminals_dimensions = "1;1"
                output_terminals_feedthrough = "True;True"
                output_terminals_show_labels = "True;True"
            }
            [
                position = 6904, 7772
                size = 176, 152
            ]

            component "core/Sum" Sum3 {
                execution_rate = "Ts_Control"
                signs = "+-"
            }
            [
                position = 7128, 7836
            ]

            component "core/Constant" Constant5 {
                execution_rate = "Ts_Control"
                value = "0"
            }
            [
                position = 6976, 7908
            ]

            component "core/PID controller" "PID controller1" {
                controller_type = "PI"
                execution_rate = "Ts_Control"
                ki = "K_i_pll"
                kp = "K_p_pll"
                show_reset = "rising"
            }
            [
                position = 7284, 7844
            ]

            component "core/Integrator Rollover" "Integrator Rollover1" {
                execution_rate = "Ts_Control"
            }
            [
                position = 7400, 7844
            ]

            component "core/Termination" Termination5 {
            }
            [
                position = 7732, 7440
            ]

            component "core/Termination" Termination6 {
            }
            [
                position = 7740, 7488
            ]

            component "core/Termination" Termination7 {
            }
            [
                position = 7204, 7416
            ]

            component "core/Termination" Termination8 {
            }
            [
                position = 7200, 7480
            ]

            component "core/Delay" Delay2 {
                del_length = "1"
                execution_rate = "Ts_Control"
            }
            [
                position = 6724, 7832
            ]

            component "core/Three phase PLL" PLL {
                execution_rate = "Ts_Control"
                freq_unit = "rad/s"
                initial_filter_output = "50"
                power_form = "variant - uniform"
            }
            [
                position = 6884, 8052
                size = 64, 128
            ]

            component "core/Termination" Termination9 {
            }
            [
                position = 6968, 8096
            ]

            component "core/Termination" Termination10 {
            }
            [
                position = 7024, 8088
            ]

            component "core/Termination" Termination11 {
            }
            [
                position = 7024, 8044
            ]

            component "core/Termination" Termination12 {
            }
            [
                position = 7004, 8016
            ]

            tag From61 {
                value = "vs_a"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 6548, 7324
                hide_name = True
                size = 60, 20
            ]

            tag From62 {
                value = "vs_b"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 6548, 7348
                hide_name = True
                size = 60, 20
            ]

            tag From63 {
                value = "vs_c"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 6548, 7372
                hide_name = True
                size = 60, 20
            ]

            tag Goto36 {
                value = "omega"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 7200, 7544
                hide_name = True
                size = 60, 20
            ]

            tag Goto46 {
                value = "vs_a"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 6220, 7284
                hide_name = True
                size = 60, 20
            ]

            tag Goto47 {
                value = "vs_b"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 6212, 7384
                hide_name = True
                size = 60, 20
            ]

            tag Goto48 {
                value = "vs_c"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 6212, 7492
                hide_name = True
                size = 60, 20
            ]

            tag Goto50 {
                value = "vs_d"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 7304, 7296
                hide_name = True
                size = 60, 20
            ]

            tag From76 {
                value = "omega"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 8104, 7520
                hide_name = True
                size = 58, 20
            ]

            tag From82 {
                value = "reset_int"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 7628, 7700
                rotation = down
                hide_name = True
                scale = -1, 1
                size = 60, 20
            ]

            tag From85 {
                value = "vd_ty"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 8108, 7556
                hide_name = True
                size = 58, 20
            ]

            tag From86 {
                value = "init_PLL"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 6672, 7616
                rotation = down
                hide_name = True
                scale = -1, 1
                size = 60, 20
            ]

            tag Goto60 {
                value = "init_PLL"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 7724, 7524
                hide_name = True
                size = 60, 20
            ]

            tag From87 {
                value = "init_PLL"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 7148, 7956
                rotation = down
                hide_name = True
                scale = -1, 1
                size = 60, 20
            ]

            tag Goto61 {
                value = "theta_bd"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 7476, 7844
                hide_name = True
                size = 60, 20
            ]

            tag Goto62 {
                value = "omega_bd"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 7432, 7744
                hide_name = True
                size = 60, 20
            ]

            tag From88 {
                value = "omega_bd"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 8104, 7488
                hide_name = True
                size = 58, 20
            ]

            tag Goto63 {
                value = "reset_int"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 7728, 7552
                hide_name = True
                size = 60, 20
            ]

            tag From89 {
                value = "theta_bd"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 6620, 7832
                hide_name = True
                size = 58, 20
            ]

            tag Goto64 {
                value = "vs_d_bd"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 7064, 7712
                hide_name = True
                size = 60, 20
            ]

            tag From90 {
                value = "omega_ty"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 8104, 7452
                hide_name = True
                size = 58, 20
            ]

            tag From91 {
                value = "vs_a"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 6744, 8004
                hide_name = True
                size = 60, 20
            ]

            tag From92 {
                value = "vs_b"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 6760, 8036
                hide_name = True
                size = 60, 20
            ]

            tag From93 {
                value = "vs_c"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 6704, 8096
                hide_name = True
                size = 60, 20
            ]

            tag Goto65 {
                value = "omega_ty"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 7224, 8064
                hide_name = True
                size = 60, 20
            ]

            tag Goto66 {
                value = "vd_ty"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 7060, 7960
                hide_name = True
                size = 60, 20
            ]

            junction Junction9 sp
            [
                position = 7560, 8068
            ]

            junction Junction10 sp
            [
                position = 6804, 7344
            ]

            junction Junction11 sp
            [
                position = 7332, 7844
            ]

            comment Comment4 START <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd"><html><head><meta name="qrichtext" content="1" /><style type="text/css">p, li { white-space: pre-wrap; }</style></head><body style=" font-family:'Arial'; font-size:12pt; font-weight:400; font-style:normal;"><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">PLL and abc to dq transformation</p></body></html> ENDCOMMENT 
            [
                position = 6856, 7148
            ]

            scheme_area Area5 {
                title = <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd"><html><head><meta name="qrichtext" content="1" /><meta charset="utf-8" /><style type="text/css">p, li { white-space: pre-wrap; }hr { height: 1px; border-width: 0; }li.unchecked::marker { content: "\2610"; }li.checked::marker { content: "\2612"; }</style></head><body style=" font-family:'Tahoma'; font-size:14pt; font-weight:100; font-style:normal;"><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:1;">Peripherals AO Voltages</span></p></body></html>
            }
            [
                position = 6100, 7380
                size = 356, 380
            ]

            scheme_area Area6 {
                title = <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd"><html><head><meta name="qrichtext" content="1" /><style type="text/css">p, li { white-space: pre-wrap; }</style></head><body style=" font-family:'Tahoma'; font-size:14pt; font-weight:0; font-style:normal;"><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Peripherals</p></body></html>
            }
            [
                position = 8748, 7648
                size = 548, 508
            ]

            scheme_area Area3 {
                title = <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd"><html><head><meta name="qrichtext" content="1" /><style type="text/css">p, li { white-space: pre-wrap; }</style></head><body style=" font-family:'Tahoma'; font-size:14pt; font-weight:0; font-style:normal;"><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Serial Communication</p></body></html>
            }
            [
                position = 7956, 7652
                size = 912, 532
            ]

            connect From63 "Bus Join4.in2" as Connection489
            connect "Bus Join4.in1" From62 as Connection490
            connect From61 "Bus Join4.in" as Connection491
            connect "C function PLL.e_q" Termination3.in as Connection497
            connect Goto36 "C function PLL.omega_pll" as Connection502
            connect Goto46 "ADC (Generic)4.Out" as Connection769
            connect Goto47 "ADC (Generic)5.Out" as Connection770
            connect Goto48 "ADC (Generic)6.Out" as Connection771
            connect From82 "GPIO DO (Generic)1.In" as Connection7564
            connect Constant2.out "ePWM (Generic)2.In1" as Connection7565
            connect From76 "SCI Send1.var3" as Connection7567
            connect Sum2.in Constant4.out as Connection7577
            connect Delay1.out Sum2.in1 as Connection7579
            connect Delay1.in Junction9 as Connection7584
            connect Junction9 Sum2.out as Connection7585
            [
                breakpoints = 7560, 8068
            ]
            connect "GPIO DO (Generic)2.In" Junction9 as Connection7586
            connect From86 "C function PLL.init_pll" as Connection7587
            connect "Bus Join4.out" Junction10 as Connection7589
            connect Junction10 "C function PLL.abc" as Connection7590
            connect "C function abc to dq.abc" Junction10 as Connection7591
            [
                breakpoints = 6768, 7712; 6768, 7344
            ]
            connect "C function abc to dq.q" Sum3.in as Connection7592
            [
                breakpoints = 7092, 7832
            ]
            connect Constant5.out Sum3.in1 as Connection7593
            connect Sum3.out "PID controller1.in" as Connection7594
            connect From87 "PID controller1.reset" as Connection7595
            [
                breakpoints = 7200, 7956; 7200, 7852
            ]
            connect Goto61 "Integrator Rollover1.out" as Connection7597
            connect "PID controller1.out" Junction11 as Connection7598
            connect Junction11 "Integrator Rollover1.input" as Connection7599
            connect Goto62 Junction11 as Connection7600
            connect "SCI Receive1.var3" Goto60 as Connection7601
            connect Termination5.in "SCI Receive1.var1" as Connection7603
            connect "SCI Receive1.var2" Termination6.in as Connection7604
            connect From85 "SCI Send1.var4" as Connection7605
            connect From88 "SCI Send1.var2" as Connection7606
            connect "SCI Receive1.var4" Goto63 as Connection7608
            connect Goto64 "C function abc to dq.d" as Connection7610
            connect From90 "SCI Send1.var1" as Connection7611
            connect "C function PLL.d" Goto50 as Connection7613
            [
                breakpoints = 7184, 7352
            ]
            connect "C function PLL.q" Termination7.in as Connection7614
            connect "C function PLL.theta_pll" Termination8.in as Connection7615
            connect From89 Delay2.in as Connection7616
            connect Delay2.out "C function abc to dq.theta" as Connection7617
            connect From91 PLL.va as Connection7618
            connect From92 PLL.vb as Connection7619
            connect PLL.freq Goto65 as Connection7621
            [
                breakpoints = 6932, 8060; 7160, 8060
            ]
            connect Termination9.in PLL.sin_theta as Connection7622
            connect Termination10.in PLL.theta as Connection7623
            connect Termination11.in PLL.zero_axis as Connection7624
            connect Termination12.in PLL.q_axis as Connection7625
            connect From93 PLL.vc as Connection7627
            connect PLL.d_axis Goto66 as Connection7628
        }
        [
            position = 9320, 8264
            size = 512, 416
        ]

        component Subsystem Plant {
            layout = dynamic
            component "core/Three Phase Voltage Source" Vs1 {
            }
            [
                position = 9428, 8036
                rotation = down
                scale = 1, -1
                size = 62, 256
            ]

            component "core/Series RLC Branch" "Series RLC Branch1" {
                branch_type = "RL"
                inductance = "2.5e-3"
                num_phases = "Three-Phase"
                resistance = "0.1"
            }
            [
                position = 7804, 8036
                size = 128, 256
            ]

            component "core/Series RLC Branch" "Series RLC Branch2" {
                branch_type = "RL"
                inductance = "2.5e-3"
                num_phases = "Three-Phase"
                resistance = "0.1"
            }
            [
                position = 8540, 8036
                size = 128, 256
            ]

            component "core/Series RLC Branch" "Series RLC Branch3" {
                branch_type = "RC"
                capacitance = "1e-6"
                inductance = "L_t"
                num_phases = "Three-Phase"
                resistance = "27"
            }
            [
                position = 8316, 8324
                rotation = right
                size = 128, 256
            ]

            component "core/Voltage Source" v_dc {
            }
            [
                position = 6836, 7956
                rotation = right
            ]

            component "core/Current Measurement" Iag {
            }
            [
                position = 9172, 7940
                size = 64, 32
            ]

            component "core/Voltage Measurement" Va {
            }
            [
                position = 9252, 8260
                rotation = right
                size = 64, 32
            ]

            component "core/Current Measurement" Ibg {
            }
            [
                position = 9172, 8036
                size = 64, 32
            ]

            component "core/Current Measurement" Icg {
            }
            [
                position = 9180, 8132
                size = 64, 32
            ]

            component "core/Voltage Measurement" Vb {
            }
            [
                position = 9308, 8260
                rotation = right
                size = 64, 32
            ]

            component "core/Voltage Measurement" Vc {
            }
            [
                position = 9372, 8260
                rotation = right
                size = 64, 32
            ]

            component "core/Ground" gnd1 {
            }
            [
                position = 9308, 8356
            ]

            component "core/Ground" gnd2 {
            }
            [
                position = 9548, 8140
            ]

            component "core/Ground" gnd3 {
            }
            [
                position = 8308, 8532
            ]

            component "core/Resistor" R1 {
                resistance = "0.001"
            }
            [
                position = 6924, 7852
            ]

            component "core/Half Bridge" "IGBT Leg1" {
                fvd_def_method = "LUT"
                pwm_enable_di = "12"
                pwm_enabling = "True"
                signal_access = "Inherit"
            }
            [
                position = 7220, 7996
                size = 80, 192
            ]

            component "core/Half Bridge" "IGBT Leg2" {
                S_bot = "4"
                S_top = "3"
                fvd_def_method = "LUT"
                pwm_enable_di = "12"
                pwm_enabling = "True"
                signal_access = "Inherit"
            }
            [
                position = 7380, 8148
                size = 80, 192
            ]

            component "core/Half Bridge" "IGBT Leg3" {
                S_bot = "6"
                S_top = "5"
                fvd_def_method = "LUT"
                pwm_enable_di = "12"
                pwm_enabling = "True"
                signal_access = "Inherit"
            }
            [
                position = 7452, 8412
                size = 80, 192
            ]

            component "core/Voltage Measurement" v_h {
            }
            [
                position = 6996, 8084
                rotation = right
                size = 64, 32
            ]

            component "core/Capacitor" C1 {
                capacitance = "2200e-6"
                initial_voltage = "365"
                signal_access = "Inherit"
            }
            [
                position = 7140, 8084
                rotation = right
            ]

            component "core/Resistor" R9 {
                resistance = "1e5"
            }
            [
                position = 7052, 8084
                rotation = right
            ]

            component "core/Capacitor" C2 {
                capacitance = "2200e-6"
                initial_voltage = "365"
                signal_access = "Inherit"
            }
            [
                position = 7140, 8292
                rotation = right
            ]

            component "core/Resistor" R10 {
                resistance = "1e5"
            }
            [
                position = 7052, 8292
                rotation = right
            ]

            junction Junction1 pe
            [
                position = 8220, 7940
            ]

            junction Junction2 pe
            [
                position = 8316, 8036
            ]

            junction Junction3 pe
            [
                position = 8412, 8132
            ]

            junction Junction4 pe
            [
                position = 8316, 8452
            ]

            junction Junction5 pe
            [
                position = 9252, 7940
            ]

            junction Junction6 pe
            [
                position = 9308, 8036
            ]

            junction Junction7 pe
            [
                position = 9372, 8132
            ]

            junction Junction8 pe
            [
                position = 9308, 8300
            ]

            junction Junction9 pe
            [
                position = 8316, 8452
            ]

            junction Junction16 pe
            [
                position = 7284, 8516
            ]

            junction Junction19 pe
            [
                position = 7188, 8516
            ]

            junction Junction22 pe
            [
                position = 7100, 8516
            ]

            junction Junction23 pe
            [
                position = 7380, 7852
            ]

            junction Junction24 pe
            [
                position = 7220, 7852
            ]

            junction Junction25 pe
            [
                position = 6996, 7852
            ]

            junction Junction18 pe
            [
                position = 7052, 8196
            ]

            junction Junction26 pe
            [
                position = 7140, 8196
            ]

            junction Junction27 pe
            [
                position = 7052, 7852
            ]

            junction Junction28 pe
            [
                position = 7052, 8004
            ]

            junction Junction29 pe
            [
                position = 7052, 8516
            ]

            junction Junction30 pe
            [
                position = 7052, 8396
            ]

            connect "Series RLC Branch1.P1_neg" Junction1 as Connection9
            connect Junction1 "Series RLC Branch2.P1_pos" as Connection10
            connect "Series RLC Branch3.P3_pos" Junction1 as Connection11
            connect "Series RLC Branch1.P2_neg" Junction2 as Connection12
            [
                breakpoints = 7980, 8036; 8316, 8036
            ]
            connect Junction2 "Series RLC Branch2.P2_pos" as Connection13
            connect "Series RLC Branch3.P2_pos" Junction2 as Connection14
            connect "Series RLC Branch1.P3_neg" Junction3 as Connection15
            [
                breakpoints = 7908, 8132; 8100, 8132; 8100, 8140; 8412, 8140
            ]
            connect Junction3 "Series RLC Branch2.P3_pos" as Connection16
            connect "Series RLC Branch3.P1_pos" Junction3 as Connection17
            connect "Series RLC Branch3.P3_neg" Junction4 as Connection19
            [
                breakpoints = 8228, 8452
            ]
            connect Junction4 "Series RLC Branch3.P2_neg" as Connection20
            connect Vs1.a_node Junction5 as Connection31
            connect Junction5 Iag.n_node as Connection32
            connect Va.p_node Junction5 as Connection33
            connect Ibg.n_node Junction6 as Connection34
            connect Junction6 Vs1.b_node as Connection35
            connect Vb.p_node Junction6 as Connection36
            [
                breakpoints = 9300, 8220; 9300, 8036
            ]
            connect Icg.n_node Junction7 as Connection37
            connect Junction7 Vs1.c_node as Connection38
            connect Vc.p_node Junction7 as Connection39
            [
                breakpoints = 9372, 8220; 9372, 8132
            ]
            connect Vc.n_node Vb.n_node as Connection40
            connect Va.n_node Junction8 as Connection42
            connect Junction8 Vb.n_node as Connection43
            connect gnd1.node Junction8 as Connection44
            connect gnd2.node Vs1.n_node as Connection45
            connect "Series RLC Branch3.P1_neg" Junction9 as Connection46
            connect Junction9 Junction4 as Connection47
            connect gnd3.node Junction9 as Connection48
            connect R1.p_node v_dc.p_node as Connection53
            connect Junction16 "IGBT Leg3.neg_out" as Connection79
            connect "IGBT Leg2.neg_out" Junction16 as Connection80
            connect "IGBT Leg1.a_in" "Series RLC Branch1.P1_pos" as Connection88
            [
                breakpoints = 7276, 7940; 7724, 7940
            ]
            connect "Series RLC Branch1.P2_pos" "IGBT Leg2.a_in" as Connection89
            connect "Series RLC Branch1.P3_pos" "IGBT Leg3.a_in" as Connection90
            connect Junction19 Junction16 as Connection92
            connect Junction19 "IGBT Leg1.neg_out" as Connection98
            [
                breakpoints = 7188, 8516; 7188, 8516
            ]
            connect v_dc.n_node Junction22 as Connection108
            connect Junction22 Junction19 as Connection109
            connect "IGBT Leg2.pos_out" Junction23 as Connection113
            connect Junction23 "IGBT Leg3.pos_out" as Connection114
            [
                breakpoints = 7380, 7852; 7452, 7852
            ]
            connect Junction24 Junction23 as Connection117
            connect "IGBT Leg1.pos_out" Junction24 as Connection118
            connect R1.n_node Junction25 as Connection119
            connect v_h.p_node Junction25 as Connection121
            connect R9.n_node Junction18 as Connection122
            connect Junction18 R10.p_node as Connection123
            connect C2.p_node Junction26 as Connection111
            connect Junction26 Junction18 as Connection112
            connect C1.n_node Junction26 as Connection124
            connect Junction25 Junction27 as Connection125
            connect Junction27 Junction24 as Connection126
            connect R9.p_node Junction28 as Connection128
            connect Junction28 Junction27 as Connection129
            connect C1.p_node Junction28 as Connection130
            connect v_h.n_node Junction29 as Connection131
            connect Junction29 Junction22 as Connection132
            connect R10.n_node Junction30 as Connection134
            connect Junction30 Junction29 as Connection135
            connect C2.n_node Junction30 as Connection136
            connect "Series RLC Branch2.P1_neg" Iag.p_node as Connection137
            connect "Series RLC Branch2.P2_neg" Ibg.p_node as Connection138
            connect "Series RLC Branch2.P3_neg" Icg.p_node as Connection139
            [
                breakpoints = 9140, 8132
            ]
        }
        [
            position = 8704, 8264
            size = 584, 424
        ]

        component "TI C2000 Toolbox/TI C2000 Setup" "TI RCP Setup1" {
            build_and_deploy_action = "False"
            c2000ware_root_path = "C:\ti\c2000\C2000Ware_5_04_00_00"
            ccs_project_name = "dq_current_ctrl_acg"
            ccs_project_path = "C:/workspace/Typhoon/Auto_code_gen/VSC_USE/updated"
            ccs_root_path = "C:\ti\ccs1271"
            exp_subsys_name = "dq_current_ctrl"
        }
        [
            position = 9752, 8172
            size = 64, 64
        ]
    }

    default {
        "core/Bus Join" {
            inputs = "2"
            execution_rate = "inherit"
        }

        "core/C function" {
            input_terminals = "real in;"
            input_terminals_show_labels = "False;"
            input_terminals_feedthrough = "True;"
            input_terminals_dimensions = "inherit;"
            output_terminals = "real out;"
            output_terminals_show_labels = "False;"
            output_terminals_feedthrough = "True;"
            output_terminals_dimensions = "inherit;"
            output_fnc = ""
            update_fnc = ""
            init_fnc = ""
            global_variables = ""
            parameters = ""
            library_load_type = "Compile-time load"
            dll_file_path = ""
            dll_file_path_full = ""
            arm_a9_file_path = ""
            arm_a9_file_path_full = ""
            arm_a53_file_path = ""
            arm_a53_file_path_full = ""
            h_file_path = ""
            h_file_path_full = ""
            add_src_path = ""
            add_src_path_full = ""
            convert_to_relative_dll = "True"
            convert_to_relative_a = "True"
            convert_to_relative_src = "True"
            arb_defs = ""
            add_macros = ""
            skip_pre_cmpl_check = "False"
            generate_for_hil = "True"
            execution_rate = "inherit"
            _supported_platforms = "[\'generic\']"
            refresh = "refresh"
        }

        "core/Capacitor" {
            signal_access = "inherit"
            capacitance = "1e-6"
            initial_voltage = "0"
            pole_shift_ignore = "False"
            visible = "True"
        }

        "core/Constant" {
            value = "1"
            signal_type = "real"
            execution_rate = "100e-6"
            _tunable = "False"
        }

        "core/Delay" {
            delay_type = "Fixed delay"
            del_length = "2"
            max_delay_length = "20"
            init_value = "0"
            signal_out_type = "inherit"
            execution_rate = "inherit"
        }

        "core/Integrator Rollover" {
            initial_integrator_output = "0"
            roll_over_value = "6.283185307"
            execution_rate = "inherit"
        }

        "core/PID controller" {
            controller_type = "PID"
            kp = "1"
            kp_source = "internal"
            ki = "1"
            ki_source = "internal"
            kd = "0"
            kd_source = "internal"
            filt_coef = "100"
            int_init_value = "0"
            filt_init_value = "0"
            enb_output_limit_out = "False"
            show_reset = "none"
            upper_sat_lim = "1"
            upper_sat_lim_source = "internal"
            lower_sat_lim = "-1"
            lower_sat_lim_source = "internal"
            enb_anti_windup_out = "False"
            signal_out_type = "inherit"
            _tunable = "False"
            execution_rate = "inherit"
        }

        "core/Resistor" {
            resistance = "1"
            param_set = ""
        }

        "core/Sum" {
            signs = "2"
            execution_rate = "inherit"
        }

        "core/Termination" {
            execution_rate = "inherit"
        }

        "core/Voltage Source" {
            sig_input = "False"
            type = "signal generator"
            param_set = "1phase"
            parent_label = ""
            dtsm_switch_name = ""
            addr = "0"
            spc_nb = "0"
            execution_rate = "100e-6"
            cpd_visible = "True"
            enable_snb = "False"
            snb_type = "R2"
            R2 = "0.0"
            L1 = "0.1"
            override_signal_name = "False"
            signal_name = ""
            init_source_nature = "Constant"
            init_const_value = "0.0"
            init_rms_value = "0.0"
            init_frequency = "50.0"
            init_phase = "0.0"
        }

        "TI C2000 Toolbox/ADC (Generic)" {
            hil_ao_nr = "1"
            interface_type = "HIL TI Launchpad Interface"
            controller_index = "1"
            scaling = "1"
            offset = "0"
            execution_rate = "100e-6"
            conv_trigger = "Software Only"
            inten = "False"
        }

        "core/Current Measurement" {
            signal_access = "inherit"
            bw_limit = "False"
            frequency = "10e3"
            comparator_enable = "False"
            operator = "greater"
            threshold = "0"
            cmp_abs_value = "False"
            feed_forward = "false"
            sig_output = "False"
            sig_output_filt_and_full_bw = "False"
            execution_rate = "100e-6"
            addr = "0"
            nd_msr_estimation = "false"
            dev_cpl_msr = "false"
            host_device = "0"
            output_to_device = "0"
            dev_cpl_index = "0"
            dev_cpl_var_nb = "0"
            visible = "True"
            override_signal_name = "False"
            signal_name = ""
        }

        "TI C2000 Toolbox/GPIO DO (Generic)" {
            hil_di_nr = "1"
            pin_action = "Set"
            interface_type = "HIL TI Launchpad Interface"
            controller_index = "1"
            execution_rate = "100e-6"
        }

        "core/Half Bridge" {
            signal_access = "inherit"
            model_type = "Global GDS oversampling"
            ctrl_src = "Digital input per switch"
            op_mode = "Fixed carrier frequency"
            carrier_freq = "10000.0"
            phase_op_mode = "Fixed carrier phase offset"
            carr_ph_offset = "0.0"
            d_time = "5e-6"
            ref_sig_min_max = "[-1.0, 1.0]"
            load_mode = "on min"
            execution_rate = "inherit"
            S_top = "1"
            S_top_logic = "active high"
            S_bot = "2"
            S_bot_logic = "active high"
            S_top_I = "False"
            S_bot_I = "False"
            _control_property = "all high"
            switches_names_at_mask = "[]"
            pwm_enabling = "False"
            pwm_enable_di = "13"
            pwm_enable_inv = "active high"
            delay_enabled = "False"
            fixed_delay = "1e-6"
            var_delay_lut = "[-10.0, 1e-6, 10.0, 1e-6]"
            preview_var_delay = "Preview"
            vout_cmp_pullup_mode = "False"
            vout_cmp_timeout = "5e-6"
            show_monitoring = "False"
            fvd = "False"
            losses_estimation = "False"
            fvd_def_method = "Voltage and Resistance"
            Import_igbt_xml = "not selected"
            Import_diode_xml = "not selected"
            Switch_type = "IGBT"
            Vce = "1.3"
            Rce = "0"
            Vd = "1.2"
            Rd = "0"
            i_sw = "[0.0, 6.0, 12.0, 18.0, 24.0]"
            v_sw = "[0.0, 600.0]"
            temp_sw = "[25.0, 50.0, 75.0, 100.0, 125.0]"
            vce_table_out = "[1.3, 1.3, 1.3, 1.3, 1.3]"
            vd_table_out = "[1.2, 1.2, 1.2, 1.2, 1.2]"
            et_on_table_out = "[[0.0, 0.0275e-3, 0.15e-3, 0.275e-3, 0.3e-3], [0.35*3.8e-3, 0.4*3.8e-3, 0.8*3.8e-3, 0.68*3.8e-3, 0.9*3.8e-3], [0.65*3.8e-3, 0.9*3.8e-3, 1.2*3.8e-3, 1.5*3.8e-3, 1.7*3.8e-3], [0.9*3.8e-3, 1.3*3.8e-3, 1.7*3.8e-3, 1.9*3.8e-3, 2.25*3.8e-3], [1.1*3.8e-3, 1.7*3.8e-3, 2.1*3.8e-3, 2.3*3.8e-3, 2.5*3.8e-3]]"
            et_off_table_out = "[[0.0, 0.0275e-3, 0.15e-3, 0.275e-3, 0.3e-3], [0.35*2.1e-3, 0.4*2.1e-3, 0.8*2.1e-3, 0.68*2.1e-3, 0.9*2.1e-3], [0.65*2.1e-3, 0.9*2.1e-3, 1.2*2.1e-3, 1.5*2.1e-3, 1.7*2.1e-3], [0.9*2.1e-3, 1.3*2.1e-3, 1.7*2.1e-3, 1.9*2.1e-3, 2.25*2.1e-3], [1.1*2.1e-3, 1.7*2.1e-3, 2.1*2.1e-3, 2.3*2.1e-3, 2.5*2.1e-3]]"
            ed_off_table_out = "[[0.0, 0.0275e-3, 0.15e-3, 0.275e-3, 0.3e-3], [0.35*2.2e-3, 0.4*2.2e-3, 0.8*2.2e-3, 0.68*2.2e-3, 0.9*2.2e-3], [0.65*2.2e-3, 0.9*2.2e-3, 1.2*2.2e-3, 1.5*2.2e-3, 1.7*2.2e-3], [0.9*2.2e-3, 1.3*2.2e-3, 1.7*2.2e-3, 1.9*2.2e-3, 2.25*2.2e-3], [1.1*2.2e-3, 1.7*2.2e-3, 2.1*2.2e-3, 2.3*2.2e-3, 2.5*2.2e-3]]"
            temp_estimation = "False"
            thermal_networks_type = "Foster"
            switch_Rth = "[0.159, 0.133, 0.120, 0.038]"
            switch_Tth = "[1.1e-1, 1.56e-2, 1.35e-3, 1.51e-4]"
            switch_Cth = "[0.0029, 0.0097, 0.1068, 0.8500]"
            diode_Rth = "[0.159, 0.133, 0.120, 0.038]"
            diode_Tth = "[1.1e-1, 1.56e-2, 1.35e-3, 1.51e-4]"
            diode_Cth = "[0.0029, 0.0097, 0.1068, 0.8500]"
            loss_exec_rate = "100e-6"
            visualize_luts = "Visualize Lookup Tables"
            show_cnt_out = "False"
            PESB_Optimization = "True"
            dtv_flag_en = "True"
            reserved_parameter1 = "0"
            predictive_diode_turn_off = "False"
        }

        "TI C2000 Toolbox/SCI Receive (Generic)" {
            vct_size = "1"
            var_names = "var1"
            var1 = ""
            var2 = ""
            var3 = ""
            var4 = ""
            execution_rate = "1e-3"
            timeout = "0.1"
            change_names = "False"
        }

        "TI C2000 Toolbox/SCI Send (Generic)" {
            vct_size = "1"
            var_names = "var1"
            var1 = ""
            var2 = ""
            var3 = ""
            var4 = ""
            sending_prd = "on ping"
            change_names = "False"
        }

        "TI C2000 Toolbox/SCI Setup (Generic)" {
            sci_module = "a"
            lspclkdiv = "1"
            lspclk = "1"
            baudrate = "460800"
            scihbaud = "0"
            scilbaud = "12"
            probe_connection = "True"
            ti_tx_gpio = "42"
            ti_rx_gpio = "43"
            parityena = "False"
            parity = "Odd"
            stopbits = "1"
            scichar = "7"
            sciffena = "1"
            scirst = "1"
            swreset = "1"
            rxena = "1"
            txena = "1"
            rxfiforeset = "1"
            txfiforeset = "1"
            txfifoxreset = "1"
            execution_rate = "1e-3"
        }

        "core/Series RLC Branch" {
            num_phases = "Single-Phase"
            branch_type = "RLC"
            resistance = "10"
            inductance = "10e-3"
            initial_current = "0"
            capacitance = "10e-6"
            initial_voltage = "0"
        }

        "TI C2000 Toolbox/TI C2000 Setup" {
            build_and_deploy = "Build and deploy"
            build_and_deploy_action = "0"
            create_ccs_project = "Create CCS Project"
            create_ccs_project_action = "False"
            export = "Export code"
            export_action = "False"
            build = "Build"
            build_action = "False"
            flash = "Flash target"
            flash_action = "False"
            ex_rate_test = "Perform execution rate test"
            ex_rate_test_action = "False"
            exp_subsys_name = ""
            ccs_project_name = ""
            model_path_en = "True"
            ccs_project_path = "c:\git\t_mdl\010_ti_rcp_lib\ti_rcp_lib_v1"
            target_platform = "LAUNCHXL-F28379D"
            execution_rate = "100e-6"
            ccs_root_path = "C:\User Programs\ti"
            c2000ware_root_path = "C:\ti\C2000Ware_5_02_00_00"
            write_settings = "Write settings"
            scheduling = "CPU Timer Based Scheduler"
        }

        "core/Three Phase Voltage Source" {
            init_rms_value = "0.0"
            init_frequency = "50.0"
            init_phase = "0.0"
        }

        "core/Three phase PLL" {
            initial_filter_output = "60"
            wn = "157.0796"
            zeta = "0.707"
            rate_high = "12"
            rate_low = "-12"
            freq_unit = "Hz"
            kp = "100"
            ki = "3200"
            kd = "1"
            N = "714.2857"
            initial_pid_output = "376.99111843"
            up_lim = "1e4"
            low_lim = "-1e4"
            kb = "1"
            power_form = "variant - Clarke\'s original"
            alignment = "-pi/2"
            disable_filter = "False"
            wn_LPFdq = "62.83185307"
            execution_rate = "inherit"
            enable_pk = "False"
            enable_zero = "True"
            enable_sin = "True"
        }

        "core/Voltage Measurement" {
            signal_access = "inherit"
            bw_limit = "False"
            frequency = "10e3"
            comparator_enable = "False"
            operator = "greater"
            threshold = "0"
            cmp_abs_value = "False"
            feed_forward = "false"
            sig_output = "False"
            sig_output_filt_and_full_bw = "False"
            execution_rate = "100e-6"
            addr = "0"
            nd_msr_estimation = "false"
            dev_cpl_msr = "false"
            host_device = "0"
            output_to_device = "0"
            dev_cpl_index = "0"
            dev_cpl_var_nb = "0"
            visible = "True"
            override_signal_name = "False"
            signal_name = ""
        }

        "TI C2000 Toolbox/ePWM (Generic)" {
            hil_di_nr = "1"
            hil_di_nr_b = "2"
            interface_type = "HIL TI Launchpad Interface"
            controller_index = "1"
            nr_of_channels = "1"
            freq_op_mode = "Fixed carrier frequency"
            frequency = "10e3"
            phase_op_mode = "Fixed carrier phase offset"
            carr_ph_offset = "0"
            dead_time = "5e-7"
            load_mode = "on min"
            clock_time_ti = "5e-9"
            clock_time_emulator = "5e-9"
            soc_en = "False"
            soc_timing = "Counter equals zero"
            soc_period = "Every event"
            int_en = "False"
            int_timing = "Counter equals zero"
            int_period = "Every event"
        }
    }

    CODE model_init
        # Numpy module is imported as 'np'
        # Scipy module is imported as 'sp'
        # The Schematic API is imported as 'mdl'
        # To get the model file path, use 'mdl.get_model_file_path()'
        # To print information to the console, use info()
        
        omega = 2*np.pi*50
        L_t = 2.5e-3
        C = 1e-6
        L_s = 2.5e-3
        R_d = 27
        R_t = omega*L_t/10
        R_s = omega*L_s/10
        Ts = 50e-6
        AO_offset = 1.5
        I_scale = 90/3 #105 max volta - (-150) min voltage. 3 max voltage DSP
        V_scale = 720/3 #360 max volta - (-360) min voltage. 3 max voltage DSP
        Tslow = 1e-3
        Ts_Control = 50e-6
        
        #PLL control gains
        K_p_pll = 1.8
        K_i_pll = 1.8/0.00251
        
        # PI current controller gains
        tau_c = 1e-3
        L = L_s + L_t
        R = R_s + R_t
        Kp_i = L/tau_c
        Ki_i = R/tau_c
        
        #Ton contactor
        T_on_contactor = 0.1
    ENDCODE
}
